import{_ as P}from"./vBtn-CmJOxRip.js";import{m as S,_ as D}from"./makeForm-CsZjxp4a.js";import{s as N,b as A,o as B,B as I}from"./vant-Ckwj66YG.js";import{t as M}from"./class-COLQ8iHP.js";import{p as $,u as L,D as s,F as f,G as F,H as _,c as O,h as v,e as R,x as U}from"./index-zLUezw_f.js";import{a as V}from"./axios-B4uVmeYG.js";import{l}from"./lodash-DhpMPSDc.js";import{m as u,b as J}from"./backfill-CdlEvImR.js";import{m as t,a as d}from"./makeUpload-DhbhoDk8.js";import{r as E}from"./@vueuse-QQdVrKV8.js";import{q as C}from"./queryUrl-BTYYWpY7.js";import{e as W,aX as X,al as z,N as o,bA as g,u as m,F as G,am as h,be as y,V as H}from"./@vue-ts87NNlE.js";import"./wait-Dqho1LKt.js";import"./@vant-NmgEisJw.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./xe-utils-DXe260hc.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";async function Q(a,e){return a=a.toFixed(5),e=e.toFixed(5),(await V.get(`https://restapi.amap.com/v3/geocode/regeo?key=1dff3e224b6e8228f3cf4c10fa31b335&location=${a},${e}`)).data}const j=[{customSlot:"title",titleClass:M},{customSlot:"location",address:"",lat:"",lng:"",loading:E(!1,5e3),getLocation(){const a=$({func:"location"});this.loading=a,window.getLocation=async(e,i)=>{if(i)N(i);else{const b=JSON.parse(e);this.loading=!1;const{latitude:k,longitude:w}=b;this.lng=w,this.lat=k;const r=await Q(this.lng,this.lat);this.address=r.regeocode.formatted_address,A("定位成功"),L().saveData()}}},backfill(a){this.lat=a.lat,this.lng=a.lng,this.address=a.latLngAddress,this.disabled=!a.btns.canEdit},getParam(a){a.lat=this.lat,a.lng=this.lng,a.latLngAddress=this.address}}],K=[u("房屋外观照"),{...t(1,100),required:!0,name:"panorama",label:"房屋外观全景水印相机定位(必填)"}],Y=[u("房屋内部结构"),{...t(1,100),required:!0,label:"内部横梁立柱(必填)",name:"innerStructure"}],Z=[u("房屋内部环境"),{...t(1,100),required:!0,label:"生活/工作/生产环境(必填)",name:"interneMilieu"}],aa=[u("屋顶连贯照"),{formType:"cell",title:"站东南角往西北拍、站北往正南拍、站西南角往东北拍、站东北角往西南拍、站南往正北拍、站西北角往东南拍(必填)",titleClass:"text-center"},{...t(999,100),required:!0,label:"站东南角往西北拍",name:"roofSoutheast",backfill(a){l.bind(d,this)(a)},getParam(a){a[this.name]=JSON.stringify(this.inlineForm[0].value.map(e=>s(e)))}},{...t(999,100),required:!0,label:"站北往正南拍",name:"roofNorth",backfill(a){l.bind(d,this)(a)},getParam(a){a[this.name]=JSON.stringify(this.inlineForm[0].value.map(e=>s(e)))}},{...t(999,100),required:!0,label:"站西南角往东北拍",name:"roofSouthwest",backfill(a){l.bind(d,this)(a)},getParam(a){a[this.name]=JSON.stringify(this.inlineForm[0].value.map(e=>s(e)))}},{...t(999,100),required:!0,label:"站东北角往西南拍",name:"roofDBToXN",backfill(a){l.bind(d,this)(a)},getParam(a){a[this.name]=this.inlineForm[0].value.map(e=>s(e))}},{...t(999,100),required:!0,label:"站南往正北拍",name:"roofNToB",backfill(a){l.bind(d,this)(a)},getParam(a){a[this.name]=this.inlineForm[0].value.map(e=>s(e))}},{...t(999,100),required:!0,label:"站西北角往东南拍",name:"roofXBToDN",backfill(a){l.bind(d,this)(a)},getParam(a){a[this.name]=this.inlineForm[0].value.map(e=>s(e))}}],ea=[u("屋顶面整体照"),{...t(1,100),required:!0,label:"风化和防水(必填)",name:"roofWhole"}],ta=[u("楼板厚度照"),{...t(999,100),required:!0,label:"楼板厚度照(必填)",name:"floorThickness",backfill(a){this.inlineForm[0].value=a[this.name]?a[this.name].map(e=>({url:f(e)})):[],F(),_(...this.inlineForm[0].value.map(e=>s(e)))},getParam(a){a[this.name]=this.inlineForm[0].value.map(e=>s(e))}}],oa=[u("光伏勘察表"),{...t(1,50),required:!0,label:"勘察表正面(必填)",name:"front",backfill(a){const e=l.get(a,`explorationTable.${this.name}`);this.inlineForm[0].value=e?[{url:f(e)}]:[],F(),_(f(e))},getParam(a){delete a.front,l.set(a,"explorationTable.front",s(this.inlineForm[0].value[0])||"")}},{...t(1,50),required:!0,label:"屋面尺寸图(必填)",name:"back",backfill(a){const e=l.get(a,`explorationTable.${this.name}`);this.inlineForm[0].value=e?[{url:f(e)}]:[],F(),_(f(e))},getParam(a){delete a.back,l.set(a,"explorationTable.back",s(this.inlineForm[0].value[0])||"")}}],sa=[u("其他踏勘影像件"),{...t(999,100),label:"其他踏勘影像件(选填)",name:"imageAddr",backfill(a){const e=a.otherImages?.imageAddr||[];this.inlineForm[0].value=e.map(i=>({url:f(i)})),F(),_(...this.inlineForm[0].value.map(i=>s(i)))},getParam(a){delete a.imageAddr,l.set(a,"otherImages.imageAddr",this.inlineForm[0].value.map(e=>s(e)))}}],ra=h("div",null,[h("div",null,"安装地址"),h("div",null,"确保项目定位准确否则施工无法扫码收货")],-1),Aa={__name:"businessReconnaissance",setup(a){const e=S({businessReconnaissanceForm:j,panoramaForm:K,innerStructureForm:Y,interneMilieuForm:Z,roofForm:aa,roofWholeForm:ea,dimensionalDrawingForm:ta,explorationTableForm:oa,otherImagesForm:sa});W(()=>{i()});async function i(){const r=C("order/get-takan",{orderId:O()?.orderId}),{data:p}=await v.get(r);J(e,p)}async function b(){const r=U();return await v.post("order/put-takan",r)}async function k(r){await v.post(C("approval/put-approval/pre/takan",r))}async function w(r){const p=r.approvalType=="APPROVAL_BTO"?"approval/do-approval/bto/takan":"approval/do-approval/pre/takan";await v.post(p,r)}return R({getData:i,saveData:b,submitData:k,approvalData:w}),(r,p)=>{const x=B,T=I,n=D,q=P;return X(),z(G,null,[o(n,{form:m(e).businessReconnaissanceForm,"group-class":"shadowC",class:"pt-3"},{title:g(({slot:c})=>[o(x,{titleClass:c.titleClass+" py-2",class:"!p-0"},{title:g(()=>[ra]),_:2},1032,["titleClass"])]),location:g(({slot:c})=>[o(x,{title:"经纬度","value-class":"!text-[#323232] !w-[80%] !flex-none","title-class":"!w-[20%] !flex-none my-auto"},{value:g(()=>[h("div",null,y(c.address||"定位地理位置(自动获取)"),1),h("div",null,"纬度: "+y(c.lat||"未获取"),1),h("div",null,"经度: "+y(c.lng||"未获取"),1),o(T,{onClick:()=>c.getLocation(),loading:c.loading,disabled:c.disabled,class:"!w-[100px] !py-3 !bg-[#ffab30] !text-[white] !border-0 !text-[14px]",round:"",size:"mini"},{default:g(()=>[H(" 获取定位 ")]),_:2},1032,["onClick","loading","disabled"])]),_:2},1024)]),_:1},8,["form"]),o(n,{form:m(e).panoramaForm,"group-class":"shadowC",class:"pt-3"},null,8,["form"]),o(n,{form:m(e).innerStructureForm,"group-class":"shadowC",class:"pt-3"},null,8,["form"]),o(n,{form:m(e).interneMilieuForm,"group-class":"shadowC",class:"pt-3"},null,8,["form"]),o(n,{form:m(e).roofForm,"group-class":"shadowC",class:"pt-3"},null,8,["form"]),o(n,{form:m(e).roofWholeForm,"group-class":"shadowC",class:"pt-3"},null,8,["form"]),o(n,{form:m(e).dimensionalDrawingForm,"group-class":"shadowC",class:"pt-3"},null,8,["form"]),o(n,{form:m(e).explorationTableForm,"group-class":"shadowC",class:"pt-3"},null,8,["form"]),o(n,{form:m(e).otherImagesForm,"group-class":"shadowC",class:"py-3"},null,8,["form"]),o(q)],64)}}};export{Aa as default};
