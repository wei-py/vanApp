import{_ as g}from"./vBtn-CFSnyGjN.js";import{m as _,_ as w}from"./makeForm-LXfxxl4j.js";import{m as T,a as p,b as F}from"./backfill-YTqXYfvZ.js";import{d as x,s as t,c as k,h as n,E as u,b as V,I as q,e as R,v as O}from"./index-D0ldpvYI.js";import{b as f,m as y}from"./makeSelect-C4yghakN.js";import{l as P}from"./lodash-D-SkTV7p.js";import{q as m}from"./queryUrl-DaTGvNW7.js";import{x as s}from"./xe-utils-CfMIR_ol.js";import{w as h}from"./watchItem-CNvzLEiB.js";import{m as C,a as L}from"./makeUpload-BNh7QOMX.js";import{r as N}from"./runTime-DAjLGjV1.js";import{e as U,aX as $,al as B,N as v,u as E,F as S}from"./@vue-ts87NNlE.js";import"./vant-PdAvEskO.js";import"./@vant-NmgEisJw.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-DLUPp4BS.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-jb8ML41u.js";import"./vxe-table-CAWzlaHI.js";import"./dom-zindex-GlLoxNk1.js";import"./@vue-office-D7CPqAIZ.js";import"./vue-demi-BO4xsXkA.js";import"./vue-B7fnMq6U.js";const A=[T(x()?"备案证":"备案证及权属证明"),{formType:"input",label:"备案证类型",name:"recordType",required:!0,...f(),...y("recordType",[{text:"大备案证",value:1},{text:"精准备案",value:2}]),confirm(){t("recordCertificateCapacity","value","")}},{formType:"input",label:"项目公司",name:"companyId",required:!0,...f(),...y("companyId",[],"dynamic"),async backfill(e){if(e.orderRecordType=="RECORD_NP")this.isLink=!1,this.clickable=!1,this.value="",this.value="非项目公司备案无需填写备案证信息",this.reaonly=!0;else{const c=m("leaseLessor/getAuth",{pageNum:1,pageSize:999,orderId:k()?.orderId,recordType:e.orderRecordType}),{data:o}=await n.get(c),l=o.map(r=>({...r,text:`${r.code}, ${r.companyName}, ${r.areaId}`,disabled:r.disabled,value:r.code}));this.makeSelect(e.companyId,l),this.click=()=>{}}}},{formType:"input",name:"recordCertificateId",label:"备案证编码",realValue:"",value:"",required:!0,getParam(e){e[this.name]=this.realValue||this.value},blur(){t("recordCertificateCapacity",e=>{e.ref.focus()})},isLink:!0,readonly:!0,placeholder:"请选择直接输入或选择",inlineForm:[{slot:"right-icon",formType:"popup",name:"recordCertificateIdPop",show:!1,round:!0,position:"bottom",class:"h-[40vh]",closeOnClickOverlay:!0,inlineForm:[{slot:"default",formType:"pick",confirm(e){t("recordCertificateId","value",e.selectedOptions[0].text),t("recordCertificateId","realValue",e.selectedOptions[0].value),t("recordCertificateId","inlineForm.0.show",!1),t("accessory","inlineForm.0.value",[{url:u(e.selectedOptions[0].accessory)}]),t("recordCertificateCapacity","value",s.divide(e.selectedOptions[0].recordCertificateCapacity,1e3))},columns:[]}]},{slot:"button",name:"recordCertificateIdRightIcon",formType:"popover",show:!1,placement:"bottom-end",actions:[],style:{width:"250px",height:"40vh"},select(e){t("recordCertificateId","value",e.value),t("recordCertificateCapacity","value",s.divide(e.recordCertificateCapacity,1e3)),t("accessory","inlineForm.0.value",[{url:u(e.accessory)}])}}],async backfill(e){h(["companyId","recordType"],async([c,o])=>{const{data:l}=await n.post("record/list?isAuth=false",{recordType:o,companyId:c});if(o==1){this.value="",this.readonly=!0,this.isLink=!0,this.click=()=>{const a=V();this.inlineForm[0].show=a.btns.canEdit};const r=l.map(a=>({...a,text:a.recordCertificateId,value:a.recordCertificateId}));this.inlineForm[0].inlineForm[0].columns=r,t("surplusCapacity","hidden",!1)}else{const r=l.map(a=>({...a,text:a.recordCertificateId,value:a.recordCertificateId}));this.updateValue=a=>{const i=r.filter(d=>d.value.includes(a));this.inlineForm[1].show=new Boolean(i.length||a.length),this.inlineForm[1].actions=i,this.realValue=a,t("recordCertificateCapacity","value","")},this.value="",this.readonly=!1,this.isLink=!1,this.click=()=>{},t("surplusCapacity","hidden",!0)}}),await q(2e3),t("recordCertificateId","value",e.recordCertificateId),t("recordCertificateId","realValue",e.recordCertificateId)}},{formType:"input",label:"备案证容量",name:"recordCertificateCapacity",value:"",required:!0,readonly:!1,...p("kW"),getParam(e){e[this.name]=s.multiply(e[this.name],1e3)},backfill(e){this.value=s.divide(e.recordCertificateCapacity*1,1e3)}},{formType:"input",label:"本项目拟安装容量",required:!0,readonly:!0,name:"installedCapacityReckon",value:"",...p("kW"),backfill(e){this.value=s.divide(e.installedCapacityReckon*1,1e3)},getParam(e){e[this.name]=s.multiply(e[this.name],1e3)}},{formType:"input",label:"剩余备案容量",name:"surplusCapacity",placeholder:"自动计算",readonly:!0,value:"",...p("kW"),backfill(e){this.realValue=e.surplusCapacity,this.value=s.divide(e.surplusCapacity*1,1e3),h(["recordCertificateCapacity","installedCapacityReckon"],([c,o])=>{this.realValue=s.subtract(c,o),this.value=this.realValue*1})},getParam(e){e[this.name]=s.multiply(e[this.name],1e3)}},{...C(1,100,"*"),label:"备案证附件",name:"accessory",required:!0},{...C(999,100),label:"房屋权属证明",name:"propertyCertificate",required:!0,backfill(e){P.bind(L,this)(e)}}],ye={__name:"certificate",setup(e){const c=_({certificate:A});U(()=>{N(o)});async function o(){const i=m("order/get-record",{orderId:k()?.orderId}),{data:d}=await n.get(i);F(c,d)}async function l(){const i=O();return await n.post("order/put-record",i)}async function r(i){await n.post(m("approval/put-approval/bto/record",i))}async function a(i){await n.post("approval/do-approval/bto/record",i)}return R({getData:o,saveData:l,submitData:r,approvalData:a}),(i,d)=>{const b=w,I=g;return $(),B(S,null,[v(b,{form:E(c).certificate,class:"pt-3","group-class":"shadowC"},null,8,["form"]),v(I)],64)}}};export{ye as default};
