import{_ as g}from"./vBtn-BNWz2cvu.js";import{m as _,_ as w}from"./makeForm-CSPZ389Q.js";import{m as F,a as p,b as T}from"./backfill-Cd9AIfra.js";import{f as x,s as a,c as k,h as n,F as u,b as V,e as q,x as R}from"./index-DoomjHTc.js";import{b as f,m as h}from"./makeSelect-CFsOVmlj.js";import{l as O}from"./lodash-DhpMPSDc.js";import{q as m}from"./queryUrl-BTYYWpY7.js";import{x as c}from"./xe-utils-DXe260hc.js";import{w as y}from"./watchItem-DbhTm8YG.js";import{w as P}from"./wait-Dqho1LKt.js";import{m as C,a as N}from"./makeUpload-XopPofFX.js";import{r as U}from"./runTime-DAjLGjV1.js";import{e as $,aX as B,al as E,N as v,u as S,F as A}from"./@vue-ts87NNlE.js";import"./vant-BjNCsb4u.js";import"./@vant-NmgEisJw.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";const D=[F(x()?"备案证":"备案证及权属证明"),{formType:"input",label:"备案证类型",name:"recordType",required:!0,...f(),...h("recordType",[{text:"大备案证",value:1},{text:"精准备案",value:2}]),confirm(){a("recordCertificateCapacity","value","")}},{formType:"input",label:"项目公司",name:"companyId",required:!0,...f(),...h("companyId",[],"dynamic"),async backfill(e){if(e.orderRecordType=="RECORD_NP")this.isLink=!1,this.clickable=!1,this.value="",this.value="非项目公司备案无需填写备案证信息",this.reaonly=!0;else{const s=m("leaseLessor/getAuth",{pageNum:1,pageSize:999,orderId:k()?.orderId,recordType:e.orderRecordType}),{data:o}=await n.get(s),l=o.map(r=>({...r,text:`${r.code}, ${r.companyName}, ${r.areaId}`,disabled:r.disabled,value:r.code}));this.makeSelect(e.companyId,l),this.click=()=>{}}}},{formType:"input",name:"recordCertificateId",label:"备案证编码",realValue:"",value:"",required:!0,getParam(e){e[this.name]=this.realValue||this.value},blur(){a("recordCertificateCapacity",e=>{e.ref.focus()})},isLink:!0,rightIcon:"",readonly:!0,placeholder:"请直接输入或选择",inlineForm:[{slot:"right-icon",formType:"popup",name:"recordCertificateIdPop",show:!1,round:!0,position:"bottom",class:"h-[40vh]",closeOnClickOverlay:!0,inlineForm:[{slot:"default",formType:"pick",confirm(e){a("recordCertificateId","value",e.selectedOptions[0].text),a("recordCertificateId","realValue",e.selectedOptions[0].value),a("recordCertificateId","inlineForm.0.show",!1),a("accessory","inlineForm.0.value",[{url:u(e.selectedOptions[0].accessory)}]),a("recordCertificateCapacity","value",c.divide(e.selectedOptions[0].recordCertificateCapacity,1e3))},columns:[]}]},{slot:"button",name:"recordCertificateIdRightIcon",formType:"popover",show:!1,placement:"bottom-end",actions:[],style:{width:"250px",height:"40vh"},select(e){a("recordCertificateId","value",e.value),a("recordCertificateCapacity","value",c.divide(e.recordCertificateCapacity,1e3)),a("accessory","inlineForm.0.value",[{url:u(e.accessory)}])}}],async backfill(e){y(["companyId","recordType"],async([s,o])=>{const{data:l}=await n.post("record/list?isAuth=false",{recordType:o,companyId:s});if(o==1){this.value="",this.readonly=!0,this.rightIcon="",this.click=()=>{const t=V();this.inlineForm[0].show=t.btns.canEdit};const r=l.map(t=>({...t,text:t.recordCertificateId,value:t.recordCertificateId}));this.inlineForm[0].inlineForm[0].columns=r,a("surplusCapacity","hidden",!1)}else{const r=l.map(t=>({...t,text:t.recordCertificateId,value:t.recordCertificateId}));this.updateValue=t=>{const i=r.filter(d=>d.value.includes(t));this.inlineForm[1].show=new Boolean(i.length||t.length),this.inlineForm[1].actions=i,this.realValue=t,a("recordCertificateCapacity","value","")},this.value="",this.readonly=!1,this.click=()=>{this.inlineForm[1].show=flag.btns.canEdit},a("surplusCapacity","hidden",!0)}}),await P(2e3),a("recordCertificateId","value",e.recordCertificateId),a("recordCertificateId","realValue",e.recordCertificateId)}},{formType:"input",label:"备案证容量",name:"recordCertificateCapacity",value:"",required:!0,readonly:!1,...p("kW"),getParam(e){e[this.name]=c.multiply(e[this.name],1e3)},backfill(e){this.value=c.divide(e.recordCertificateCapacity*1,1e3)}},{formType:"input",label:"本项目拟安装容量",required:!0,readonly:!0,name:"installedCapacityReckon",value:"",...p("kW"),backfill(e){this.value=c.divide(e.installedCapacityReckon*1,1e3)},getParam(e){e[this.name]=c.multiply(e[this.name],1e3)}},{formType:"input",label:"剩余备案容量",name:"surplusCapacity",placeholder:"自动计算",readonly:!0,value:"",...p("kW"),backfill(e){this.realValue=e.surplusCapacity,this.value=c.divide(e.surplusCapacity*1,1e3),y(["recordCertificateCapacity","installedCapacityReckon"],([s,o])=>{this.realValue=c.subtract(s,o),this.value=this.realValue*1})},getParam(e){e[this.name]=c.multiply(e[this.name],1e3)}},{...C(1,100,"*"),label:"备案证附件",name:"accessory",required:!0},{...C(999,100),label:"房屋权属证明",name:"propertyCertificate",required:!0,backfill(e){O.bind(N,this)(e)}}],ye={__name:"certificate",setup(e){const s=_({certificate:D});$(()=>{U(o)});async function o(){const i=m("order/get-record",{orderId:k()?.orderId}),{data:d}=await n.get(i);T(s,d)}async function l(){const i=R();return await n.post("order/put-record",i)}async function r(i){await n.post(m("approval/put-approval/bto/record",i))}async function t(i){await n.post("approval/do-approval/bto/record",i)}return q({getData:o,saveData:l,submitData:r,approvalData:t}),(i,d)=>{const b=w,I=g;return B(),E(A,null,[v(b,{form:S(s).certificate,class:"pt-3","group-class":"shadowC"},null,8,["form"]),v(I)],64)}}};export{ye as default};
