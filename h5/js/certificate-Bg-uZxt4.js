import{_ as g}from"./vBtn-h-mmgtbW.js";import{m as _,_ as w}from"./makeForm-C_uyyvx9.js";import{m as T,a as p,b as F}from"./backfill-hh-glB-L.js";import{a as x}from"./Biztype-DPM88l-Q.js";import{b as u,m as f}from"./makeSelect-BzGYyrzS.js";import{c as k,h as n,s as a,z as y,b as q,D as R,e as V,n as O}from"./index-NPFU1_kq.js";import{l as P}from"./lodash-C-AG1eJN.js";import{q as m}from"./queryUrl-ggRt1bhs.js";import{x as s}from"./xe-utils-BM3aD2L3.js";import{w as h}from"./watchItem-DrEA5LQt.js";import{m as C,a as L}from"./makeUpload-FhoYjxox.js";import{r as N}from"./runTime-DAjLGjV1.js";import{e as U,Z as $,_ as B,N as v,u as D,F as S}from"./@vue-BhOIXUCP.js";import"./vant-DL9g20lT.js";import"./@vant-D2Uub16A.js";import"./class-rRG2y2aF.js";import"./pinia-CQ-jtR3-.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-XNYRUkAR.js";import"./@vueuse-BaMGbt4d.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-bC99Tnvx.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-VHbn-zkx.js";import"./vue3-photo-preview-Dedu722r.js";import"./vxe-table-BBegQXiE.js";import"./dom-zindex-GlLoxNk1.js";import"./dayjs-Bof1u0Bp.js";const A=[T(x()?"备案证及权属证明":""),{formType:"input",label:"备案证类型",name:"recordType",required:!0,...u(),...f("recordType",[{text:"大备案证",value:1},{text:"精准备案",value:2}])},{formType:"input",label:"项目公司",name:"companyId",required:!0,...u(),...f("companyId",[],"dynamic"),async backfill(e){if(e.orderRecordType=="RECORD_NP")this.isLink=!1,this.clickable=!1,this.value="",this.value="非项目公司备案无需填写备案证信息",this.reaonly=!0;else{const c=m("leaseLessor/getAuth",{pageNum:1,pageSize:999,orderId:k()?.orderId,recordType:e.orderRecordType}),{data:o}=await n.get(c),l=o.map(r=>({...r,text:`${r.code}, ${r.companyName}, ${r.areaId}`,disabled:r.disabled,value:r.code}));this.makeSelect(e.companyId,l),this.click=()=>{}}}},{formType:"input",name:"recordCertificateId",label:"备案证编码",realValue:"",required:!0,getParam(e){e[this.name]=this.realValue||this.value},isLink:!0,readonly:!0,placeholder:"请选择直接输入或选择",inlineForm:[{slot:"right-icon",formType:"popup",name:"recordCertificateIdPop",show:!1,round:!0,position:"bottom",class:"h-[40vh]",closeOnClickOverlay:!0,inlineForm:[{slot:"default",formType:"pick",confirm(e){a("recordCertificateId","value",e.selectedOptions[0].text),a("recordCertificateId","realValue",e.selectedOptions[0].value),a("recordCertificateId","inlineForm.0.show",!1),a("accessory","inlineForm.0.value",[{url:y(e.selectedOptions[0].accessory)}]),a("recordCertificateCapacity","value",s.divide(e.selectedOptions[0].recordCertificateCapacity,1e3))},columns:[]}]},{slot:"button",name:"recordCertificateIdRightIcon",formType:"popover",show:!1,placement:"bottom-end",actions:[],style:{width:"250px",height:"40vh"},select(e){a("recordCertificateId","value",e.value),a("recordCertificateCapacity","value",s.divide(e.recordCertificateCapacity,1e3)),a("accessory","inlineForm.0.value",[{url:y(e.accessory)}])}}],async backfill(e){h(["companyId","recordType"],async([c,o])=>{const{data:l}=await n.post("record/list?isAuth=false",{recordType:o,companyId:c});if(o==1){this.value="",this.readonly=!0,this.isLink=!0,this.click=()=>{const t=q();this.inlineForm[0].show=t.btns.canEdit};const r=l.map(t=>({...t,text:t.recordCertificateId,value:t.recordCertificateId}));this.inlineForm[0].inlineForm[0].columns=r,a("surplusCapacity","hidden",!1),a("recordCertificateCapacity","readonly",!0)}else{const r=l.map(t=>({...t,text:t.recordCertificateId,value:t.recordCertificateId}));this.updateValue=t=>{const i=r.filter(d=>d.value.includes(t));this.inlineForm[1].show=new Boolean(i.length||t.length),this.inlineForm[1].actions=i},this.value="",this.readonly=!1,this.isLink=!1,this.click=()=>{},a("surplusCapacity","hidden",!0),a("recordCertificateCapacity","readonly",!1)}}),await R(2e3),a("recordCertificateId","value",e.recordCertificateId),a("recordCertificateId","realValue",e.recordCertificateId)}},{formType:"input",label:"备案证容量",name:"recordCertificateCapacity",value:"",required:!0,...p("kW"),getParam(e){e[this.name]=s.multiply(e[this.name],1e3)},backfill(e){this.value=s.divide(e.recordCertificateCapacity*1,1e3)}},{formType:"input",label:"本项目拟安装容量",required:!0,readonly:!0,name:"installedCapacityReckon",value:"",...p("kW"),backfill(e){this.value=s.divide(e.installedCapacityReckon*1,1e3)},getParam(e){e[this.name]=s.multiply(e[this.name],1e3)}},{formType:"input",label:"剩余备案容量",name:"surplusCapacity",placeholder:"自动计算",readonly:!0,value:"",...p("kW"),backfill(e){this.realValue=e.surplusCapacity,this.value=s.divide(e.surplusCapacity*1,1e3),h(["recordCertificateCapacity","installedCapacityReckon"],([c,o])=>{this.realValue=s.subtract(c,o),this.value=this.realValue*1})},getParam(e){e[this.name]=s.multiply(e[this.name],1e3)}},{...C(1,100),label:"备案证附件",name:"accessory",required:!0},{...C(999,100),label:"房屋权属证明",name:"propertyCertificate",required:!0,backfill(e){P.bind(L,this)(e)}}],ye={__name:"certificate",setup(e){const c=_({certificate:A});U(()=>{N(o)});async function o(){const i=m("order/get-record",{orderId:k()?.orderId}),{data:d}=await n.get(i);F(c,d)}async function l(){const i=O();return await n.post("order/put-record",i)}async function r(i){await n.post(m("approval/put-approval/bto/record",i))}async function t(i){await n.post("approval/do-approval/bto/record",i)}return V({getData:o,saveData:l,submitData:r,approvalData:t}),(i,d)=>{const b=w,I=g;return $(),B(S,null,[v(b,{form:D(c).certificate,class:"pt-3","group-class":"shadowC"},null,8,["form"]),v(I)],64)}}};export{ye as default};
