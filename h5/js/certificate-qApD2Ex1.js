import{_ as g}from"./vBtn-LXvsT-fh.js";import{_}from"./vantForm-CNH6TuWQ.js";import{m as w,a as m}from"./makeTitle-CzVkaK9t.js";import{f as T,s as a,c as b,h as n,G as u,b as F,z as q,e as x,y as O}from"./index-B7VWkQ_2.js";import{b as f,m as h}from"./makeSelect-CYTCxxsZ.js";import{l as R}from"./lodash-DhpMPSDc.js";import{q as p}from"./queryUrl-BTYYWpY7.js";import{x as s}from"./xe-utils-DXe260hc.js";import{w as y}from"./watchItem-DUEI_3OU.js";import{w as V}from"./wait-Dqho1LKt.js";import{m as C,a as P}from"./makeUpload-Du0F1yJj.js";import{m as N}from"./makeForm-BmsmFLmR.js";import{r as U}from"./runTime-DAjLGjV1.js";import{b as Z}from"./backfill-BoX-74Dj.js";import{e as $,aX as B,al as D,N as v,u as E,F as S}from"./@vue-ts87NNlE.js";import"./vant-BF4L1TGb.js";import"./@vant-NmgEisJw.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";const A=[w(T()?"备案证":"备案证及权属证明"),{formType:"input",label:"备案证类型",name:"recordType",required:!0,...f(),...h("recordType",[{text:"大备案证",value:1},{text:"精准备案",value:2}]),confirm(){a("recordCertificateCapacity","value","")}},{formType:"input",label:"项目公司",name:"companyId",required:!0,...f(),...h("companyId",[],"dynamic"),async backfill(e){if(e.orderRecordType=="RECORD_NP")this.isLink=!1,this.clickable=!1,this.value="",this.value="非项目公司备案无需填写备案证信息",this.reaonly=!0;else{const c=p("leaseLessor/getAuth",{pageNum:1,pageSize:999,orderId:b()?.orderId,recordType:e.orderRecordType}),{data:o}=await n.get(c),l=o.map(r=>({...r,text:`${r.code}, ${r.companyName}, ${r.areaId}`,disabled:r.disabled,value:r.code}));this.makeSelect(e.companyId,l),this.click=()=>{}}}},{formType:"input",name:"recordCertificateId",label:"备案证编码",realValue:"",value:"",required:!0,getParam(e){e[this.name]=this.realValue||this.value},blur(){a("recordCertificateCapacity",e=>{e.ref.focus()})},isLink:!0,rightIcon:"",readonly:!0,placeholder:"请直接输入或选择",inlineForm:[{slot:"right-icon",formType:"popup",name:"recordCertificateIdPop",show:!1,round:!0,position:"bottom",class:"h-[40vh]",closeOnClickOverlay:!0,inlineForm:[{slot:"default",formType:"pick",confirm(e){a("recordCertificateId","value",e.selectedOptions[0].text),a("recordCertificateId","realValue",e.selectedOptions[0].value),a("recordCertificateId","inlineForm.0.show",!1),a("accessory","inlineForm.0.value",[{url:u(e.selectedOptions[0].accessory)}]),a("recordCertificateCapacity","value",s.divide(e.selectedOptions[0].recordCertificateCapacity,1e3))},columns:[]}]},{slot:"button",name:"recordCertificateIdRightIcon",formType:"popover",show:!1,placement:"bottom-end",actions:[],style:{width:"250px",height:"40vh"},select(e){a("recordCertificateId","value",e.value),a("recordCertificateCapacity","value",s.divide(e.recordCertificateCapacity,1e3)),a("accessory","inlineForm.0.value",[{url:u(e.accessory)}])}}],async backfill(e){y(["companyId","recordType"],async([c,o])=>{const{data:l}=await n.post("record/list?isAuth=false",{recordType:o,companyId:c});if(o==1){this.value="",this.readonly=!0,this.rightIcon="",this.click=()=>{const t=F();this.inlineForm[0].show=t.btns.canEdit};const r=l.map(t=>({...t,text:t.recordCertificateId,value:t.recordCertificateId}));this.inlineForm[0].inlineForm[0].columns=r,a("surplusCapacity","hidden",!1)}else{const r=l.map(t=>({...t,text:t.recordCertificateId,value:t.recordCertificateId}));this.updateValue=t=>{const i=r.filter(d=>d.value.includes(t));this.inlineForm[1].show=new Boolean(i.length||t.length),this.inlineForm[1].actions=i,this.realValue=t,a("recordCertificateCapacity","value","")},this.value="",this.readonly=!1,this.click=()=>{this.inlineForm[1].show=flag.btns.canEdit},a("surplusCapacity","hidden",!0)}}),await V(2e3),a("recordCertificateId","value",e.recordCertificateId),a("recordCertificateId","realValue",e.recordCertificateId)}},{formType:"input",label:"备案证容量",name:"recordCertificateCapacity",value:"",required:!0,readonly:!1,...m("kW"),getParam(e){e[this.name]=s.multiply(e[this.name],1e3)},backfill(e){this.value=s.divide(e.recordCertificateCapacity*1,1e3)}},{formType:"input",label:"本项目拟安装容量",required:!0,readonly:!0,name:"installedCapacityReckon",value:"",...m("kW"),backfill(e){this.value=s.divide(e.installedCapacityReckon*1,1e3)},getParam(e){e[this.name]=s.multiply(e[this.name],1e3)}},{formType:"input",label:"剩余备案容量",name:"surplusCapacity",placeholder:"自动计算",readonly:!0,value:"",...m("kW"),backfill(e){this.realValue=e.surplusCapacity,this.value=s.divide(e.surplusCapacity*1,1e3),y(["recordCertificateCapacity","installedCapacityReckon"],([c,o])=>{this.realValue=s.subtract(c,o),this.value=this.realValue*1})},getParam(e){e[this.name]=s.multiply(e[this.name],1e3)}},{...C(1,100,"*"),label:"备案证附件",name:"accessory",required:!0},{...C(999,100),label:"房屋权属证明",name:"propertyCertificate",required:!0,onMounted(){q()=="TYZF_ZZD_ORG"?(this.label="通用资方法人项目无需在此处上传房屋权属证明",this.required=!1):(this.label="房屋权属证明",this.required=!0)},backfill(e){R.bind(P,this)(e)}}],be={__name:"certificate",setup(e){const c=N({certificate:A});$(()=>{U(o)});async function o(){const i=p("order/get-record",{orderId:b()?.orderId}),{data:d}=await n.get(i);Z(c,d)}async function l(){const i=O();return await n.post("order/put-record",i)}async function r(i){await n.post(p("approval/put-approval/bto/record",i))}async function t(i){await n.post("approval/do-approval/bto/record",i)}return x({getData:o,saveData:l,submitData:r,approvalData:t}),(i,d)=>{const k=_,I=g;return B(),D(S,null,[v(k,{form:E(c).certificate,class:"pt-3","group-class":"shadowC"},null,8,["form"]),v(I)],64)}}};export{be as default};
