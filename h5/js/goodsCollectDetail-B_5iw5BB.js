import{a as J,I as L,m as X,g as Y}from"./vant-BF4L1TGb.js";import{_ as H}from"./cell-CmFmTaK7.js";import{_ as K}from"./vantForm-CNH6TuWQ.js";import{_ as b}from"./vButton-BgoZqamI.js";import{m as N}from"./makeTitle-CzVkaK9t.js";import{c as y,h as D,j as C,E as W,s as r,g as F,_ as ee,e as te,y as E}from"./index-B7VWkQ_2.js";import{b as h,m as S}from"./makeSelect-CYTCxxsZ.js";import{l as m}from"./lodash-DhpMPSDc.js";import{q as $}from"./queryUrl-BTYYWpY7.js";import{m as ae}from"./makeDate-CQnJhoTh.js";import{m as se,a as oe}from"./makeUpload-Du0F1yJj.js";import"./xe-utils-DXe260hc.js";import{w as U}from"./watchItem-DUEI_3OU.js";import{o as ie}from"./openCode-CVv0KcZH.js";import{f as p,r as le,e as re,b3 as w,aX as R,al as M,N as l,u as T,bA as n,am as q,F as G,i as ne,b1 as me,aj as ce,V as I}from"./@vue-ts87NNlE.js";import{m as de}from"./makeForm-BmsmFLmR.js";import{b as A}from"./backfill-BoX-74Dj.js";import"./@vant-NmgEisJw.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./dayjs-DWD9bsSZ.js";const g=["manufacturer","supplier","specificationsModel"],pe=[{...N("收货信息"),onMounted(){const e=y();this.title+=`(${e.title})`,p(()=>{this.title="收货信息"})}},{formType:"input",readonly:!0,name:"impId",label:"收货单号",placeholder:"系统自动生成",value:"",onMounted(){p(()=>{this.value=""})}},{...h(),...S("consigneeStoId",[],"dynamic"),name:"consigneeStoId",label:"收货仓库",placeholder:"收货仓库",required:!0,async backfill(e){const a={stoType:y().deliveryType=="ORIGIN_TO_FIRST"?"ZY":"JMS"},{data:s}=await D.get($("sto/room-sto-type",a)),o=s.map(i=>({text:i.stoName,value:i.stoId}));o.find(i=>i.text==e[this.name])?.value,this.makeSelect(e[this.name],o)}},{...h(),...S("importType",[{value:"ORIGIN_TO_FIRST",text:"一级仓库入库供应商设备"},{value:"FIRST_TO_SECOND",text:"二级仓库收一级仓库设备"}]),name:"importType",label:"收货类型",required:!0},{formType:"input",name:"consigneeName",required:!0,label:"收货人",placeholder:"收货人",value:"",onMounted(){p(()=>{this.value=""})},backfill(e){const t=C();this.value=e[this.name]||t.name}},{formType:"input",name:"consigneePhone",label:"收货人电话",placeholder:"收货人电话",required:!0,value:"",onMounted(){p(()=>{this.value=""})},backfill(e){const t=C();this.value=e[this.name]||t.phone}},{...ae({name:"impTime"}),required:!0,label:"收货日期",placeholder:"收货日期",onMounted(){p(()=>{this.value=""})}},{formType:"input",label:"备注",placeholder:"请输入备注",value:"",colon:!0,inputAlign:"left",name:"remark",onMounted(){p(()=>{this.value=""})}}],ue=[{...N("收货单附件")},{...se(999,100,void 0,void 0,void 0,!1),label:"收货单签名",name:"importImages",required:!0,backfill(e){m.bind(oe,this)(e)},getParam(e){e[this.name]=[e[this.name].map(t=>W(t))].flat()}}],fe=[{...N("设备信息")},{formType:"",name:"deviceSlot",customSlot:"deviceSlot",tab:"ZUJIAN",async backfill(e,t=!0){if(t){this.tabs.forEach(a=>{const s=m.get(e,"stoDeviceMap."+a.name,[]);a.data=s}),this.set(m.get(e,"stoDeviceMap.ZUJIAN",[]));for(const a of this.tabs)for(const s of g){const{data:o}=await D.post($("/sto/device-args/list",{option:s}),{deviceType:a.name});a[s].columns=o.map(i=>({text:m.get(i,s,i),value:m.get(i,s,i),...i})),r(s,i=>i.set(a[s]))}}else this.tabs.forEach(a=>{const s=m.get(e,a.name,[]);a.data.length=0,a.data.push(...s)}),this.set(m.get(e,this.tab,[]))},tabs:[{title:"组件",name:"ZUJIAN",value:"",data:[],manufacturer:{value:"",columns:[]},supplier:{value:"",columns:[]},specificationsModel:{value:"",columns:[]}},{title:"逆变器",name:"NBQ",value:"",data:[],manufacturer:{value:"",columns:[]},supplier:{value:"",columns:[]},specificationsModel:{value:"",columns:[]}},{title:"采集器",name:"CJQ",value:"",data:[],manufacturer:{value:"",columns:[]},supplier:{value:"",columns:[]},specificationsModel:{value:"",columns:[]}},{title:"配电箱",name:"PDX",value:"",data:[],manufacturer:{value:"",columns:[]},supplier:{value:"",columns:[]},specificationsModel:{value:"",columns:[]}}],getParam(e){const s=y().deliveryType=="ORIGIN_TO_FIRST"?"deviceList":"deviceInfos",o=["deviceId","manufacturer","manufacturerShortName","manufacturerShortCode","supplier","specificationsModel","specs","deviceType"];e[s]=this.tabs.map(i=>i.data.map(u=>m.pick(u,o))).flat(),e.state=y()?.state},add(e){const t={},a=this.tabs.findIndex(o=>o.name==this.tab);t.deviceId=this.tabs[a].value;for(const o of g){t[o]=this.tabs[a][o].value;const i=this.tabs[a][o].columns.find(u=>u[o]==t[o]);m.merge(t,i)}t.deviceType=this.tab;const s=[e||t].flat();this.tabs[a].data.unshift(...s),r("table","data",this.tabs[a].data)},uniq(){const e=this.tabs.findIndex(t=>t.name==this.tab);this.tabs[e].data=m.uniqBy(this.tabs[e].data,"deviceId"),r("table","data",this.tabs[e].data)},set(e){const t=this.tabs.findIndex(a=>a.name==this.tab);this.tabs[t].data=e,r("table","data",this.tabs[t].data)}}],ve=[{...h(),...S("manufacturer",[],"dynamic"),name:"manufacturer",label:"生产厂家",placeholder:"请选择",set(e){this.makeSelect(e.value,e.columns)},backfill(){U(this.name,e=>{r("deviceSlot",t=>{const a=t.tabs.findIndex(s=>s.name==t.tab);t.tabs[a][this.name].value=e})})}},{...h(),...S("supplier",[],"dynamic"),name:"supplier",label:"供应商",placeholder:"请选择",set(e){this.makeSelect(e.value,e.columns)},backfill(){U(this.name,e=>{r("deviceSlot",t=>{const a=t.tabs.findIndex(s=>s.name==t.tab);t.tabs[a][this.name].value=e})})}},{...h(),...S("specificationsModel",[],"dynamic"),name:"specificationsModel",label:"规格型号",placeholder:"请选择",set(e){this.makeSelect(e.value,e.columns)},backfill(){U(this.name,e=>{r("deviceSlot",t=>{const a=t.tabs.findIndex(s=>s.name==t.tab);t.tabs[a][this.name].value=e})})}},{formType:"input",value:"",name:"ZUJIAN",label:"设备编号",rightIcon:"scan",clearable:!0,onMounted(){p(()=>{this.value=""})},getParam(e){delete e.orderId,delete e.manufacturer,delete e.supplier,delete e.specificationsModel,delete e[this.name]},clickRightIcon(){if(!g.every(a=>F(a,"value"))){J({message:"请先填写生产厂家、供应商、规格型号",className:"!bg-[red]"});return}let t={};r("deviceSlot",a=>{const s=a.tabs.findIndex(o=>o.name==this.name);for(const o of g)t[o]=a.tabs[s][o].value}),ie(a=>{r("deviceSlot",s=>{const o=s.tabs.findIndex(i=>i.name==this.name);s.tabs[o].data.unshift([a].flat().map(i=>({deviceId:i,...t})))})})},updateValue(e){r("deviceSlot",t=>{const a=t.tabs.findIndex(s=>s.name==this.name);t.tabs[a].value=e})},change(e){r("deviceSlot",t=>{t.tab=e;const a=t.tabs.findIndex(s=>s.name==e);this.value=t.tabs[a].value,this.name=t.tabs[a].name,r("table","data",t.tabs[a].data);for(const s of g)r(s,o=>{o.set(t.tabs[a][s])})})}},{customSlot:"button",add(){r("deviceSlot",e=>e.add())},uniq(){r("deviceSlot",e=>e.uniq())},reset(){const e=F("deviceSlot","tab");r(e,"value","")}},{formType:"",name:"table",customSlot:"table",data:[],remove(e){const t=this.data.findIndex(a=>a.deviceId==e.deviceId);this.data.splice(t,1),r("deviceSlot",a=>{a.set(this.data)})}}],_e={show:{ORIGIN_TO_FIRST:{getDataUrl:"sto/import-base/origin-firststockroom",saveUrl:"sto/import-base/origin-firststockroom",deliveryType:"ORIGIN_TO_FIRST"},FIRST_TO_SITE:{getDataUrl:"sto/import-base/show/import-part",saveUrl:"sto/import-base/add/import-part",deliveryType:"FIRST_TO_SITE"},FIRST_TO_SECOND:{getDataUrl:"sto/import-base/show/import-part",saveUrl:"sto/import-base/add/import-part",deliveryType:"FIRST_TO_SECOND"},SECOND_TO_SITE:{getDataUrl:"sto/import-base/show/import-part",saveUrl:"sto/import-base/add/import-part",deliveryType:"SECOND_TO_SITE"}},noshow:{ORIGIN_TO_FIRST:{getDataUrl:"sto/import-base/origin-firststockroom",saveUrl:"sto/import-base/origin-firststockroom",deliveryType:"ORIGIN_TO_FIRST"},FIRST_TO_SITE:{getDataUrl:"sto/import-base/show/import-part-init",saveUrl:"sto/import-base/add/import-part",deliveryType:"FIRST_TO_SITE"},FIRST_TO_SECOND:{getDataUrl:"sto/import-base/show/import-part-init",saveUrl:"sto/import-base/add/import-part",deliveryType:"FIRST_TO_SECOND"},SECOND_TO_SITE:{getDataUrl:"sto/import-base/show/import-part-init",saveUrl:"sto/import-base/add/import-part",deliveryType:"SECOND_TO_SITE"}},detail:{ORIGIN_TO_FIRST:{getDataUrl:"sto/import-base/origin-firststockroom",saveUrl:"sto/import-base/origin-firststockroom",deliveryType:"ORIGIN_TO_FIRST"},FIRST_TO_SITE:{getDataUrl:"sto/import-base/show/direct-import",saveUrl:"sto/import-base/add/direct-import",deliveryType:"FIRST_TO_SITE"},FIRST_TO_SECOND:{getDataUrl:"sto/import-base/show/direct-import",saveUrl:"sto/import-base/add/direct-import",deliveryType:"FIRST_TO_SECOND"},SECOND_TO_SITE:{getDataUrl:"sto/import-base/show/direct-import",saveUrl:"sto/import-base/add/direct-import",deliveryType:"SECOND_TO_SITE"}},nodetail:{ORIGIN_TO_FIRST:{getDataUrl:"sto/import-base/origin-firststockroom",saveUrl:"sto/import-base/origin-firststockroom",deliveryType:"ORIGIN_TO_FIRST"},FIRST_TO_SITE:{getDataUrl:"sto/import-base/show/direct-import-init",saveUrl:"sto/import-base/add/direct-import",deliveryType:"FIRST_TO_SITE"},FIRST_TO_SECOND:{getDataUrl:"sto/import-base/show/direct-import-init",saveUrl:"sto/import-base/add/direct-import",deliveryType:"FIRST_TO_SECOND"},SECOND_TO_SITE:{getDataUrl:"sto/import-base/show/direct-import-init",saveUrl:"sto/import-base/add/direct-import",deliveryType:"SECOND_TO_SITE"}}},be={class:"grid grid-cols-3 gap-2 p-2"},Te={class:"flex justify-evenly py-2"},Ie={__name:"goodsCollectDetail",setup(e){let t=de({impGoods:pe,importImages:ue,impDeviceInfo:fe,impDeviceContent:ve});const a=le("ZUJIAN"),s=y(),o=_e[(s.state?"":"no")+(s.acceptType?"show":"detail")][s.deliveryType];async function i(){const{data:c}=await D.get(`${o.getDataUrl}/${s.expId}`);A(t,c)}async function u(){const c=E();if(c.consigneeStoId)return await D.post(o.saveUrl,c);J("收货仓库暂存确认都是必填")}async function B(){await u(),E()}function P(c){t.impDeviceContent[3].change(c)}return re(()=>{s.expId?i():A(t,{})}),te({getData:i}),(c,k)=>{const O=K,x=w("vxe-column"),v=H,V=L,Z=w("vxe-table"),j=X,z=Y;return R(),M(G,null,[l(O,{form:T(t).impGoods,class:"pt-3","group-class":"shadowC"},null,8,["form"]),l(O,{form:T(t).importImages,class:"pt-3","group-class":"shadowC"},null,8,["form"]),l(O,{form:T(t).impDeviceInfo,class:"pt-3","group-class":"shadowC"},{deviceSlot:n(({slot:Q})=>[l(z,{class:"flex-1 flex flex-col",active:T(a),"onUpdate:active":k[0]||(k[0]=_=>ne(a)?a.value=_:null),background:"#fff","line-width":"80px",color:"#ffab30",onChange:P},{default:n(()=>[(R(!0),M(G,null,me(Q.tabs,_=>(R(),ce(j,{title:_.title,name:_.name,key:_.name},{default:n(()=>[l(O,{form:T(t).impDeviceContent,class:"m-0"},{button:n(({slot:f})=>[q("div",be,[l(b,{onClick:()=>f.add(),size:"mini"},{default:n(()=>[I("添加")]),_:2},1032,["onClick"]),l(b,{onClick:()=>f.uniq(),size:"mini",class:"!bg-[red]"},{default:n(()=>[I("去重")]),_:2},1032,["onClick"]),l(b,{onClick:()=>f.reset(),size:"mini",class:"!bg-[gray]"},{default:n(()=>[I("重置")]),_:2},1032,["onClick"])])]),table:n(({slot:f})=>[l(Z,{data:f.data,align:"center","header-align":"center","max-height":"400"},{default:n(()=>[l(x,{type:"seq",width:"50",title:"序号"}),l(x,{field:"value",title:"详细信息"},{default:n(({row:d})=>[l(v,{title:"设备编码",value:d.deviceId},null,8,["value"]),l(v,{title:"生产厂家",value:d.manufacturer},null,8,["value"]),l(v,{title:"供应商",value:d.supplier},null,8,["value"]),l(v,{title:"规格型号",value:d.specificationsModel},null,8,["value"]),l(v,{title:"错误信息",value:d.valid,titleClass:"!text-[red] !w-auto !flex-none",valueClass:"text-red"},null,8,["value"])]),_:1}),l(x,{field:"",title:"操作",width:"50"},{default:n(({row:d})=>[l(V,{name:"cross",color:"red",onClick:he=>f.remove(d)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["form"])]),_:2},1032,["title","name"]))),128))]),_:2},1032,["active"])]),_:1},8,["form"]),q("div",Te,[l(b,{class:"w-[30%]",onClick:u},{default:n(()=>[I("暂存")]),_:1}),l(b,{class:"w-[30%]",onClick:B},{default:n(()=>[I("确认")]),_:1})])],64)}}},et=ee(Ie,[["__scopeId","data-v-07322ce8"]]);export{et as default};
