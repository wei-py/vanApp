import{a as J,t as L,r as X,m as Y}from"./vant-BjNCsb4u.js";import{_ as H}from"./cell-Co-cOPq1.js";import{m as K,_ as W}from"./makeForm-zWuhmNjJ.js";import{_ as b}from"./vButton-wHtwW-5Z.js";import{m as N,b as C}from"./backfill-BgFTSTN7.js";import{c as y,h as D,j as F,D as ee,s as n,g as E,_ as te,e as ae,x as w}from"./index-C9aRjUQ6.js";import{b as h,m as S}from"./makeSelect-DifxRlPP.js";import{l as c}from"./lodash-DhpMPSDc.js";import{q as $}from"./queryUrl-BTYYWpY7.js";import{m as se}from"./makeDate-FXuHvIN1.js";import{m as oe,a as ie}from"./makeUpload-JSFo0Tsd.js";import"./xe-utils-DXe260hc.js";import{w as U}from"./watchItem-CG54lpty.js";import{o as le}from"./openCode-8Sl3A8FU.js";import{f as p,r as ne,e as re,b3 as M,aX as R,al as q,N as l,u as T,bA as r,am as G,F as A,i as ce,b1 as me,aj as de,V as I}from"./@vue-ts87NNlE.js";import"./@vant-NmgEisJw.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./dayjs-DWD9bsSZ.js";const g=["manufacturer","supplier","specificationsModel"],pe=[{...N("收货信息"),onMounted(){const e=y();this.title+=`(${e.title})`,p(()=>{this.title="收货信息"})}},{formType:"input",readonly:!0,name:"impId",label:"收货单号",placeholder:"系统自动生成",value:"",onMounted(){p(()=>{this.value=""})}},{...h(),...S("consigneeStoId",[],"dynamic"),name:"consigneeStoId",label:"收货仓库",placeholder:"收货仓库",required:!0,async backfill(e){const a={stoType:y().deliveryType=="ORIGIN_TO_FIRST"?"ZY":"JMS"},{data:s}=await D.get($("sto/room-sto-type",a)),o=s.map(i=>({text:i.stoName,value:i.stoId}));o.find(i=>i.text==e[this.name])?.value,this.makeSelect(e[this.name],o)}},{...h(),...S("importType",[{value:"ORIGIN_TO_FIRST",text:"一级仓库入库供应商设备"},{value:"FIRST_TO_SECOND",text:"二级仓库收一级仓库设备"}]),name:"importType",label:"收货类型",required:!0},{formType:"input",name:"consigneeName",required:!0,label:"收货人",placeholder:"收货人",value:"",onMounted(){p(()=>{this.value=""})},backfill(e){const t=F();this.value=e[this.name]||t.name}},{formType:"input",name:"consigneePhone",label:"收货人电话",placeholder:"收货人电话",required:!0,value:"",onMounted(){p(()=>{this.value=""})},backfill(e){const t=F();this.value=e[this.name]||t.phone}},{...se({name:"impTime"}),required:!0,label:"收货日期",placeholder:"收货日期",onMounted(){p(()=>{this.value=""})}},{formType:"input",label:"备注",placeholder:"请输入备注",value:"",colon:!0,inputAlign:"left",name:"remark",onMounted(){p(()=>{this.value=""})}}],ue=[{...N("收货单附件")},{...oe(999,100,void 0,void 0,void 0,!1),label:"收货单签名",name:"importImages",required:!0,backfill(e){c.bind(ie,this)(e)},getParam(e){e[this.name]=[e[this.name].map(t=>ee(t))].flat()}}],fe=[{...N("设备信息")},{formType:"",name:"deviceSlot",customSlot:"deviceSlot",tab:"ZUJIAN",async backfill(e,t=!0){if(t){this.tabs.forEach(a=>{const s=c.get(e,"stoDeviceMap."+a.name,[]);a.data=s}),this.set(c.get(e,"stoDeviceMap.ZUJIAN",[]));for(const a of this.tabs)for(const s of g){const{data:o}=await D.post($("/sto/device-args/list",{option:s}),{deviceType:a.name});a[s].columns=o.map(i=>({text:c.get(i,s,i),value:c.get(i,s,i),...i})),n(s,i=>i.set(a[s]))}}else this.tabs.forEach(a=>{const s=c.get(e,a.name,[]);a.data.length=0,a.data.push(...s)}),this.set(c.get(e,this.tab,[]))},tabs:[{title:"组件",name:"ZUJIAN",value:"",data:[],manufacturer:{value:"",columns:[]},supplier:{value:"",columns:[]},specificationsModel:{value:"",columns:[]}},{title:"逆变器",name:"NBQ",value:"",data:[],manufacturer:{value:"",columns:[]},supplier:{value:"",columns:[]},specificationsModel:{value:"",columns:[]}},{title:"采集器",name:"CJQ",value:"",data:[],manufacturer:{value:"",columns:[]},supplier:{value:"",columns:[]},specificationsModel:{value:"",columns:[]}},{title:"配电箱",name:"PDX",value:"",data:[],manufacturer:{value:"",columns:[]},supplier:{value:"",columns:[]},specificationsModel:{value:"",columns:[]}}],getParam(e){const s=y().deliveryType=="ORIGIN_TO_FIRST"?"deviceList":"deviceInfos",o=["deviceId","manufacturer","manufacturerShortName","manufacturerShortCode","supplier","specificationsModel","specs","deviceType"];e[s]=this.tabs.map(i=>i.data.map(u=>c.pick(u,o))).flat(),e.state=y()?.state},add(e){const t={},a=this.tabs.findIndex(o=>o.name==this.tab);t.deviceId=this.tabs[a].value;for(const o of g){t[o]=this.tabs[a][o].value;const i=this.tabs[a][o].columns.find(u=>u[o]==t[o]);c.merge(t,i)}t.deviceType=this.tab;const s=[e||t].flat();this.tabs[a].data.unshift(...s),n("table","data",this.tabs[a].data)},uniq(){const e=this.tabs.findIndex(t=>t.name==this.tab);this.tabs[e].data=c.uniqBy(this.tabs[e].data,"deviceId"),n("table","data",this.tabs[e].data)},set(e){const t=this.tabs.findIndex(a=>a.name==this.tab);this.tabs[t].data=e,n("table","data",this.tabs[t].data)}}],ve=[{...h(),...S("manufacturer",[],"dynamic"),name:"manufacturer",label:"生产厂家",placeholder:"请选择",set(e){this.makeSelect(e.value,e.columns)},backfill(){U(this.name,e=>{n("deviceSlot",t=>{const a=t.tabs.findIndex(s=>s.name==t.tab);t.tabs[a][this.name].value=e})})}},{...h(),...S("supplier",[],"dynamic"),name:"supplier",label:"供应商",placeholder:"请选择",set(e){this.makeSelect(e.value,e.columns)},backfill(){U(this.name,e=>{n("deviceSlot",t=>{const a=t.tabs.findIndex(s=>s.name==t.tab);t.tabs[a][this.name].value=e})})}},{...h(),...S("specificationsModel",[],"dynamic"),name:"specificationsModel",label:"规格型号",placeholder:"请选择",set(e){this.makeSelect(e.value,e.columns)},backfill(){U(this.name,e=>{n("deviceSlot",t=>{const a=t.tabs.findIndex(s=>s.name==t.tab);t.tabs[a][this.name].value=e})})}},{formType:"input",value:"",name:"ZUJIAN",label:"设备编号",rightIcon:"scan",clearable:!0,onMounted(){p(()=>{this.value=""})},getParam(e){delete e.orderId,delete e.manufacturer,delete e.supplier,delete e.specificationsModel,delete e[this.name]},clickRightIcon(){if(!g.every(a=>E(a,"value"))){J({message:"请先填写生产厂家、供应商、规格型号",className:"!bg-[red]"});return}let t={};n("deviceSlot",a=>{const s=a.tabs.findIndex(o=>o.name==this.name);for(const o of g)t[o]=a.tabs[s][o].value}),le(a=>{n("deviceSlot",s=>{const o=s.tabs.findIndex(i=>i.name==this.name);s.tabs[o].data.unshift([a].flat().map(i=>({deviceId:i,...t})))})})},updateValue(e){n("deviceSlot",t=>{const a=t.tabs.findIndex(s=>s.name==this.name);t.tabs[a].value=e})},change(e){n("deviceSlot",t=>{t.tab=e;const a=t.tabs.findIndex(s=>s.name==e);this.value=t.tabs[a].value,this.name=t.tabs[a].name,n("table","data",t.tabs[a].data);for(const s of g)n(s,o=>{o.set(t.tabs[a][s])})})}},{customSlot:"button",add(){n("deviceSlot",e=>e.add())},uniq(){n("deviceSlot",e=>e.uniq())},reset(){const e=E("deviceSlot","tab");n(e,"value","")}},{formType:"",name:"table",customSlot:"table",data:[],remove(e){const t=this.data.findIndex(a=>a.deviceId==e.deviceId);this.data.splice(t,1),n("deviceSlot",a=>{a.set(this.data)})}}],_e={show:{ORIGIN_TO_FIRST:{getDataUrl:"sto/import-base/origin-firststockroom",saveUrl:"sto/import-base/origin-firststockroom",deliveryType:"ORIGIN_TO_FIRST"},FIRST_TO_SITE:{getDataUrl:"sto/import-base/show/import-part",saveUrl:"sto/import-base/add/import-part",deliveryType:"FIRST_TO_SITE"},FIRST_TO_SECOND:{getDataUrl:"sto/import-base/show/import-part",saveUrl:"sto/import-base/add/import-part",deliveryType:"FIRST_TO_SECOND"},SECOND_TO_SITE:{getDataUrl:"sto/import-base/show/import-part",saveUrl:"sto/import-base/add/import-part",deliveryType:"SECOND_TO_SITE"}},noshow:{ORIGIN_TO_FIRST:{getDataUrl:"sto/import-base/origin-firststockroom",saveUrl:"sto/import-base/origin-firststockroom",deliveryType:"ORIGIN_TO_FIRST"},FIRST_TO_SITE:{getDataUrl:"sto/import-base/show/import-part-init",saveUrl:"sto/import-base/add/import-part",deliveryType:"FIRST_TO_SITE"},FIRST_TO_SECOND:{getDataUrl:"sto/import-base/show/import-part-init",saveUrl:"sto/import-base/add/import-part",deliveryType:"FIRST_TO_SECOND"},SECOND_TO_SITE:{getDataUrl:"sto/import-base/show/import-part-init",saveUrl:"sto/import-base/add/import-part",deliveryType:"SECOND_TO_SITE"}},detail:{ORIGIN_TO_FIRST:{getDataUrl:"sto/import-base/origin-firststockroom",saveUrl:"sto/import-base/origin-firststockroom",deliveryType:"ORIGIN_TO_FIRST"},FIRST_TO_SITE:{getDataUrl:"sto/import-base/show/direct-import",saveUrl:"sto/import-base/add/direct-import",deliveryType:"FIRST_TO_SITE"},FIRST_TO_SECOND:{getDataUrl:"sto/import-base/show/direct-import",saveUrl:"sto/import-base/add/direct-import",deliveryType:"FIRST_TO_SECOND"},SECOND_TO_SITE:{getDataUrl:"sto/import-base/show/direct-import",saveUrl:"sto/import-base/add/direct-import",deliveryType:"SECOND_TO_SITE"}},nodetail:{ORIGIN_TO_FIRST:{getDataUrl:"sto/import-base/origin-firststockroom",saveUrl:"sto/import-base/origin-firststockroom",deliveryType:"ORIGIN_TO_FIRST"},FIRST_TO_SITE:{getDataUrl:"sto/import-base/show/direct-import-init",saveUrl:"sto/import-base/add/direct-import",deliveryType:"FIRST_TO_SITE"},FIRST_TO_SECOND:{getDataUrl:"sto/import-base/show/direct-import-init",saveUrl:"sto/import-base/add/direct-import",deliveryType:"FIRST_TO_SECOND"},SECOND_TO_SITE:{getDataUrl:"sto/import-base/show/direct-import-init",saveUrl:"sto/import-base/add/direct-import",deliveryType:"SECOND_TO_SITE"}}},be={class:"grid grid-cols-3 gap-2 p-2"},Te={class:"flex justify-evenly py-2"},Ie={__name:"goodsCollectDetail",setup(e){let t=K({impGoods:pe,importImages:ue,impDeviceInfo:fe,impDeviceContent:ve});const a=ne("ZUJIAN"),s=y(),o=_e[(s.state?"":"no")+(s.acceptType?"show":"detail")][s.deliveryType];async function i(){const{data:m}=await D.get(`${o.getDataUrl}/${s.expId}`);C(t,m)}async function u(){const m=w();if(m.consigneeStoId)return await D.post(o.saveUrl,m);J("收货仓库暂存确认都是必填")}async function B(){await u(),w()}function P(m){t.impDeviceContent[3].change(m)}return re(()=>{s.expId?i():C(t,{})}),ae({getData:i}),(m,x)=>{const O=W,k=M("vxe-column"),v=H,V=L,Z=M("vxe-table"),j=X,z=Y;return R(),q(A,null,[l(O,{form:T(t).impGoods,class:"pt-3","group-class":"shadowC"},null,8,["form"]),l(O,{form:T(t).importImages,class:"pt-3","group-class":"shadowC"},null,8,["form"]),l(O,{form:T(t).impDeviceInfo,class:"pt-3","group-class":"shadowC"},{deviceSlot:r(({slot:Q})=>[l(z,{class:"flex-1 flex flex-col",active:T(a),"onUpdate:active":x[0]||(x[0]=_=>ce(a)?a.value=_:null),background:"#fff","line-width":"80px",color:"#ffab30",onChange:P},{default:r(()=>[(R(!0),q(A,null,me(Q.tabs,_=>(R(),de(j,{title:_.title,name:_.name,key:_.name},{default:r(()=>[l(O,{form:T(t).impDeviceContent,class:"m-0"},{button:r(({slot:f})=>[G("div",be,[l(b,{onClick:()=>f.add(),size:"mini"},{default:r(()=>[I("添加")]),_:2},1032,["onClick"]),l(b,{onClick:()=>f.uniq(),size:"mini",class:"!bg-[red]"},{default:r(()=>[I("去重")]),_:2},1032,["onClick"]),l(b,{onClick:()=>f.reset(),size:"mini",class:"!bg-[gray]"},{default:r(()=>[I("重置")]),_:2},1032,["onClick"])])]),table:r(({slot:f})=>[l(Z,{data:f.data,align:"center","header-align":"center","max-height":"400"},{default:r(()=>[l(k,{type:"seq",width:"50",title:"序号"}),l(k,{field:"value",title:"详细信息"},{default:r(({row:d})=>[l(v,{title:"设备编码",value:d.deviceId},null,8,["value"]),l(v,{title:"生产厂家",value:d.manufacturer},null,8,["value"]),l(v,{title:"供应商",value:d.supplier},null,8,["value"]),l(v,{title:"规格型号",value:d.specificationsModel},null,8,["value"]),l(v,{title:"错误信息",value:d.valid,titleClass:"!text-[red] !w-auto !flex-none",valueClass:"text-red"},null,8,["value"])]),_:1}),l(k,{field:"",title:"操作",width:"50"},{default:r(({row:d})=>[l(V,{name:"cross",color:"red",onClick:he=>f.remove(d)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["form"])]),_:2},1032,["title","name"]))),128))]),_:2},1032,["active"])]),_:1},8,["form"]),G("div",Te,[l(b,{class:"w-[30%]",onClick:u},{default:r(()=>[I("暂存")]),_:1}),l(b,{class:"w-[30%]",onClick:B},{default:r(()=>[I("确认")]),_:1})])],64)}}},Ke=te(Ie,[["__scopeId","data-v-07322ce8"]]);export{Ke as default};
