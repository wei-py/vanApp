import{_ as w}from"./vButton-DxiVszE8.js";import{a as J,y as $,o as j,j as Z}from"./vant-xiv0EFx3.js";import{_ as z}from"./cell-YEn3VQgG.js";import{m as Q,_ as X}from"./makeForm-b9Rv_zTa.js";import{m as C,b as L}from"./backfill-Knvieq5z.js";import{c as f,f as D,B as G,s as o,g as H,_ as K,e as W,h as x,v as M}from"./index-BiU8ePZK.js";import{m as Y}from"./makeDate-B6JNL--b.js";import{b as ee,m as ae}from"./makeSelect-VTItfMq-.js";import{l as g}from"./lodash-C1iNKp1x.js";import{m as te,a as ne}from"./makeUpload-Vv_MC7yY.js";import"./xe-utils-D22uZPtC.js";import{o as oe}from"./openCode-BdtLXXCY.js";import{f as m,c as S,r as le,e as se,b3 as O,aX as k,al as T,N as n,u as h,bA as s,am as ie,F as U,i as de,b1 as ce,aj as re,V as _,ak as ue}from"./@vue-BHA94vdH.js";import"./@vant-BMzV8Unt.js";import"./class-rRG2y2aF.js";import"./pinia-BOLtM30a.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-BQWAt7JZ.js";import"./@vueuse-BYPNFz0v.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-DYFNhZJM.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus--RpDJ8QK.js";import"./vue3-photo-preview-Byv7Qnko.js";import"./vxe-table-CbQjGgi9.js";import"./dom-zindex-GlLoxNk1.js";import"./dayjs-19KvoO9f.js";import"./queryUrl-CUkA5NKU.js";const me=[{...C("退货信息"),onMounted(){const e=f();this.title+=`(${e.title})`,m(()=>{this.title="退货信息"})}},{formType:"input",readonly:!0,name:"backId",label:"退货单号",placeholder:"系统自动生成",value:"",onMounted(){m(()=>{this.value=""})}},{...Y({name:"backApplyTime"}),required:!0,label:"退货日期",placeholder:"退货日期",readonly:!0,onMounted(){m(()=>{this.value=""})}},{...ee(),...ae("backType",[{value:"FIRST_TO_SECOND",text:"二级仓库退一级仓库"},{value:"FIRST_TO_SITE",text:"现场退一级仓库"},{value:"SECOND_TO_SITE",text:"现场退二级仓库"}]),name:"backType",label:"退货类型",required:!0},{formType:"input",name:"backName",required:!0,readonly:!0,label:"退货人",placeholder:"退货人",value:"",onMounted(){m(()=>{this.value=""})},backfill(e){const a=D();this.value=e[this.name]||a.name}},{formType:"input",name:"backPhone",label:"退货人电话",readonly:!0,placeholder:"退货人电话",required:!0,value:"",onMounted(){m(()=>{this.value=""})},backfill(e){const a=D();this.value=e[this.name]||a.phone}},{formType:"input",hidden:S(()=>f()?.backType!="FIRST_TO_SECOND"),name:"backStoName",label:"退货仓库",placeholder:"退货仓库",required:!0,value:""},{formType:"input",name:"backAddress",readonly:!0,label:"退货地址",placeholder:"退货地址",required:!0,value:""},{formType:"input",name:"consigneeName",readonly:!0,label:"收货人",placeholder:"收货人",required:!0,value:""},{formType:"input",name:"consigneePhone",readonly:!0,label:"收货人电话",placeholder:"收货人电话",required:!0,value:""},{formType:"input",name:"consigneeStoName",readonly:!0,label:"收货仓库",placeholder:"收货仓库",required:!0,value:""},{formType:"input",name:"deliveryAddress",label:"收货地址",readonly:!0,placeholder:"收货地址",required:!0,value:""},{formType:"input",label:"备注",placeholder:"请输入备注",value:"",colon:!0,inputAlign:"left",name:"remark",onMounted(){m(()=>{this.value=""})}}],pe=[{...C("退货单附件")},{...te(999,100,void 0,void 0,void 0,!1),label:"退货单签名",name:"exportImages",required:!0,backfill(e){g.bind(ne,this)(e)},getParam(e){e[this.name]=[e[this.name].map(a=>G(a))].flat()}}],fe=[{...C("设备信息")},{formType:"",name:"deviceSlot",customSlot:"deviceSlot",tab:"ZUJIAN",backfill(e,a=!0){a?(this.tabs.forEach(t=>{const l=g.get(e,"deviceResVoMap."+t.name,[]);t.data=l}),this.set(g.get(e,"deviceResVoMap.ZUJIAN",[]))):(this.tabs.forEach(t=>{const l=g.get(e,t.name,[]);t.data.length=0,t.data.push(...l)}),this.set(e[this.tab]))},tabs:[{title:"组件",name:"ZUJIAN",value:"",data:[]},{title:"逆变器",name:"NBQ",value:"",data:[]},{title:"采集器",name:"CJQ",value:"",data:[]},{title:"配电箱",name:"PDX",value:"",data:[]}],getParam(e){e.deviceInfos=this.tabs.map(a=>a.data.map(t=>t.deviceId)).flat(2),e.state=f()?.state,delete e.orderId},add(e){const a=this.tabs.findIndex(p=>p.name==this.tab),t=this.tabs[a].value,l=[e||t].flat().map(p=>({deviceId:p}));this.tabs[a].data.unshift(...l),o("table","data",this.tabs[a].data)},uniq(){const e=this.tabs.findIndex(a=>a.name==this.tab);this.tabs[e].data=g.uniqBy(this.tabs[e].data,"deviceId"),o("table","data",this.tabs[e].data)},set(e){const a=this.tabs.findIndex(t=>t.name==this.tab);this.tabs[a].data=e,o("table","data",this.tabs[a].data)}}],be=[{formType:"input",value:"",hidden:S(()=>f()?.backType!="FIRST_TO_SECOND"),name:"ZUJIAN",label:"设备编号",rightIcon:"scan",onMounted(){m(()=>{this.value=""})},getParam(e){delete e[this.name]},rightIconClick(){oe(e=>{o("deviceSlot",a=>{const t=a.tabs.findIndex(l=>l.name==this.name);a.tabs[t].data.unshift([e].flat())})})},updateValue(e){o("deviceSlot",a=>{const t=a.tabs.findIndex(l=>l.name==this.name);a.tabs[t].value=e})},change(e){o("deviceSlot",a=>{a.tab=e;const t=a.tabs.findIndex(l=>l.name==e);this.value=a.tabs[t].value,this.name=a.tabs[t].name,o("table","data",a.tabs[t].data)})}},{customSlot:"button",hidden:S(()=>f()?.backType!="FIRST_TO_SECOND"),add(){o("deviceSlot",e=>e.add())},uniq(){o("deviceSlot",e=>e.uniq())},reset(){const e=H("deviceSlot","tab");o(e,"value","")}},{formType:"",name:"table",customSlot:"table",data:[],remove(e){const a=this.data.findIndex(t=>t.deviceId==e.deviceId);this.data.splice(a,1),o("deviceSlot",t=>{t.set(this.data)})}}],ve={key:0,class:"grid grid-cols-3 gap-2 p-2"},he={class:"flex justify-evenly py-2"},_e={__name:"goodsRejectDetail",setup(e){let a=Q({goods:me,exportImages:pe,deviceInfo:fe,deviceContent:be});const t=le("ZUJIAN"),l=f();async function p(){const{data:i}=await x.get(`sto/stoBack/show/back-device-backId/${l.backId}`);console.log(i),L(a,i)}async function N(){const i=M();try{const{data:d}=await x.post("/sto/export-base/add",i);return o("expId","value",d),d}catch(d){o("deviceSlot",c=>c.backfill(d.data,!1))}}async function A(){await N();const i=M();if(i.state="1",!i.deviceInfos.length){J({message:"收货设备不能为空",className:"!bg-red-500"});return}try{const{data:d}=await x.post("/sto/export-base/add",i);o("expId","value",d)}catch(d){o("deviceSlot",c=>c.backfill(d.data,!1))}}function B(i){a.deviceContent[0].change(i)}return se(()=>{p()}),W({getData:p}),(i,d)=>{const c=X,y=w,I=O("vxe-column"),b=z,E=$,F=O("vxe-table"),R=j,V=Z,q=w;return k(),T(U,null,[n(c,{form:h(a).goods,class:"pt-3","group-class":"shadowC"},null,8,["form"]),n(c,{form:h(a).exportImages,class:"pt-3","group-class":"shadowC"},null,8,["form"]),n(c,{form:h(a).deviceInfo,class:"pt-3","group-class":"shadowC"},{deviceSlot:s(({slot:P})=>[n(V,{class:"flex-1 flex flex-col",active:h(t),"onUpdate:active":d[0]||(d[0]=v=>de(t)?t.value=v:null),background:"#fff","line-width":"80px",color:"#ffab30",onChange:B},{default:s(()=>[(k(!0),T(U,null,ce(P.tabs,v=>(k(),re(R,{title:v.title,name:v.name,key:v.name},{default:s(()=>[n(c,{form:h(a).deviceContent,class:"m-0"},{button:s(({slot:r})=>[r.hidden?ue("",!0):(k(),T("div",ve,[n(y,{onClick:()=>r.add(),size:"mini"},{default:s(()=>[_("添加")]),_:2},1032,["onClick"]),n(y,{onClick:()=>r.uniq(),size:"mini",class:"!bg-[red]"},{default:s(()=>[_("去重")]),_:2},1032,["onClick"]),n(y,{onClick:()=>r.reset(),size:"mini",class:"!bg-[gray]"},{default:s(()=>[_("重置")]),_:2},1032,["onClick"])]))]),table:s(({slot:r})=>[n(F,{data:r.data,align:"center","header-align":"center","max-height":"400"},{default:s(()=>[n(I,{type:"seq",width:"50",title:"序号"}),n(I,{field:"value",title:"详细信息"},{default:s(({row:u})=>[n(b,{title:"设备编号",value:u.deviceId},null,8,["value"]),n(b,{title:"生产厂家",value:u.manufacturer},null,8,["value"]),n(b,{title:"供应商",value:u.supplier},null,8,["value"]),n(b,{title:"规格型号",value:u.specificationsModel},null,8,["value"]),n(b,{title:"错误信息",value:u.valid,titleClass:"!text-[red] !w-auto !flex-none",valueClass:"text-red"},null,8,["value"])]),_:1}),n(I,{field:"",title:"操作",width:"50"},{default:s(({row:u})=>[n(E,{name:"cross",color:"red",onClick:ge=>r.remove(u)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["data"])]),_:2},1032,["form"])]),_:2},1032,["title","name"]))),128))]),_:2},1032,["active"])]),_:1},8,["form"]),ie("div",he,[n(q,{class:"w-[30%]",onClick:N},{default:s(()=>[_("暂存")]),_:1}),n(q,{class:"w-[30%]",onClick:A},{default:s(()=>[_("确认")]),_:1})])],64)}}},Le=K(_e,[["__scopeId","data-v-08dc1b36"]]);export{Le as default};
