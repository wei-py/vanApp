import{m as H,_ as W}from"./makeForm-CZNh9NHd.js";import{t as O,A as z,E as Q,a as h,H as X,b as J,o as K}from"./vant-CJN7raQG.js";import{p as tt}from"./plainButton-r4hUV7_7.js";import{c as et,aX as q,al as B,N as i,bA as g,F as st,b1 as lt,u as n,am as M,be as V,r as R,e as it,aj as Z,ak as F,V as $,bD as P}from"./@vue-ts87NNlE.js";import{_ as at,w as L,r as c,c as a,y as rt,i as ot,f as nt,z as ct,s as j,h as Y,n as ut,A as N,e as pt,B as b}from"./index-r_oNj4vA.js";import{i as x}from"./class-COLQ8iHP.js";import{q as mt}from"./queryUrl-BTYYWpY7.js";import{l as E}from"./lodash-DhpMPSDc.js";import{g as w,f as ht,i as U,a as ft,b as dt}from"./lodash-es-LCORa03k.js";import"./@vant-NmgEisJw.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./xe-utils-DXe260hc.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";const vt={class:"overflow-x-scroll px-[17px] !bg-[#ffab30] pt-[0vh]"},yt={class:"text-[16px]"},xt={__name:"step",props:["stepActive"],setup(s){const t=s,e=location.port==2222?"/orderh5":"",l=["预审","客户信息","勘察","合同签约","备案证","初设评审","施工","并网","结算","购售电合同","完成"],f=et(()=>l.findIndex(u=>u==t.stepActive));return(m,u)=>{const y=O,r=z,C=Q;return q(),B("div",vt,[i(C,{active:n(f),class:"w-[200vw] h-full my-auto"},{default:g(()=>[(q(),B(st,null,lt(l,_=>i(r,{"inactive-color":"#ffffff","active-color":"#07c160","active-icon":"checked","inactive-icon":"more"},{"inactive-icon":g(()=>[i(y,{name:`.${n(e)}/icons/step/inactive.png`},null,8,["name"])]),"active-icon":g(()=>[i(y,{name:`.${n(e)}/icons/step/active.png`},null,8,["name"])]),"finish-icon":g(()=>[i(y,{name:`.${n(e)}/icons/step/finish.png`},null,8,["name"])]),default:g(()=>[M("p",yt,V(_),1)]),_:2},1024)),64))]),_:1},8,["active"])])}}},gt=at(xt,[["__scopeId","data-v-c9a60f44"]]),p="!pl-[5px] !min-w-[30%]",Ct=[{customSlot:"person",title:"-",value:"value",orderId:"-",stageId:"-"},{formType:"cell",name:"orderId",title:"系统编号",valueClass:"mr-[10px] text-gray",titleClass:"!pl-[5px] !min-w-[20%] !flex-none",value:"-"},{formType:"cell",name:"contractNumber",title:"进件编号",valueClass:"mr-[10px] text-gray",titleClass:p,value:"-"}],_t=[{formType:"cell",title:"预审",titleClass:x,class:"!p-0 h-[50px]",onMounted(){this.hidden=L("")}},{formType:"cell",name:"/inquiry",title:"预审信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",onMounted(){this.hidden=L("")},click(){this.value!="未开启"?c.push({path:"/inquiry",query:{...a()}}):h(this.value)}}],Tt=[{formType:"cell",title:"客户信息",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/customerInfo",title:"客户信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value!="未开启"){const t={TYZF_ZZD:"客户信息 - 自然人",TYZF_ZZD_ORG:"客户信息 - 法人"}[rt()]||this.title;c.push({path:this.name,query:{...a(),title:t}})}else h(this.value)}}],kt=[{formType:"cell",title:"勘察",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/businessReconnaissance",title:"业务踏勘",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){this.value!="未开启"?c.push({path:this.name,query:{...a()}}):h(this.value)}},{formType:"cell",name:"/technicalLnvestigation",title:"技术勘察",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){this.value!="未开启"?c.push({path:this.name,query:{...a()}}):h(this.value)}}],Dt=[{formType:"cell",title:"合同签约",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/contractAward",title:"合同签约",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",async click(){ot()?X({title:"合同签约",message:"提示：根据商务培训要求，选择正确的签约方式",confirmButtonText:"线上电子合同签约",confirmButtonDisabled:nt(),confirmButtonColor:"#232323",cancelButtonText:"线下纸质合同签约",cancelButtonColor:"#232323",cancelButtonDisabled:ct(),closeOnClickOverlay:!0}).then(()=>{c.push({path:this.name,query:{...a(),online:!0,title:"线上电子合同签约"}})}).catch(()=>{c.push({path:this.name,query:{...a(),online:!1,title:"线下纸质合同签约"}})}):c.push({path:this.name,query:{...a()}})}}],It=[{formType:"cell",title:"备案证及权属证明",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/certificate",title:"备案证及权属证明",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],wt=[{formType:"cell",title:"初设评审",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/InitialReview",title:"初设评审信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{orderId:a().orderId,title:this.title}})}},{formType:"cell",name:"/InitialReview",title:"设计变更信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{orderId:a().orderId,title:this.title,status:this.value}})}}],qt=[{formType:"cell",title:"施工",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/build",title:"施工信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/DeviceInfo",title:"设备信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/buildVideo",title:"施工影像件信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}},{formType:"input",inputAlign:"center",name:"hasPutApprovalConstructBtn",realValue:!1,inlineForm:[{slot:"input",formType:"button",text:" 提交施工审核 ",className:"bg-[#ffab30] text-white h-8 w-[30%] rounded-2xl van-haptics-feedback",click(){j("hasPutApprovalConstructBtn",async s=>{if((await Y.post(mt("/approval/put-approval/bto/construction",{orderId:a().orderId,taskId:"CONSTRUCT"}))).code==200)J("提交成功"),location.reload();else{const e=E.get(data,"data.msg","提交失败");h(e)}})}}]}],bt=[{formType:"cell",title:"并网",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnected",title:"并网信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],Lt=[{formType:"cell",title:"直营结算",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/settlement",title:"直营结算信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],St=[{formType:"cell",title:"供应商结算",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnectedAccount",title:"并网结算信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/gridSettlement",title:"资料结算信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],$t=[{formType:"cell",title:"购售电合同",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/electricityContract",title:"购售电合同信息",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],At=[{formType:"cell",title:"收益查询",titleClass:x,class:"!p-0 h-[50px]",onMounted(){this.hidden=L("")}},{formType:"cell",name:"/income",title:"屋顶业主收益查询",valueClass:"mr-[10px] text-gray",titleClass:p,isLink:!0,value:"未开启",onMounted(){this.hidden=L("")},click(){if(this.value=="未开启"){h(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}];async function Bt(s){const t=[{target:s,prefix:"",path:""}],e=[],l=new Set;for(;t.length>0;){const{target:f,prefix:m,path:u}=t.pop();l.has(f)||(l.add(f),ht(f,(y,r)=>{if(r=r+"",!(r.startsWith("_")||r.startsWith("ref"))){const C=u===""?`${r}`:`${u}.${r}`,_=u===""?`${r}`:`${m}.${r}`;e.push(C),U(y)&&t.push({target:y,prefix:_,path:C})}}))}return e}function Gt(s){const t=new RegExp(`^${s.replace(/\*/g,".*")}$`);return e=>t.test(e)}async function Rt(s,t){const e=await Bt(s),l=Gt(t),f=[];for(let m=0;m<e.length;m++){const u=e[m];l(u)&&!u.includes(".ref.")&&f.push(u)}return f}async function A(s,t,e=()=>{}){const l=[];if(!t.includes("*")){let m=w(s,t);const u=t.split(".").slice(0,-1).join("."),y=w(s,u);return e(m,y,t),m}const f=await Rt(s,t);for(let m=0;m<f.length;m++){const u=f[m];let y=w(s,u);const r=u.split(".").slice(0,-1).join("."),C=w(s,r);e(y,C,u),y=w(s,u),l.push(y)}return l.length===1?l[0]:l}function Zt(s,t){if(ft(s)){const e=s.length;for(let l=0;l<e;l++)t(s[l])}else U(s)&&dt(s,(e,l)=>{t(e,l)})}const Ft={class:"bg-[#f3f3f3] min-h-[100vh] pb-[10px]"},Pt={class:"flex justify-end items-end w-full"},ce={__name:"itemDetail",setup(s){let t=H({itemDetail:Ct,inquiry:_t,customerInfo:Tt,survey:kt,contractSign:Dt,record:It,initReview:wt,build:qt,grid:bt,ZYsettlement:Lt,DLSsettlement:St,electricityContract:$t,income:At}),e=a();const l=ut(),f=R(!1),m=R("预审");it(()=>{u()});async function u(){const{data:r}=await Y.post("/order/search",{queryTag:e.orderId,orderId:e.orderId}),C=E.get(r,"list.0.currentOrderState.0.stageId");m.value=l[C],N(o=>{o.valueClass&&(o.value="未开启",o.valueClass=o.valueClass.replace(/text-[^ ]+/,"text-gray"))});let _=!1;await A(r,"*.orderStates",async o=>{Zt(o,T=>{const d=T?.taskId,k=T?.stateId,S=T?.stageId,D=l[k]||"未开启",G=l[d]||l[S]||"";N(v=>{if(v.title==G&&v.isLink){v.value=D;const I=b(D);v.valueClass=v.valueClass.replace(/text-[^ ]+/,"text-"+I)}if(v.title=="合同签约"&&D=="起租"&&(_=!0),v.title=="屋顶业主收益查询"&&_){v.value="查询";const I=b(v.value);v.valueClass=v.valueClass.replace(/text-[^ ]+/,"text-"+I)}if(v.title?.includes("结算信息")&&G=="结算"){v.value=D;const I=b(D);v.valueClass=v.valueClass.replace(/text-[^ ]+/,"text-"+I)}})})}),A(r,"*.currentOrderState.0",o=>{t.itemDetail[0].orderId=o?.orderId,t.itemDetail[1].value=o?.orderId}),A(r,"list.0",o=>{t.itemDetail[0].title=o?.customer?.name||o?.customerOrg?.orgName||"-",t.itemDetail[2].value=o?.leaseReview?.contractNumber||"-",f.value=o?.company?.type=="DLS",j("hasPutApprovalConstructBtn","realValue",o.hasPutApprovalConstructBtn),t.initReview[2].value=o.orderDesignUpdateState;const T=b(o.orderDesignUpdateState);t.initReview[2].valueClass=t.initReview[2].valueClass.replace(/text-[^ ]+/,"text-"+T)})}function y(){c.push({path:"/operateLog",query:e})}return pt({onClickRight:y,onRefresh:()=>location.reload()}),(r,C)=>{const _=O,o=tt,T=K,d=W;return q(),B("div",Ft,[i(gt,{stepActive:n(m),class:"h-[13vh] mb-[10px] shadowC"},null,8,["stepActive"]),i(d,{form:n(t).itemDetail,"group-class":"itemDetailGrop"},{person:g(({slot:k})=>[i(T,{"title-class":"!text-[20px] bg-[white] flex items-center  font-bold"},{title:g(()=>[i(_,{name:"contact",class:"mr-2"}),$(" "+V(k.title),1)]),value:g(()=>[M("div",Pt,[i(o,{class:"!h-[auto]",onClick:P(S=>r.$copyText(k.orderId),["stop"])},{default:g(()=>[$(" 复制系统编号 ")]),_:2},1032,["onClick"]),i(o,{class:"!h-[auto] !ml-2",onClick:P(S=>r.$copyText(k.stageId),["stop"])},{default:g(()=>[$(" 复制进件编号 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},8,["form"]),i(d,{form:n(t).inquiry,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:n(t).customerInfo,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:n(t).survey,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:n(t).contractSign,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:n(t).record,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:n(t).initReview,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:n(t).build,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:n(t).grid,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:n(t).electricityContract,"group-class":"itemDetailGrop"},null,8,["form"]),n(f)?F("",!0):(q(),Z(d,{key:0,form:n(t).ZYsettlement,"group-class":"itemDetailGrop"},null,8,["form"])),n(f)?(q(),Z(d,{key:1,form:n(t).DLSsettlement,"group-class":"itemDetailGrop"},null,8,["form"])):F("",!0),i(d,{form:n(t).income,"group-class":"itemDetailGrop"},null,8,["form"])])}}};export{ce as default};
