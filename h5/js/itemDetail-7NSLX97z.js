import{m as H,_ as W}from"./makeForm-B3HhMcgC.js";import{t as O,A as z,E as Q,a as m,H as X,b as J,o as K}from"./vant-BjNCsb4u.js";import{p as tt}from"./plainButton-DAq42Zrf.js";import{c as et,aX as b,al as B,N as i,bA as g,F as st,b1 as lt,u as o,am as M,be as V,r as R,e as it,aj as Z,ak as F,V as $,bD as P}from"./@vue-ts87NNlE.js";import{_ as at,w as L,r as c,c as a,y as rt,i as nt,f as ot,z as ct,s as j,h as Y,n as ut,A as N,e as pt,B as q}from"./index-L-kxfX5L.js";import{i as x}from"./class-COLQ8iHP.js";import{q as mt}from"./queryUrl-BTYYWpY7.js";import{l as E}from"./lodash-DhpMPSDc.js";import{g as I,f as ht,i as U,a as ft,b as dt}from"./lodash-es-LCORa03k.js";import"./@vant-NmgEisJw.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./xe-utils-DXe260hc.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";const vt={class:"overflow-x-scroll px-[17px] !bg-[#ffab30] pt-[0vh]"},yt={class:"text-[16px]"},xt={__name:"step",props:["stepActive"],setup(s){const t=s,e=location.port==2222?"/orderh5":"",l=["预审","客户信息","勘察","合同签约","备案证","初设评审","施工","并网","结算","购售电合同","完成"],f=et(()=>l.findIndex(u=>u==t.stepActive));return(p,u)=>{const y=O,r=z,C=Q;return b(),B("div",vt,[i(C,{active:o(f),class:"w-[230vw] h-full my-auto"},{default:g(()=>[(b(),B(st,null,lt(l,_=>i(r,{"inactive-color":"#ffffff","active-color":"#07c160","active-icon":"checked","inactive-icon":"more"},{"inactive-icon":g(()=>[i(y,{name:`.${o(e)}/icons/step/inactive.png`},null,8,["name"])]),"active-icon":g(()=>[i(y,{name:`.${o(e)}/icons/step/active.png`},null,8,["name"])]),"finish-icon":g(()=>[i(y,{name:`.${o(e)}/icons/step/finish.png`},null,8,["name"])]),default:g(()=>[M("p",yt,V(_),1)]),_:2},1024)),64))]),_:1},8,["active"])])}}},gt=at(xt,[["__scopeId","data-v-b3ab2c1e"]]),h="!pl-[5px] !min-w-[30%]",Ct=[{customSlot:"person",title:"-",value:"value",orderId:"-",stageId:"-"},{formType:"cell",name:"orderId",title:"系统编号",valueClass:"mr-[10px] text-gray",titleClass:"!pl-[5px] !min-w-[20%] !flex-none",value:"-"},{formType:"cell",name:"contractNumber",title:"进件编号",valueClass:"mr-[10px] text-gray",titleClass:"!pl-[5px] !min-w-[20%] !flex-none",value:"-"}],_t=[{formType:"cell",title:"预审",titleClass:x,class:"!p-0 h-[50px]",onMounted(){this.hidden=L("")}},{formType:"cell",name:"/inquiry",title:"预审信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",onMounted(){this.hidden=L("")},click(){this.value!="未开启"?c.push({path:"/inquiry",query:{...a()}}):m(this.value)}}],Tt=[{formType:"cell",title:"客户信息",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/customerInfo",title:"客户信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value!="未开启"){const t={TYZF_ZZD:"客户信息 - 自然人",TYZF_ZZD_ORG:"客户信息 - 法人"}[rt()]||this.title;c.push({path:this.name,query:{...a(),title:t}})}else m(this.value)}}],kt=[{formType:"cell",title:"勘察",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/businessReconnaissance",title:"业务踏勘",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){this.value!="未开启"?c.push({path:this.name,query:{...a()}}):m(this.value)}},{formType:"cell",name:"/technicalLnvestigation",title:"技术勘察",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){this.value!="未开启"?c.push({path:this.name,query:{...a()}}):m(this.value)}}],Dt=[{formType:"cell",title:"合同签约",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/contractAward",title:"合同签约",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",async click(){nt()?X({title:"合同签约",message:"提示：根据商务培训要求，选择正确的签约方式",confirmButtonText:"线上电子合同签约",confirmButtonDisabled:ot(),confirmButtonColor:"#232323",cancelButtonText:"线下纸质合同签约",cancelButtonColor:"#232323",cancelButtonDisabled:ct(),closeOnClickOverlay:!0}).then(()=>{c.push({path:this.name,query:{...a(),online:!0,title:"线上电子合同签约"}})}).catch(()=>{c.push({path:this.name,query:{...a(),online:!1,title:"线下纸质合同签约"}})}):c.push({path:this.name,query:{...a()}})}}],wt=[{formType:"cell",title:"备案证及权属证明",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/certificate",title:"备案证及权属证明",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],It=[{formType:"cell",title:"初设评审",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/InitialReview",title:"初设评审信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{orderId:a().orderId,title:this.title}})}},{formType:"cell",name:"/InitialReview",title:"设计变更信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{orderId:a().orderId,title:this.title,status:this.value}})}}],bt=[{formType:"cell",title:"施工",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/build",title:"施工信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/DeviceInfo",title:"设备信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/buildVideo",title:"施工影像件信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}},{formType:"input",inputAlign:"center",name:"hasPutApprovalConstructBtn",realValue:!1,inlineForm:[{slot:"input",formType:"button",text:" 提交施工审核 ",className:"bg-[#ffab30] text-white h-8 w-[30%] rounded-2xl van-haptics-feedback",click(){j("hasPutApprovalConstructBtn",async s=>{if((await Y.post(mt("/approval/put-approval/bto/construction",{orderId:a().orderId,taskId:"CONSTRUCT"}))).code==200)J("提交成功"),location.reload();else{const e=E.get(data,"data.msg","提交失败");m(e)}})}}]}],qt=[{formType:"cell",title:"并网",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnected",title:"并网信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],Lt=[{formType:"cell",title:"直营结算",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/settlement",title:"直营结算信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],St=[{formType:"cell",title:"供应商结算",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnectedAccount",title:"并网结算信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/gridSettlement",title:"资料结算信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],$t=[{formType:"cell",title:"购售电合同",titleClass:x,class:"!p-0 h-[50px]"},{formType:"cell",name:"/electricityContract",title:"购售电合同信息",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}],At=[{formType:"cell",title:"收益查询",titleClass:x,class:"!p-0 h-[50px]",onMounted(){this.hidden=L("")}},{formType:"cell",name:"/income",title:"屋顶业主收益查询",valueClass:"mr-[10px] text-gray",titleClass:h,isLink:!0,value:"未开启",onMounted(){this.hidden=L("")},click(){if(this.value=="未开启"){m(this.title+"未开启");return}c.push({path:this.name,query:{...a()}})}}];async function Bt(s){const t=[{target:s,prefix:"",path:""}],e=[],l=new Set;for(;t.length>0;){const{target:f,prefix:p,path:u}=t.pop();l.has(f)||(l.add(f),ht(f,(y,r)=>{if(r=r+"",!(r.startsWith("_")||r.startsWith("ref"))){const C=u===""?`${r}`:`${u}.${r}`,_=u===""?`${r}`:`${p}.${r}`;e.push(C),U(y)&&t.push({target:y,prefix:_,path:C})}}))}return e}function Gt(s){const t=new RegExp(`^${s.replace(/\*/g,".*")}$`);return e=>t.test(e)}async function Rt(s,t){const e=await Bt(s),l=Gt(t),f=[];for(let p=0;p<e.length;p++){const u=e[p];l(u)&&!u.includes(".ref.")&&f.push(u)}return f}async function A(s,t,e=()=>{}){const l=[];if(!t.includes("*")){let p=I(s,t);const u=t.split(".").slice(0,-1).join("."),y=I(s,u);return e(p,y,t),p}const f=await Rt(s,t);for(let p=0;p<f.length;p++){const u=f[p];let y=I(s,u);const r=u.split(".").slice(0,-1).join("."),C=I(s,r);e(y,C,u),y=I(s,u),l.push(y)}return l.length===1?l[0]:l}function Zt(s,t){if(ft(s)){const e=s.length;for(let l=0;l<e;l++)t(s[l])}else U(s)&&dt(s,(e,l)=>{t(e,l)})}const Ft={class:"bg-[#f3f3f3] min-h-[100vh] pb-[10px]"},Pt={class:"flex justify-end items-end w-full"},ce={__name:"itemDetail",setup(s){let t=H({itemDetail:Ct,inquiry:_t,customerInfo:Tt,survey:kt,contractSign:Dt,record:wt,initReview:It,build:bt,grid:qt,ZYsettlement:Lt,DLSsettlement:St,electricityContract:$t,income:At}),e=a();const l=ut(),f=R(!1),p=R("预审");it(()=>{u()});async function u(){const{data:r}=await Y.post("/order/search",{queryTag:e.orderId,orderId:e.orderId}),C=E.get(r,"list.0.currentOrderState.0.stageId");p.value=l[C],N(n=>{n.valueClass&&(n.value="未开启",n.valueClass=n.valueClass.replace(/text-[^ ]+/,"text-gray"))});let _=!1;await A(r,"*.orderStates",async n=>{Zt(n,T=>{const d=T?.taskId,k=T?.stateId,S=T?.stageId,D=l[k]||"未开启",G=l[d]||l[S]||"";N(v=>{if(v.title==G&&v.isLink){v.value=D;const w=q(D);v.valueClass=v.valueClass.replace(/text-[^ ]+/,"text-"+w)}if(v.title=="合同签约"&&D=="起租"&&(_=!0),v.title=="屋顶业主收益查询"&&_){v.value="查询";const w=q(v.value);v.valueClass=v.valueClass.replace(/text-[^ ]+/,"text-"+w)}if(v.title?.includes("结算信息")&&G=="结算"){v.value=D;const w=q(D);v.valueClass=v.valueClass.replace(/text-[^ ]+/,"text-"+w)}})})}),A(r,"*.currentOrderState.0",n=>{t.itemDetail[0].orderId=n?.orderId,t.itemDetail[1].value=n?.orderId}),A(r,"list.0",n=>{t.itemDetail[0].title=n?.customer?.name||n?.customerOrg?.orgName||"-",t.itemDetail[2].value=n?.leaseReview?.contractNumber||"-",f.value=n?.company?.type=="DLS",j("hasPutApprovalConstructBtn","realValue",n.hasPutApprovalConstructBtn),t.initReview[2].value=n.orderDesignUpdateState;const T=q(n.orderDesignUpdateState);t.initReview[2].valueClass=t.initReview[2].valueClass.replace(/text-[^ ]+/,"text-"+T)})}function y(){c.push({path:"/operateLog",query:e})}return pt({onClickRight:y,onRefresh:()=>location.reload()}),(r,C)=>{const _=O,n=tt,T=K,d=W;return b(),B("div",Ft,[i(gt,{stepActive:o(p),class:"h-[13vh] mb-[10px] shadowC"},null,8,["stepActive"]),i(d,{form:o(t).itemDetail,"group-class":"itemDetailGrop"},{person:g(({slot:k})=>[i(T,{"title-class":"!text-[20px] bg-[white] flex items-center  font-bold !flex-none w-[40%]"},{title:g(()=>[i(_,{name:"contact",class:"mr-2"}),$(" "+V(k.title),1)]),value:g(()=>[M("div",Pt,[i(n,{class:"!h-[auto] !py-1",onClick:P(S=>r.$copyText(k.orderId),["stop"])},{default:g(()=>[$(" 复制系统编号 ")]),_:2},1032,["onClick"]),i(n,{class:"!h-[auto] !py-1 !ml-2",onClick:P(S=>r.$copyText(k.stageId),["stop"])},{default:g(()=>[$(" 复制进件编号 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},8,["form"]),i(d,{form:o(t).inquiry,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:o(t).customerInfo,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:o(t).survey,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:o(t).contractSign,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:o(t).record,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:o(t).initReview,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:o(t).build,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:o(t).grid,"group-class":"itemDetailGrop"},null,8,["form"]),i(d,{form:o(t).electricityContract,"group-class":"itemDetailGrop"},null,8,["form"]),o(f)?F("",!0):(b(),Z(d,{key:0,form:o(t).ZYsettlement,"group-class":"itemDetailGrop"},null,8,["form"])),o(f)?(b(),Z(d,{key:1,form:o(t).DLSsettlement,"group-class":"itemDetailGrop"},null,8,["form"])):F("",!0),i(d,{form:o(t).income,"group-class":"itemDetailGrop"},null,8,["form"])])}}};export{ce as default};
