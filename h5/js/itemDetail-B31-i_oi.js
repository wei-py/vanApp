import{m as U,_ as W}from"./makeForm-DgvH7MRW.js";import{t as O,A as z,E as Q,a as q,H as X,b as J,o as K}from"./vant-Ckwj66YG.js";import{p as ee}from"./plainButton-DKgtdQgL.js";import{c as te,aX as I,al as B,N as a,bA as x,F as se,b1 as le,u as r,am as M,be as V,r as G,e as ae,aj as Z,ak as F,V as S,bD as P}from"./@vue-ts87NNlE.js";import{_ as ie,w as b,r as n,c as i,y as oe,i as re,f as ne,z as ce,s as j,h as Y,n as pe,A as N,e as ue,B as $}from"./index-DwbTWwPI.js";import{i as y}from"./class-COLQ8iHP.js";import{q as me}from"./queryUrl-BTYYWpY7.js";import{l as E}from"./lodash-DhpMPSDc.js";import{g as w,f as fe,i as H,a as he,b as de}from"./lodash-es-LCORa03k.js";import"./@vant-NmgEisJw.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./xe-utils-DXe260hc.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";const ve={class:"overflow-x-scroll px-[17px] !bg-[#ffab30] pt-[0vh]"},ye={class:"text-[16px]"},xe={__name:"step",props:["stepActive"],setup(s){const e=s,t=location.port==2222?"/orderh5":"",l=["预审","客户信息","勘察","合同签约","备案证","初设评审","施工","并网","结算","购售电合同","完成"],f=te(()=>l.findIndex(c=>c==e.stepActive));return(m,c)=>{const v=O,o=z,g=Q;return I(),B("div",ve,[a(g,{active:r(f),class:"w-[200vw] h-full my-auto"},{default:x(()=>[(I(),B(se,null,le(l,C=>a(o,{"inactive-color":"#ffffff","active-color":"#07c160","active-icon":"checked","inactive-icon":"more"},{"inactive-icon":x(()=>[a(v,{name:`.${r(t)}/icons/step/inactive.png`},null,8,["name"])]),"active-icon":x(()=>[a(v,{name:`.${r(t)}/icons/step/active.png`},null,8,["name"])]),"finish-icon":x(()=>[a(v,{name:`.${r(t)}/icons/step/finish.png`},null,8,["name"])]),default:x(()=>[M("p",ye,V(C),1)]),_:2},1024)),64))]),_:1},8,["active"])])}}},ge=ie(xe,[["__scopeId","data-v-c9a60f44"]]),u="!pl-[5px] !min-w-[30%]",Ce=[{customSlot:"person",title:"-",value:"value",orderId:"-",stageId:"-"},{formType:"cell",name:"orderId",title:"系统编号",valueClass:"mr-[10px] text-gray",titleClass:"!pl-[5px] !min-w-[20%] !flex-none",value:"-"},{formType:"cell",name:"contractNumber",title:"进件编号",valueClass:"mr-[10px] text-gray",titleClass:u,value:"-"}],_e=[{formType:"cell",title:"预审",titleClass:y,class:"!p-0 h-[50px]",onMounted(){this.hidden=b("")}},{formType:"cell",name:"/inquiry",title:"预审信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",onMounted(){this.hidden=b("")},click(){this.value!="未开启"?n.push({path:"/inquiry",query:{...i()}}):q(this.value)}}],Te=[{formType:"cell",title:"客户信息",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/customerInfo",title:"客户信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){if(this.value!="未开启"){const e={TYZF_ZZD:"客户信息 - 自然人",TYZF_ZZD_ORG:"客户信息 - 法人"}[oe()]||this.title;n.push({path:this.name,query:{...i(),title:e}})}else q(this.value)}}],ke=[{formType:"cell",title:"勘察",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/businessReconnaissance",title:"业务踏勘",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){this.value!="未开启"?n.push({path:this.name,query:{...i()}}):q(this.value)}},{formType:"cell",name:"/technicalLnvestigation",title:"技术勘察",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){this.value!="未开启"?n.push({path:this.name,query:{...i()}}):q(this.value)}}],De=[{formType:"cell",title:"合同签约",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/contractAward",title:"合同签约",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",async click(){re()?X({title:"合同签约",message:"提示：根据商务培训要求，选择正确的签约方式",confirmButtonText:"线上电子合同签约",confirmButtonDisabled:ne(),confirmButtonColor:"#232323",cancelButtonText:"线下纸质合同签约",cancelButtonColor:"#232323",cancelButtonDisabled:ce(),closeOnClickOverlay:!0}).then(()=>{n.push({path:this.name,query:{...i(),online:!0,title:"线上电子合同签约"}})}).catch(()=>{n.push({path:this.name,query:{...i(),online:!1,title:"线下纸质合同签约"}})}):n.push({path:this.name,query:{...i()}})}}],we=[{formType:"cell",title:"备案证及权属证明",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/certificate",title:"备案证及权属证明",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{...i()}})}}],Ie=[{formType:"cell",title:"初设评审",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/InitialReview",title:"初设评审信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{orderId:i().orderId,title:this.title}})}},{formType:"cell",name:"/InitialReview",title:"设计变更信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{orderId:i().orderId,title:this.title}})}}],qe=[{formType:"cell",title:"施工",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/build",title:"施工信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{...i()}})}},{formType:"cell",name:"/DeviceInfo",title:"设备信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{...i()}})}},{formType:"cell",name:"/buildVideo",title:"施工影像件信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{...i()}})}},{formType:"input",inputAlign:"center",name:"hasPutApprovalConstructBtn",realValue:!1,inlineForm:[{slot:"input",formType:"button",text:" 提交施工审核 ",className:"bg-[#ffab30] text-white h-8 w-[30%] rounded-2xl van-haptics-feedback",click(){j("hasPutApprovalConstructBtn",async s=>{if((await Y.post(me("/approval/put-approval/bto/construction",{orderId:i().orderId,taskId:"CONSTRUCT"}))).code==200)J("提交成功"),location.reload();else{const t=E.get(data,"data.msg","提交失败");q(t)}})}}]}],be=[{formType:"cell",title:"并网",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnected",title:"并网信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{...i()}})}}],Le=[{formType:"cell",title:"直营结算",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/settlement",title:"直营结算信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{...i()}})}}],Se=[{formType:"cell",title:"供应商结算",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnectedAccount",title:"并网结算信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{...i()}})}},{formType:"cell",name:"/gridSettlement",title:"资料结算信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{...i()}})}}],$e=[{formType:"cell",title:"购售电合同",titleClass:y,class:"!p-0 h-[50px]"},{formType:"cell",name:"/electricityContract",title:"购售电合同信息",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",click(){n.push({path:this.name,query:{...i()}})}}],Ae=[{formType:"cell",title:"收益查询",titleClass:y,class:"!p-0 h-[50px]",onMounted(){this.hidden=b("")}},{formType:"cell",name:"/income",title:"屋顶业主收益查询",valueClass:"mr-[10px] text-gray",titleClass:u,isLink:!0,value:"未开启",onMounted(){this.hidden=b("")},click(){n.push({path:this.name,query:{...i()}})}}];async function Be(s){const e=[{target:s,prefix:"",path:""}],t=[],l=new Set;for(;e.length>0;){const{target:f,prefix:m,path:c}=e.pop();l.has(f)||(l.add(f),fe(f,(v,o)=>{if(o=o+"",!(o.startsWith("_")||o.startsWith("ref"))){const g=c===""?`${o}`:`${c}.${o}`,C=c===""?`${o}`:`${m}.${o}`;t.push(g),H(v)&&e.push({target:v,prefix:C,path:g})}}))}return t}function Re(s){const e=new RegExp(`^${s.replace(/\*/g,".*")}$`);return t=>e.test(t)}async function Ge(s,e){const t=await Be(s),l=Re(e),f=[];for(let m=0;m<t.length;m++){const c=t[m];l(c)&&!c.includes(".ref.")&&f.push(c)}return f}async function A(s,e,t=()=>{}){const l=[];if(!e.includes("*")){let m=w(s,e);const c=e.split(".").slice(0,-1).join("."),v=w(s,c);return t(m,v,e),m}const f=await Ge(s,e);for(let m=0;m<f.length;m++){const c=f[m];let v=w(s,c);const o=c.split(".").slice(0,-1).join("."),g=w(s,o);t(v,g,c),v=w(s,c),l.push(v)}return l.length===1?l[0]:l}function Ze(s,e){if(he(s)){const t=s.length;for(let l=0;l<t;l++)e(s[l])}else H(s)&&de(s,(t,l)=>{e(t,l)})}const Fe={class:"bg-[#f3f3f3] min-h-[100vh] pb-[10px]"},Pe={class:"flex justify-end items-end w-full"},ct={__name:"itemDetail",setup(s){let e=U({itemDetail:Ce,inquiry:_e,customerInfo:Te,survey:ke,contractSign:De,record:we,initReview:Ie,build:qe,grid:be,ZYsettlement:Le,DLSsettlement:Se,electricityContract:$e,income:Ae}),t=i();const l=pe(),f=G(!1),m=G("预审");ae(()=>{c()});async function c(){const{data:o}=await Y.post("/order/search",{queryTag:t.orderId,orderId:t.orderId}),g=E.get(o,"list.0.currentOrderState.0.stageId");m.value=l[g],A(o,"*.currentOrderState.0",p=>{e.itemDetail[0].orderId=p?.orderId,e.itemDetail[1].value=p?.orderId}),N(p=>{p.valueClass&&(p.value="未开启",p.valueClass=p.valueClass.replace(/text-[^ ]+/,"text-gray"))});let C=!1;await A(o,"*.orderStates",async p=>{Ze(p,_=>{const h=_?.taskId,T=_?.stateId,L=_?.stageId,k=l[T]||"未开启",R=l[h]||l[L]||"";N(d=>{if(d.title==R&&d.isLink){d.value=k;const D=$(k);d.valueClass=d.valueClass.replace(/text-[^ ]+/,"text-"+D)}if(d.title=="合同签约"&&k=="起租"&&(C=!0),d.title=="屋顶业主收益查询"&&C){d.value="查询";const D=$(d.value);d.valueClass=d.valueClass.replace(/text-[^ ]+/,"text-"+D)}if(d.title?.includes("结算信息")&&R=="结算"){d.value=k;const D=$(k);d.valueClass=d.valueClass.replace(/text-[^ ]+/,"text-"+D)}})})}),e.initReview[1].value.includes("通过")&&(e.initReview[2].value="可变更"),e.grid[1].value?.includes("待")&&(e.initReview[2].value="不可变更",e.initReview[2].valueClass=e.initReview[2].valueClass.replace(/text-[^ ]+/,"text-gray")),A(o,"list.0",p=>{e.itemDetail[0].title=p?.customer?.name||p?.customerOrg?.orgName||"-",e.itemDetail[2].value=p?.leaseReview?.contractNumber||"-",f.value=p?.company?.type=="DLS",j("hasPutApprovalConstructBtn","realValue",p.hasPutApprovalConstructBtn)})}function v(){n.push({path:"/operateLog",query:t})}return ue({onClickRight:v,onRefresh:()=>location.reload()}),(o,g)=>{const C=O,p=ee,_=K,h=W;return I(),B("div",Fe,[a(ge,{stepActive:r(m),class:"h-[13vh] mb-[10px] shadowC"},null,8,["stepActive"]),a(h,{form:r(e).itemDetail,"group-class":"itemDetailGrop"},{person:x(({slot:T})=>[a(_,{"title-class":"!text-[20px] bg-[white] flex items-center  font-bold"},{title:x(()=>[a(C,{name:"contact",class:"mr-2"}),S(" "+V(T.title),1)]),value:x(()=>[M("div",Pe,[a(p,{class:"!h-[auto]",onClick:P(L=>o.$copyText(T.orderId),["stop"])},{default:x(()=>[S(" 复制系统编号 ")]),_:2},1032,["onClick"]),a(p,{class:"!h-[auto] !ml-2",onClick:P(L=>o.$copyText(T.stageId),["stop"])},{default:x(()=>[S(" 复制进件编号 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},8,["form"]),a(h,{form:r(e).inquiry,"group-class":"itemDetailGrop"},null,8,["form"]),a(h,{form:r(e).customerInfo,"group-class":"itemDetailGrop"},null,8,["form"]),a(h,{form:r(e).survey,"group-class":"itemDetailGrop"},null,8,["form"]),a(h,{form:r(e).contractSign,"group-class":"itemDetailGrop"},null,8,["form"]),a(h,{form:r(e).record,"group-class":"itemDetailGrop"},null,8,["form"]),a(h,{form:r(e).initReview,"group-class":"itemDetailGrop"},null,8,["form"]),a(h,{form:r(e).build,"group-class":"itemDetailGrop"},null,8,["form"]),a(h,{form:r(e).grid,"group-class":"itemDetailGrop"},null,8,["form"]),a(h,{form:r(e).electricityContract,"group-class":"itemDetailGrop"},null,8,["form"]),r(f)?F("",!0):(I(),Z(h,{key:0,form:r(e).ZYsettlement,"group-class":"itemDetailGrop"},null,8,["form"])),r(f)?(I(),Z(h,{key:1,form:r(e).DLSsettlement,"group-class":"itemDetailGrop"},null,8,["form"])):F("",!0),a(h,{form:r(e).income,"group-class":"itemDetailGrop"},null,8,["form"])])}}};export{ct as default};
