import{m as V,_ as j}from"./makeForm-Bte3ATMg.js";import{v as Y,w as E,a as D,x as U,b as W,y as H,l as Q}from"./vant-xiv0EFx3.js";import{p as X}from"./plainButton-CQdWUwau.js";import{r as P,aX as w,al as S,N as c,bA as g,F as z,b1 as J,am as A,be as N,e as K,u as h,aj as G,ak as R,V as q,bD as B}from"./@vue-BHA94vdH.js";import{_ as ee,t as I,r as o,c as a,w as te,i as se,s as Z,h as M,m as le,x as F,y as b}from"./index-Dd7uG9g0.js";import{i as v}from"./class-rRG2y2aF.js";import{q as ae}from"./queryUrl-CUkA5NKU.js";import{l as ie}from"./lodash-C1iNKp1x.js";import{r as re}from"./runTime-DAjLGjV1.js";import{g as k,f as oe,i as O,a as ne,b as ce}from"./lodash-es-LCORa03k.js";import"./@vant-BMzV8Unt.js";import"./pinia-BOLtM30a.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-BQWAt7JZ.js";import"./@vueuse-BYPNFz0v.js";import"./xe-utils-D22uZPtC.js";import"./dayjs-19KvoO9f.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-DYFNhZJM.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus--RpDJ8QK.js";import"./vue3-photo-preview-Byv7Qnko.js";import"./vxe-table-BpFaW3Xd.js";import"./dom-zindex-GlLoxNk1.js";const ue={class:"overflow-x-scroll px-[17px] !bg-[#ffab30] pt-[3.2vh]"},pe={class:"text-[16px]"},me={__name:"step",setup(l){P("");const e=["预审","客户信息","勘察","合同签约","备案证","初设评审","施工","并网","结算","购售电合同","完成"];return(i,r)=>{const p=Y,u=E;return w(),S("div",ue,[c(u,{active:3,class:"w-[200vw]"},{default:g(()=>[(w(),S(z,null,J(e,s=>c(p,{"inactive-color":"#ffffff","active-color":"#07c160","active-icon":"checked","inactive-icon":"more"},{default:g(()=>[A("p",pe,N(s),1)]),_:2},1024)),64))]),_:1})])}}},fe=ee(me,[["__scopeId","data-v-1cf38ebf"]]),n="!pl-[5px] !min-w-[30%]",he=[{customSlot:"person",title:"任命",value:"value",orderId:"-",stageId:"-"},{formType:"cell",name:"orderId",title:"系统编号",valueClass:"mr-[10px] text-gray",titleClass:n,value:"-"},{formType:"cell",name:"designId",title:"进件编号",valueClass:"mr-[10px] text-gray",titleClass:n,value:"-"}],de=[{formType:"cell",title:"预审",titleClass:v,class:"!p-0 h-[50px]",onMounted(){this.hidden=I("")}},{formType:"cell",name:"/inquiry",title:"预审信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",onMounted(){this.hidden=I("")},click(){this.value!="未开启"?o.push({path:"/inquiry",query:{...a()}}):D(this.value)}}],ve=[{formType:"cell",title:"客户信息",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/customerInfo",title:"客户信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){if(this.value!="未开启"){const e={TYZF_ZZD:"客户信息 - 自然人",TYZF_ZZD_ORG:"客户信息 - 法人"}[te()]||this.title;o.push({path:this.name,query:{...a(),title:e}})}else D(this.value)}}],ye=[{formType:"cell",title:"勘察",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/businessReconnaissance",title:"业务踏勘",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){this.value!="未开启"?o.push({path:this.name,query:{...a()}}):D(this.value)}},{formType:"cell",name:"/technicalLnvestigation",title:"技术勘察",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){this.value!="未开启"?o.push({path:this.name,query:{...a()}}):D(this.value)}}],xe=[{formType:"cell",title:"合同签约",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/contractAward",title:"合同签约",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",async click(){se()?U({title:"合同签约",message:"提示：根据商务培训要求，选择正确的签约方式",confirmButtonText:"线上电子合同签约",cancelButtonText:"线下纸质合同签约",closeOnClickOverlay:!0}).then(()=>{o.push({path:this.name,query:{...a(),online:!0,title:"线上电子合同签约"}})}).catch(()=>{o.push({path:this.name,query:{...a(),online:!1,title:"线下纸质合同签约"}})}):o.push({path:this.name,query:{...a()}})}}],ge=[{formType:"cell",title:"备案证及权属证明",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/certificate",title:"备案证及权属证明",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],Ce=[{formType:"cell",title:"初设评审",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/InitialReview",title:"初设评审信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{orderId:a().orderId,title:this.title}})}},{formType:"cell",name:"/InitialReview",title:"设计变更信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{orderId:a().orderId,title:this.title}})}}],_e=[{formType:"cell",title:"施工",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/build",title:"施工信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/DeviceInfo",title:"设备信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/buildVideo",title:"施工影像件信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}},{formType:"input",inputAlign:"center",name:"hasPutApprovalConstructBtn",realValue:!1,inlineForm:[{slot:"input",formType:"button",text:" 提交施工审核 ",className:"bg-[#ffab30] text-white h-8 w-[30%] rounded-2xl van-haptics-feedback",click(){Z("hasPutApprovalConstructBtn",async l=>{if((await M.post(ae("/approval/put-approval/bto/construction",{orderId:a().orderId,taskId:"CONSTRUCT"}))).code==200)W("提交成功"),location.reload();else{const i=ie.get(data,"data.msg","提交失败");D(i)}})}}]}],Te=[{formType:"cell",title:"并网",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnected",title:"并网信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],ke=[{formType:"cell",title:"直营结算",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/settlement",title:"直营结算信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],we=[{formType:"cell",title:"供应商结算",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnectedAccount",title:"并网结算信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/gridSettlement",title:"资料结算信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],De=[{formType:"cell",title:"购售电合同",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/electricityContract",title:"购售电合同信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],Ie=[{formType:"cell",title:"收益查询",titleClass:v,class:"!p-0 h-[50px]",onMounted(){this.hidden=I("")}},{formType:"cell",name:"/income",title:"屋顶业主收益查询",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",onMounted(){this.hidden=I("")},click(){o.push({path:this.name,query:{...a()}})}}];async function qe(l){const e=[{target:l,prefix:"",path:""}],i=[],r=new Set;for(;e.length>0;){const{target:p,prefix:u,path:s}=e.pop();r.has(p)||(r.add(p),oe(p,(d,t)=>{if(t=t+"",!(t.startsWith("_")||t.startsWith("ref"))){const y=s===""?`${t}`:`${s}.${t}`,C=s===""?`${t}`:`${u}.${t}`;i.push(y),O(d)&&e.push({target:d,prefix:C,path:y})}}))}return i}function be(l){const e=new RegExp(`^${l.replace(/\*/g,".*")}$`);return i=>e.test(i)}async function Le(l,e){const i=await qe(l),r=be(e),p=[];for(let u=0;u<i.length;u++){const s=i[u];r(s)&&!s.includes(".ref.")&&p.push(s)}return p}async function L(l,e,i=()=>{}){const r=[];if(!e.includes("*")){let u=k(l,e);const s=e.split(".").slice(0,-1).join("."),d=k(l,s);return i(u,d,e),u}const p=await Le(l,e);for(let u=0;u<p.length;u++){const s=p[u];let d=k(l,s);const t=s.split(".").slice(0,-1).join("."),y=k(l,t);i(d,y,s),d=k(l,s),r.push(d)}return r.length===1?r[0]:r}function Se(l,e){if(ne(l)){const i=l.length;for(let r=0;r<i;r++)e(l[r])}else O(l)&&ce(l,(i,r)=>{e(i,r)})}const $e={class:"bg-[#f3f3f3] min-h-[100vh] pb-[10px]"},Ge={class:"flex justify-end items-end w-full"},lt={__name:"itemDetail",setup(l){let e=V({itemDetail:he,inquiry:de,customerInfo:ve,survey:ye,contractSign:xe,record:ge,initReview:Ce,build:_e,grid:Te,ZYsettlement:ke,DLSsettlement:we,electricityContract:De,income:Ie}),i=a();const r=le(),p=P(!1);K(()=>{re(u,"itemDetail - getData")});async function u(){const{data:s}=await M.post("/order/search",{queryTag:i.orderId,orderId:i.orderId});L(s,"list.0",t=>{e.itemDetail[0].title=t?.customer?.name||t?.customerOrg?.orgName||"-",e.itemDetail[2].value=t?.leaseReview?.contractNumber||"-",console.log(),p.value=t?.company?.type=="DLS",Z("hasPutApprovalConstructBtn","realValue",t.hasPutApprovalConstructBtn)}),L(s,"*.currentOrderState.0",t=>{e.itemDetail[0].orderId=t?.orderId,e.itemDetail[1].value=t?.orderId}),F(t=>{t.valueClass&&(t.value="未开启",t.valueClass=t.valueClass.replace(/text-[^ ]+/,"text-gray"))});let d=!1;await L(s,"*.orderStates",async t=>{Se(t,y=>{const C=y?.taskId,m=y?.stateId,_=y?.stageId,x=r[m]||"未开启",$=r[C]||r[_]||"";F(f=>{if(f.title==$&&f.isLink){f.value=x;const T=b(x);f.valueClass=f.valueClass.replace(/text-[^ ]+/,"text-"+T)}if(f.title=="合同签约"&&x=="起租"&&(d=!0),f.title=="屋顶业主收益查询"&&d){f.value="查询";const T=b(f.value);f.valueClass=f.valueClass.replace(/text-[^ ]+/,"text-"+T)}if(f.title?.includes("结算信息")&&$=="结算"){f.value=x;const T=b(x);f.valueClass=f.valueClass.replace(/text-[^ ]+/,"text-"+T)}})})}),e.initReview[1].value.includes("通过")&&(e.initReview[2].value="可变更"),e.grid[1].value?.includes("待")&&(e.initReview[2].value="不可变更",e.initReview[2].valueClass=e.initReview[2].valueClass.replace(/text-[^ ]+/,"text-gray"))}return(s,d)=>{const t=H,y=X,C=Q,m=j;return w(),S("div",$e,[c(fe,{class:"h-[13vh] mb-[10px] shadowC"}),c(m,{form:h(e).itemDetail,"group-class":"itemDetailGrop"},{person:g(({slot:_})=>[c(C,{"title-class":"!text-[20px] bg-[white] flex items-center  font-bold"},{title:g(()=>[c(t,{name:"contact",class:"mr-2"}),q(" "+N(_.title),1)]),value:g(()=>[A("div",Ge,[c(y,{class:"!h-[24px]",onClick:B(x=>s.$copyText(_.orderId),["stop"])},{default:g(()=>[q(" 复制系统编号 ")]),_:2},1032,["onClick"]),c(y,{class:"!h-[24px] !ml-2",onClick:B(x=>s.$copyText(_.stageId),["stop"])},{default:g(()=>[q(" 复制进件编号 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},8,["form"]),c(m,{form:h(e).inquiry,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).customerInfo,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).survey,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).contractSign,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).record,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).initReview,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).build,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).grid,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).electricityContract,"group-class":"itemDetailGrop"},null,8,["form"]),h(p)?R("",!0):(w(),G(m,{key:0,form:h(e).ZYsettlement,"group-class":"itemDetailGrop"},null,8,["form"])),h(p)?(w(),G(m,{key:1,form:h(e).DLSsettlement,"group-class":"itemDetailGrop"},null,8,["form"])):R("",!0),c(m,{form:h(e).income,"group-class":"itemDetailGrop"},null,8,["form"])])}}};export{lt as default};
