import{m as j,_ as Z}from"./makeForm-C_uyyvx9.js";import{v as E,w as Y,a as I,x as U,b as W,y as H,l as Q}from"./vant-DL9g20lT.js";import{p as z}from"./plainButton-Bx2E2oUm.js";import{r as F,Z as w,_ as S,N as c,a8 as g,F as J,a4 as K,a0 as A,a3 as N,e as X,u as h,a2 as G,a5 as R,V as q,a1 as B}from"./@vue-BhOIXUCP.js";import{_ as ee,r as o,c as a,s as M,h as V,k as te,q as P,t as L}from"./index-NPFU1_kq.js";import{i as v}from"./class-rRG2y2aF.js";import{b as D,i as se}from"./Biztype-DPM88l-Q.js";import{q as le}from"./queryUrl-ggRt1bhs.js";import{l as ae}from"./lodash-C-AG1eJN.js";import{r as ie}from"./runTime-DAjLGjV1.js";import{g as k,f as re,i as O,a as oe,b as ne}from"./lodash-es-LCORa03k.js";import"./@vant-D2Uub16A.js";import"./pinia-CQ-jtR3-.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-XNYRUkAR.js";import"./@vueuse-BaMGbt4d.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-bC99Tnvx.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-VHbn-zkx.js";import"./vue3-photo-preview-Dedu722r.js";import"./vxe-table-BBegQXiE.js";import"./xe-utils-BM3aD2L3.js";import"./dayjs-Bof1u0Bp.js";import"./dom-zindex-GlLoxNk1.js";const ce={class:"overflow-x-scroll px-[17px] !bg-[#ffab30] pt-[3.2vh]"},ue={class:"text-[16px]"},pe={__name:"step",setup(l){F("");const e=["预审","客户信息","勘察","合同签约","备案证","初设评审","施工","并网","结算","购售电合同","完成"];return(i,r)=>{const p=E,u=Y;return w(),S("div",ce,[c(u,{active:3,class:"w-[200vw]"},{default:g(()=>[(w(),S(J,null,K(e,s=>c(p,{"inactive-color":"#ffffff","active-color":"#07c160","active-icon":"checked","inactive-icon":"more"},{default:g(()=>[A("p",ue,N(s),1)]),_:2},1024)),64))]),_:1})])}}},me=ee(pe,[["__scopeId","data-v-1cf38ebf"]]),n="!pl-[5px] !min-w-[30%]",fe=[{customSlot:"person",title:"任命",value:"value",orderId:"-",stageId:"-"},{formType:"cell",name:"orderId",title:"系统编号",valueClass:"mr-[10px] text-gray",titleClass:n,value:"-"},{formType:"cell",name:"designId",title:"进件编号",valueClass:"mr-[10px] text-gray",titleClass:n,value:"-"}],he=[{formType:"cell",title:"预审",titleClass:v,class:"!p-0 h-[50px]",onMounted(){this.hidden=D("")}},{formType:"cell",name:"/inquiry",title:"预审信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",onMounted(){this.hidden=D("")},click(){this.value!="未开启"?o.push({path:"/inquiry",query:{...a()}}):I(this.value)}}],de=[{formType:"cell",title:"客户信息",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/customerInfo",title:"客户信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){this.value!="未开启"?o.push({path:this.name,query:{...a()}}):I(this.value)}}],ve=[{formType:"cell",title:"勘察",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/businessReconnaissance",title:"业务踏勘",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){this.value!="未开启"?o.push({path:this.name,query:{...a()}}):I(this.value)}},{formType:"cell",name:"/technicalLnvestigation",title:"技术勘察",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){this.value!="未开启"?o.push({path:this.name,query:{...a()}}):I(this.value)}}],ye=[{formType:"cell",title:"合同签约",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/contractAward",title:"合同签约",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",async click(){se()?U({title:"合同签约",message:"提示：根据商务培训要求，选择正确的签约方式",confirmButtonText:"线上电子合同签约",cancelButtonText:"线下纸质合同签约",closeOnClickOverlay:!0}).then(()=>{o.push({path:this.name,query:{...a(),online:!0}})}).catch(()=>{o.push({path:this.name,query:{...a(),online:!1}})}):o.push({path:this.name,query:{...a()}})}}],xe=[{formType:"cell",title:"备案证及权属证明",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/certificate",title:"备案证及权属证明",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],ge=[{formType:"cell",title:"初设评审",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/InitialReview",title:"初设评审信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{orderId:a().orderId,title:this.title}})}},{formType:"cell",name:"/InitialReview",title:"设计变更信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{orderId:a().orderId,title:this.title}})}}],Ce=[{formType:"cell",title:"施工",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/build",title:"施工信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/DeviceInfo",title:"设备信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/buildVideo",title:"施工影像件信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}},{formType:"input",inputAlign:"center",name:"hasPutApprovalConstructBtn",realValue:!1,inlineForm:[{slot:"input",formType:"button",text:" 提交施工审核 ",className:"bg-[#ffab30] text-white h-8 w-[30%] rounded-2xl van-haptics-feedback",click(){M("hasPutApprovalConstructBtn",async l=>{if((await V.post(le("/approval/put-approval/bto/construction",{orderId:a().orderId,taskId:"CONSTRUCT"}))).code==200)W("提交成功"),location.reload();else{const i=ae.get(data,"data.msg","提交失败");I(i)}})}}]}],_e=[{formType:"cell",title:"并网",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnected",title:"并网信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],Te=[{formType:"cell",title:"直营结算",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/settlement",title:"直营结算信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],ke=[{formType:"cell",title:"供应商结算",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/gridConnectedAccount",title:"并网结算信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}},{formType:"cell",name:"/gridSettlement",title:"资料结算信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],we=[{formType:"cell",title:"购售电合同",titleClass:v,class:"!p-0 h-[50px]"},{formType:"cell",name:"/electricityContract",title:"购售电合同信息",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",click(){o.push({path:this.name,query:{...a()}})}}],Ie=[{formType:"cell",title:"收益查询",titleClass:v,class:"!p-0 h-[50px]",onMounted(){this.hidden=D("")}},{formType:"cell",name:"/income",title:"屋顶业主收益查询",valueClass:"mr-[10px] text-gray",titleClass:n,isLink:!0,value:"未开启",onMounted(){this.hidden=D("")},click(){o.push({path:this.name,query:{...a()}})}}];async function De(l){const e=[{target:l,prefix:"",path:""}],i=[],r=new Set;for(;e.length>0;){const{target:p,prefix:u,path:s}=e.pop();r.has(p)||(r.add(p),re(p,(d,t)=>{if(t=t+"",!(t.startsWith("_")||t.startsWith("ref"))){const y=s===""?`${t}`:`${s}.${t}`,C=s===""?`${t}`:`${u}.${t}`;i.push(y),O(d)&&e.push({target:d,prefix:C,path:y})}}))}return i}function qe(l){const e=new RegExp(`^${l.replace(/\*/g,".*")}$`);return i=>e.test(i)}async function Le(l,e){const i=await De(l),r=qe(e),p=[];for(let u=0;u<i.length;u++){const s=i[u];r(s)&&!s.includes(".ref.")&&p.push(s)}return p}async function b(l,e,i=()=>{}){const r=[];if(!e.includes("*")){let u=k(l,e);const s=e.split(".").slice(0,-1).join("."),d=k(l,s);return i(u,d,e),u}const p=await Le(l,e);for(let u=0;u<p.length;u++){const s=p[u];let d=k(l,s);const t=s.split(".").slice(0,-1).join("."),y=k(l,t);i(d,y,s),d=k(l,s),r.push(d)}return r.length===1?r[0]:r}function be(l,e){if(oe(l)){const i=l.length;for(let r=0;r<i;r++)e(l[r])}else O(l)&&ne(l,(i,r)=>{e(i,r)})}const Se={class:"bg-[#f3f3f3] min-h-[100vh] pb-[10px]"},$e={class:"flex justify-end items-end w-full"},lt={__name:"itemDetail",setup(l){let e=j({itemDetail:fe,inquiry:he,customerInfo:de,survey:ve,contractSign:ye,record:xe,initReview:ge,build:Ce,grid:_e,ZYsettlement:Te,DLSsettlement:ke,electricityContract:we,income:Ie}),i=a();const r=te(),p=F(!1);X(()=>{ie(u,"itemDetail - getData")});async function u(){const{data:s}=await V.post("/order/search",{queryTag:i.orderId,orderId:i.orderId});b(s,"list.0",t=>{e.itemDetail[0].title=t?.customer?.name||t?.customerOrg?.orgName||"-",e.itemDetail[2].value=t?.leaseReview?.contractNumber||"-",console.log(),p.value=t?.company?.type=="DLS",M("hasPutApprovalConstructBtn","realValue",t.hasPutApprovalConstructBtn)}),b(s,"*.currentOrderState.0",t=>{e.itemDetail[0].orderId=t?.orderId,e.itemDetail[1].value=t?.orderId}),P(t=>{t.valueClass&&(t.value="未开启",t.valueClass=t.valueClass.replace(/text-[^ ]+/,"text-gray"))});let d=!1;await b(s,"*.orderStates",async t=>{be(t,y=>{const C=y?.taskId,m=y?.stateId,_=y?.stageId,x=r[m]||"未开启",$=r[C]||r[_]||"";P(f=>{if(f.title==$&&f.isLink){f.value=x;const T=L(x);f.valueClass=f.valueClass.replace(/text-[^ ]+/,"text-"+T)}if(f.title=="合同签约"&&x=="起租"&&(d=!0),f.title=="屋顶业主收益查询"&&d){f.value="查询";const T=L(f.value);f.valueClass=f.valueClass.replace(/text-[^ ]+/,"text-"+T)}if(f.title?.includes("结算信息")&&$=="结算"){f.value=x;const T=L(x);f.valueClass=f.valueClass.replace(/text-[^ ]+/,"text-"+T)}})})}),e.initReview[1].value.includes("通过")&&(e.initReview[2].value="可变更"),e.grid[1].value?.includes("待")&&(e.initReview[2].value="不可变更",e.initReview[2].valueClass=e.initReview[2].valueClass.replace(/text-[^ ]+/,"text-gray"))}return(s,d)=>{const t=H,y=z,C=Q,m=Z;return w(),S("div",Se,[c(me,{class:"h-[13vh] mb-[10px] shadowC"}),c(m,{form:h(e).itemDetail,"group-class":"itemDetailGrop"},{person:g(({slot:_})=>[c(C,{"title-class":"!text-[20px] bg-[white] flex items-center  font-bold"},{title:g(()=>[c(t,{name:"contact",class:"mr-2"}),q(" "+N(_.title),1)]),value:g(()=>[A("div",$e,[c(y,{class:"!h-[24px]",onClick:B(x=>s.$copyText(_.orderId),["stop"])},{default:g(()=>[q(" 复制系统编号 ")]),_:2},1032,["onClick"]),c(y,{class:"!h-[24px] !ml-2",onClick:B(x=>s.$copyText(_.stageId),["stop"])},{default:g(()=>[q(" 复制进件编号 ")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:1},8,["form"]),c(m,{form:h(e).inquiry,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).customerInfo,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).survey,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).contractSign,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).record,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).initReview,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).build,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).grid,"group-class":"itemDetailGrop"},null,8,["form"]),c(m,{form:h(e).electricityContract,"group-class":"itemDetailGrop"},null,8,["form"]),h(p)?R("",!0):(w(),G(m,{key:0,form:h(e).ZYsettlement,"group-class":"itemDetailGrop"},null,8,["form"])),h(p)?(w(),G(m,{key:1,form:h(e).DLSsettlement,"group-class":"itemDetailGrop"},null,8,["form"])):R("",!0),c(m,{form:h(e).income,"group-class":"itemDetailGrop"},null,8,["form"])])}}};export{lt as default};
