import{a as E,b as G,I as A,F as j,D as M,f as K,g as O,h as X,B as H,i as J,j as Q,k as Y}from"./vant-BjNCsb4u.js";import{m as Z,c as V,_ as ee}from"./makeForm-B3HhMcgC.js";import{_ as oe}from"./vButton-wHtwW-5Z.js";import{d as se,K as C,r as te,aX as v,al as ae,am as m,N as r,u as o,bA as l,be as ne,aj as L,ak as re,V as u,bD as F}from"./@vue-ts87NNlE.js";import{m as le,b as ce}from"./backfill-xLooAZ69.js";import{h as x,s as k,g as S,u as ie,_ as me,a as pe,e as de,b as ue,r as fe}from"./index-L-kxfX5L.js";import{l as f}from"./lodash-DhpMPSDc.js";import{b as we,m as he}from"./makeSelect-CelQ3_Nu.js";import{q as U}from"./queryUrl-BTYYWpY7.js";import"./@vant-NmgEisJw.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./xe-utils-DXe260hc.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";const ge=[{...le("选择所属组织"),show:!1,name:"title"},{formType:"",name:"userId",value:"",loginInfo:{},backfill(w){this.value=w.userVo.userId}},{formType:"input",...we(),...he("companyId",[],"dymaic"),name:"companyId",label:"所属组织",async backfill(w){const{data:c}=await x.get(U("user-company/get-user-companies",{userId:w.userVo.userId})),p=c.map(a=>({text:a.company.name,value:a.company.companyId}));this.makeSelect("",p)}},{formType:"input",labelClass:"!w-0",name:"button",valueClass:"!w-1/2",inlineForm:[{slot:"input",formType:"button",text:"取消",size:"small",class:"w-full !rounded-none !border-[white]",click(){k("title","show",!1)}},{slot:"extra",formType:"button",text:"确认",size:"small",class:"w-1/2 !rounded-none !border-[#ffab30] !text-white !bg-[#ffab30]",async click(w){const c=S("companyId","realValue"),p=S("userId","value"),a=S("userId","loginInfo");console.log(c,p,a),(await x.post(U("user-company/update-user-current-company",{companyId:c,userId:p}))).code==200&&(await ie().getData(a),k("title","show",!1))}}]}],be={class:"h-full w-full flex-1 bg-white"},_e={class:"h-[30vh] w-full center bgImg"},ye={class:"h-[50vh] w-full pt-[5vh] px-[3vw]"},ve={class:"w-full px-[4.5vw] pt-[2vh]"},xe={class:"w-full xCenter px-[4vw] py-[2vh]"},ke={class:"h-[20vh] w-full flex flex-col"},Ie={class:"text-center my-auto text-[#9c9c9c] text-[16px]"},Ve={__name:"login",setup(w){const c=Z({companyForm:ge}),p=location.port==2222?"/orderh5":"",a=pe(),e=se({username:f.get(a,"usernameList[0].text"),password:f.get(a,"usernameList[0].password"),code:"",usernameList:[],usernameListShow:!1,passwordFlag:!0,passwordType:"password",passwordIcon:"closed-eye",usernameRule:C(V([t=>t.length||"用户名必填"])),passwordRule:C(V([t=>t.length||"密码必填"])),codeRule:C(V([t=>t.length||"验证码必填"]))}),i=te(!0);async function T(t){const s={phone:e.username,password:e.password,code:"",type:"password",systemType:"android",systemVersion:"6.0",appVersion:"2.4.16"},h=f.merge(s,t);k("userId","loginInfo",h);const{data:d}=await x.post("/login",h);if(!a.checked.includes("readed")){E("请阅读并同意博光 NEW 隐私政策和使用协议");return}if(a.info=d,t.text=t.phone,a.checked.includes("remember"))a.usernameList.unshift(f.omit(t,"phone")),a.usernameList=f.uniqBy(a.usernameList,"text");else{const y=a.usernameList.findIndex(I=>I.text==t.phone);a.usernameList.splice(y,1)}const g=(await x.get("order-state/dic")).data,_=ue();_.statusDic={...g.state,...g.stage,...g.task},_.tabbar=0,f.get(d,"userVo.curUserCompanyVo.company.name")?(fe.push({path:"/home",query:{title:"当前组织： "+d.userVo.curUserCompanyVo.company.name,tab:0}}),G({message:"登录成功",className:"shadowC"})):(ce(c,d),k("title","show",!0))}async function R(){console.log("获取验证码")}function $(){e.passwordFlag=!e.passwordFlag,e.passwordType=e.passwordFlag?"password":"text",e.passwordIcon=e.passwordFlag?"closed-eye":"eye-o"}function B(t){e.usernameList=a.usernameList.filter(s=>s.text.includes(t)),e.usernameListShow=new Boolean(e.usernameList.length),e.usernameListShow=!!t.length}function P(t){e.username=t.text,e.password=t.password}return de({getData:T}),(t,s)=>{const h=A,d=O,b=X,g=H,_=J,y=Q,I=Y,D=oe,N=j,z=M,W=ee,q=K;return v(),ae("div",be,[m("div",_e,[r(h,{width:"100",height:"100",src:`${o(p)}/icons/loginRegister/btoWhiteLogo.png`},null,8,["src"])]),m("div",ye,[r(N,{onSubmit:T},{default:l(()=>[r(_,{inset:""},{default:l(()=>[r(b,{modelValue:o(e).username,"onUpdate:modelValue":[s[1]||(s[1]=n=>o(e).username=n),B],name:"phone",label:"",placeholder:"请输入账号",rules:o(e).usernameRule,"right-icon":"arrow","left-icon":"contact",clearable:"",class:"!bg-[#f2f5f9] mb-[1vh] shadow-inner rounded-lg",onClickRightIcon:s[2]||(s[2]=n=>o(e).usernameListShow=!o(e).usernameListShow)},{extra:l(()=>[o(i)?(v(),L(d,{key:0,show:o(e).usernameListShow,"onUpdate:show":s[0]||(s[0]=n=>o(e).usernameListShow=n),actions:o(e).usernameList,onSelect:P,placement:"bottom-end"},null,8,["show","actions"])):re("",!0)]),_:1},8,["modelValue","rules"]),o(i)?(v(),L(b,{key:0,modelValue:o(e).password,"onUpdate:modelValue":s[3]||(s[3]=n=>o(e).password=n),"right-icon":o(e).passwordIcon,"left-icon":o(i)?"lock":"chat-o",onClickRightIcon:$,type:o(i)?o(e).passwordType:"",class:"!bg-[#f2f5f9] shadow-inner rounded-lg",name:o(i)?"password":"code",placeholder:"请输入密码",clearable:"",rules:o(e).passwordRule},null,8,["modelValue","right-icon","left-icon","type","name","rules"])):(v(),L(b,{key:1,modelValue:o(e).code,"onUpdate:modelValue":s[4]||(s[4]=n=>o(e).code=n),"left-icon":"comment-circle",class:"!bg-[#f2f5f9] shadow-inner rounded-lg",name:"code",clearable:"",rules:o(e).codeRule,placeholder:"请输入验证码"},{button:l(()=>[r(g,{onClick:R,size:"small",type:"warning",class:"!bg-[#ffab30] !h-[24px] shadow-md"},{default:l(()=>[u("获取验证码")]),_:1})]),_:1},8,["modelValue","rules"]))]),_:1}),m("div",ve,[r(I,{modelValue:o(a).checked,"onUpdate:modelValue":s[7]||(s[7]=n=>o(a).checked=n)},{default:l(()=>[r(y,{"icon-size":"16px","checked-color":"#ffab30",name:"remember"},{default:l(()=>[u("记住密码")]),_:1}),r(y,{class:"py-[1vh]","icon-size":"16px","checked-color":"#ffab30",name:"readed"},{default:l(()=>[u(" 我已阅读并同意博光NEW "),m("a",{class:"text-[blue]",onClick:s[5]||(s[5]=F(n=>t.$openWeb("https://www.btosolarman.com/APP/boGuangAPP/privacy.txt","隐私政策"),["stop"]))},"隐私政策"),u(" 和 "),m("a",{class:"text-[blue]",onClick:s[6]||(s[6]=F(n=>t.$openWeb("/orderh5/protocolOfUsage.html","使用协议"),["stop"]))},"使用协议")]),_:1})]),_:1},8,["modelValue"])]),m("div",xe,[r(D,{class:"!w-full","native-type":"submit"},{default:l(()=>[u("登录")]),_:1})])]),_:1})]),m("div",ke,[r(z,{style:{borderColor:"#9c9c9c",padding:"0 16px"}},{default:l(()=>[u("其他登录方式")]),_:1}),m("div",{class:"h-[30%] xCenter",onClick:s[8]||(s[8]=n=>i.value=!o(i))},[r(h,{class:"w-[8%]",mode:"aspectFit",src:`${o(p)}/icons/loginRegister/phone.png`},null,8,["src"])]),m("div",Ie,ne(o(i)?"密码登录":"验证码登录"),1)]),r(q,{show:o(c).companyForm[0].show,"onUpdate:show":s[10]||(s[10]=n=>o(c).companyForm[0].show=n),round:"",teleport:"#app","transition-appear":""},{"overlay-content":l(()=>[r(W,{onClick:s[9]||(s[9]=F(()=>{},["prevent"])),form:o(c).companyForm,class:"pt-[20vh] mx-10","group-class":"shadowC"},null,8,["form"])]),_:1},8,["show"])])}}},Qe=me(Ve,[["__scopeId","data-v-b8ca6038"]]);export{Qe as default};
