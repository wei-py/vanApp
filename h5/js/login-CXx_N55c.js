import{a as q,b as E,F as G,D as A,f as j,I as M,g as K,h as O,B as X,i as H,j as J,k as Q}from"./vant-Ckwj66YG.js";import{m as Y,c as V,_ as Z}from"./makeForm-DgvH7MRW.js";import{_ as ee}from"./vButton-BZ9jSBPU.js";import{d as oe,K as C,r as se,aX as y,al as te,am as m,N as r,bA as l,u as o,be as ae,aj as L,ak as ne,V as d,bD as F}from"./@vue-ts87NNlE.js";import{m as re,b as le}from"./backfill-D0WLbo-C.js";import{h as v,s as x,g as S,u as ie,_ as ce,a as me,e as pe,b as de,r as ue}from"./index-DwbTWwPI.js";import{l as u}from"./lodash-DhpMPSDc.js";import{b as fe,m as we}from"./makeSelect-BqBItR9B.js";import{q as T}from"./queryUrl-BTYYWpY7.js";import"./@vant-NmgEisJw.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./xe-utils-DXe260hc.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";const he=[{...re("选择所属组织"),show:!1,name:"title"},{formType:"",name:"userId",value:"",loginInfo:{},backfill(f){this.value=f.userVo.userId}},{formType:"input",...fe(),...we("companyId",[],"dymaic"),name:"companyId",label:"所属组织",async backfill(f){const{data:i}=await v.get(T("user-company/get-user-companies",{userId:f.userVo.userId})),a=i.map(e=>({text:e.company.name,value:e.company.companyId}));this.makeSelect("",a)}},{formType:"input",labelClass:"!w-0",name:"button",valueClass:"!w-1/2",inlineForm:[{slot:"input",formType:"button",text:"取消",size:"small",class:"w-full !rounded-none !border-[white]",click(){x("title","show",!1)}},{slot:"extra",formType:"button",text:"确认",size:"small",class:"w-1/2 !rounded-none !border-[#ffab30] !text-white !bg-[#ffab30]",async click(f){const i=S("companyId","realValue"),a=S("userId","value"),e=S("userId","loginInfo");console.log(i,a,e),(await v.post(T("user-company/update-user-current-company",{companyId:i,userId:a}))).code==200&&(await ie().getData(e),x("title","show",!1))}}]}],ge={class:"h-full w-full flex-1 bg-white"},be={class:"h-[30vh] w-full center bgImg"},_e={class:"h-[50vh] w-full pt-[5vh] px-[3vw]"},ye={class:"w-full px-[4.5vw] pt-[2vh]"},ve={class:"w-full xCenter px-[4vw] py-[2vh]"},xe={class:"h-[20vh] w-full flex flex-col"},ke={class:"text-center my-auto text-[#9c9c9c] text-[16px]"},Ie={__name:"login",setup(f){const i=Y({companyForm:he}),a=me(),e=oe({username:u.get(a,"usernameList[0].text"),password:u.get(a,"usernameList[0].password"),code:"",usernameList:[],usernameListShow:!1,passwordFlag:!0,passwordType:"password",passwordIcon:"closed-eye",usernameRule:C(V([t=>t.length||"用户名必填"])),passwordRule:C(V([t=>t.length||"密码必填"])),codeRule:C(V([t=>t.length||"验证码必填"]))}),c=se(!0);async function k(t){const s={phone:e.username,password:e.password,code:"",type:"password",systemType:"android",systemVersion:"6.0",appVersion:"2.4.16"},w=u.merge(s,t);x("userId","loginInfo",w);const{data:p}=await v.post("/login",w);if(!a.checked.includes("readed")){q("请阅读并同意博光 NEW 隐私政策和使用协议");return}if(a.info=p,t.text=t.phone,a.checked.includes("remember"))a.usernameList.unshift(u.omit(t,"phone")),a.usernameList=u.uniqBy(a.usernameList,"text");else{const _=a.usernameList.findIndex(I=>I.text==t.phone);a.usernameList.splice(_,1)}const h=(await v.get("order-state/dic")).data,b=de();b.statusDic={...h.state,...h.stage,...h.task},b.tabbar=0,u.get(p,"userVo.curUserCompanyVo.company.name")?(ue.push({path:"/home",query:{title:"当前组织： "+p.userVo.curUserCompanyVo.company.name,tab:0}}),E({message:"登录成功",className:"shadowC"})):(le(i,p),x("title","show",!0))}async function U(){console.log("获取验证码")}function R(){e.passwordFlag=!e.passwordFlag,e.passwordType=e.passwordFlag?"password":"text",e.passwordIcon=e.passwordFlag?"closed-eye":"eye-o"}function B(t){e.usernameList=a.usernameList.filter(s=>s.text.includes(t)),e.usernameListShow=new Boolean(e.usernameList.length),e.usernameListShow=!!t.length}function P(t){e.username=t.text,e.password=t.password}return pe({getData:k}),(t,s)=>{const w=M,p=K,g=O,h=X,b=H,_=J,I=Q,D=ee,N=G,$=A,z=Z,W=j;return y(),te("div",ge,[m("div",be,[r(w,{width:"100",height:"100",src:"./icons/loginRegister/btoWhiteLogo.png"})]),m("div",_e,[r(N,{onSubmit:k},{default:l(()=>[r(b,{inset:""},{default:l(()=>[r(g,{modelValue:o(e).username,"onUpdate:modelValue":[s[1]||(s[1]=n=>o(e).username=n),B],name:"phone",label:"",placeholder:"请输入账号",rules:o(e).usernameRule,"right-icon":"arrow","left-icon":"contact",clearable:"",class:"!bg-[#f2f5f9] mb-[1vh] shadow-inner rounded-lg",onClickRightIcon:s[2]||(s[2]=n=>o(e).usernameListShow=!o(e).usernameListShow)},{extra:l(()=>[o(c)?(y(),L(p,{key:0,show:o(e).usernameListShow,"onUpdate:show":s[0]||(s[0]=n=>o(e).usernameListShow=n),actions:o(e).usernameList,onSelect:P,placement:"bottom-end"},null,8,["show","actions"])):ne("",!0)]),_:1},8,["modelValue","rules"]),o(c)?(y(),L(g,{key:0,modelValue:o(e).password,"onUpdate:modelValue":s[3]||(s[3]=n=>o(e).password=n),"right-icon":o(e).passwordIcon,"left-icon":o(c)?"lock":"chat-o",onClickRightIcon:R,type:o(c)?o(e).passwordType:"",class:"!bg-[#f2f5f9] shadow-inner rounded-lg",name:o(c)?"password":"code",placeholder:"请输入密码",clearable:"",rules:o(e).passwordRule},null,8,["modelValue","right-icon","left-icon","type","name","rules"])):(y(),L(g,{key:1,modelValue:o(e).code,"onUpdate:modelValue":s[4]||(s[4]=n=>o(e).code=n),"left-icon":"comment-circle",class:"!bg-[#f2f5f9] shadow-inner rounded-lg",name:"code",clearable:"",rules:o(e).codeRule,placeholder:"请输入验证码"},{button:l(()=>[r(h,{onClick:U,size:"small",type:"warning",class:"!bg-[#ffab30] !h-[24px] shadow-md"},{default:l(()=>[d("获取验证码")]),_:1})]),_:1},8,["modelValue","rules"]))]),_:1}),m("div",ye,[r(I,{modelValue:o(a).checked,"onUpdate:modelValue":s[7]||(s[7]=n=>o(a).checked=n)},{default:l(()=>[r(_,{"icon-size":"16px","checked-color":"#ffab30",name:"remember"},{default:l(()=>[d("记住密码")]),_:1}),r(_,{class:"py-[1vh]","icon-size":"16px","checked-color":"#ffab30",name:"readed"},{default:l(()=>[d(" 我已阅读并同意博光NEW "),m("a",{class:"text-[blue]",onClick:s[5]||(s[5]=F(n=>t.$openWeb("https://www.btosolarman.com/APP/boGuangAPP/privacy.txt","隐私政策"),["stop"]))},"隐私政策"),d(" 和 "),m("a",{class:"text-[blue]",onClick:s[6]||(s[6]=F(n=>t.$openWeb("/orderh5/protocolOfUsage.html","使用协议"),["stop"]))},"使用协议")]),_:1})]),_:1},8,["modelValue"])]),m("div",ve,[r(D,{class:"!w-full","native-type":"submit"},{default:l(()=>[d("登录")]),_:1})])]),_:1})]),m("div",xe,[r($,{style:{borderColor:"#9c9c9c",padding:"0 16px"}},{default:l(()=>[d("其他登录方式")]),_:1}),m("div",{class:"h-[30%] xCenter",onClick:s[8]||(s[8]=n=>c.value=!o(c))},[r(w,{class:"w-[8%]",mode:"aspectFit",src:"./icons/loginRegister/phone.png"})]),m("div",ke,ae(o(c)?"密码登录":"验证码登录"),1)]),r(W,{show:o(i).companyForm[0].show,"onUpdate:show":s[10]||(s[10]=n=>o(i).companyForm[0].show=n),round:"",teleport:"#app","transition-appear":""},{"overlay-content":l(()=>[r(z,{onClick:s[9]||(s[9]=F(()=>{},["prevent"])),form:o(i).companyForm,class:"pt-[20vh] mx-10","group-class":"shadowC"},null,8,["form"])]),_:1},8,["show"])])}}},Je=ce(Ie,[["__scopeId","data-v-bd68090d"]]);export{Je as default};
