import{b as E,F as M,D as A,e as J,I as K,f as O,g as Z,B as j,C as H,h as Q,i as X}from"./vant-DL9g20lT.js";import{m as Y,c as k,_ as ee}from"./makeForm-C_uyyvx9.js";import{_ as oe}from"./vButton-CI7Mesoe.js";import{d as se,K as I,r as R,Z as _,_ as te,a0 as m,N as n,a8 as l,u as o,a3 as ae,a2 as C,a5 as ne,V as u,i as le,a1 as V}from"./@vue-BhOIXUCP.js";import{m as re,b as ie}from"./backfill-hh-glB-L.js";import{h as y,s as b,g as L,u as ce,_ as me,a as pe,e as ue,b as de,r as fe}from"./index-NPFU1_kq.js";import{l as v}from"./lodash-C-AG1eJN.js";import{b as we,m as he}from"./makeSelect-BzGYyrzS.js";import{q as T}from"./queryUrl-ggRt1bhs.js";import"./@vant-D2Uub16A.js";import"./class-rRG2y2aF.js";import"./pinia-CQ-jtR3-.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-XNYRUkAR.js";import"./@vueuse-BaMGbt4d.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-bC99Tnvx.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-VHbn-zkx.js";import"./vue3-photo-preview-Dedu722r.js";import"./vxe-table-BBegQXiE.js";import"./xe-utils-BM3aD2L3.js";import"./dayjs-Bof1u0Bp.js";import"./dom-zindex-GlLoxNk1.js";const ge=[{...re("选择所属组织"),show:!1,name:"title"},{formType:"",name:"userId",value:"",loginInfo:{},backfill(d){this.value=d.userVo.userId}},{formType:"input",...we(),...he("companyId",[],"dymaic"),name:"companyId",label:"所属组织",async backfill(d){const{data:i}=await y.get(T("user-company/get-user-companies",{userId:d.userVo.userId})),r=i.map(e=>({text:e.company.name,value:e.company.companyId}));this.makeSelect("",r)}},{formType:"input",labelClass:"!w-0",name:"button",valueClass:"!w-1/2",inlineForm:[{slot:"input",formType:"button",text:"取消",size:"small",class:"w-full !rounded-none !border-[white]",click(){b("title","show",!1)}},{slot:"extra",formType:"button",text:"确认",size:"small",class:"w-1/2 !rounded-none !border-[#ffab30] !text-white !bg-[#ffab30]",async click(d){const i=L("companyId","realValue"),r=L("userId","value"),e=L("userId","loginInfo");console.log(i,r,e),(await y.post(T("user-company/update-user-current-company",{companyId:i,userId:r}))).code==200&&(await ce().getData(e),b("title","show",!1))}}]}],_e={class:"h-full w-full flex-1"},ve={class:"h-[30vh] w-full center bgImg"},ye={class:"h-[50vh] w-full pt-[5vh] px-[3vw]"},be={class:"w-full px-[4.5vw] pt-[2vh]"},xe={class:"w-full xCenter px-[4vw] py-[2vh]"},ke={class:"h-[20vh] w-full flex flex-col"},Ie={class:"text-center my-auto text-[#9c9c9c]"},Ce={__name:"login",setup(d){const i=Y({companyForm:ge}),r=pe(),e=se({username:"superadmin",password:"123456",code:"",usernameList:[],usernameListShow:!1,passwordFlag:!0,passwordType:"password",passwordIcon:"closed-eye",usernameRule:I(k([t=>t.length||"用户名必填"])),passwordRule:I(k([t=>t.length||"密码必填"])),codeRule:I(k([t=>t.length||"验证码必填"]))}),h=R([]),c=R(!0);async function F(t){const s={phone:"superadmin",password:"CMJBG06#",code:"",type:"password",systemType:"android",systemVersion:"6.0",appVersion:"2.4.16"},f=v.merge(s,t);b("userId","loginInfo",f);const{data:p}=await y.post("/login",f);r.info=p,t.text=t.phone,r.usernameList.unshift(v.omit(t,"phone")),r.usernameList=v.uniqBy(r.usernameList,"text");const w=(await y.get("order-state/dic")).data,x=de();x.statusDic={...w.state,...w.stage,...w.task},v.get(p,"userVo.curUserCompanyVo.company.name")?(fe.push({path:"/home",query:{title:"当前组织： "+p.userVo.curUserCompanyVo.company.name,tab:0}}),E({message:"登录成功",className:"shadowC"})):(ie(i,p),b("title","show",!0))}async function U(){console.log("获取验证码")}function B(){e.passwordFlag=!e.passwordFlag,e.passwordType=e.passwordFlag?"password":"text",e.passwordIcon=e.passwordFlag?"closed-eye":"eye-o"}function P(t){e.usernameList=r.usernameList.filter(s=>s.text.includes(t)),e.usernameListShow=new Boolean(e.usernameList.length),e.usernameListShow=!!t.length}function $(t){e.username=t.text,e.password=t.password}return ue({getData:F}),(t,s)=>{const f=K,p=O,g=Z,w=j,x=H,S=Q,D=X,N=oe,z=M,G=A,q=ee,W=J;return _(),te("div",_e,[m("div",ve,[n(f,{width:"100",height:"100",src:"./icons/loginRegister/btoWhiteLogo.png"})]),m("div",ye,[n(z,{onSubmit:F},{default:l(()=>[n(x,{inset:""},{default:l(()=>[n(g,{modelValue:o(e).username,"onUpdate:modelValue":[s[1]||(s[1]=a=>o(e).username=a),P],name:"phone",label:"",placeholder:"请输入账号",rules:o(e).usernameRule,"right-icon":"arrow","left-icon":"contact",clearable:"",class:"!bg-[#f2f5f9] mb-[1vh] shadow-inner rounded-lg",onClickRightIcon:s[2]||(s[2]=a=>o(e).usernameListShow=!o(e).usernameListShow)},{extra:l(()=>[o(c)?(_(),C(p,{key:0,show:o(e).usernameListShow,"onUpdate:show":s[0]||(s[0]=a=>o(e).usernameListShow=a),actions:o(e).usernameList,onSelect:$,placement:"bottom-end"},null,8,["show","actions"])):ne("",!0)]),_:1},8,["modelValue","rules"]),o(c)?(_(),C(g,{key:0,modelValue:o(e).password,"onUpdate:modelValue":s[3]||(s[3]=a=>o(e).password=a),"right-icon":o(e).passwordIcon,"left-icon":o(c)?"lock":"chat-o",onClickRightIcon:B,type:o(c)?o(e).passwordType:"",class:"!bg-[#f2f5f9] shadow-inner rounded-lg",name:o(c)?"password":"code",placeholder:"请输入密码",clearable:"",rules:o(e).passwordRule},null,8,["modelValue","right-icon","left-icon","type","name","rules"])):(_(),C(g,{key:1,modelValue:o(e).code,"onUpdate:modelValue":s[4]||(s[4]=a=>o(e).code=a),"left-icon":"comment-circle",class:"!bg-[#f2f5f9] shadow-inner rounded-lg",name:"code",clearable:"",rules:o(e).codeRule,placeholder:"请输入验证码"},{button:l(()=>[n(w,{onClick:U,size:"small",type:"warning",class:"!bg-[#ffab30] !h-[24px] shadow-md"},{default:l(()=>[u("获取验证码")]),_:1})]),_:1},8,["modelValue","rules"]))]),_:1}),m("div",be,[n(D,{modelValue:o(h),"onUpdate:modelValue":s[7]||(s[7]=a=>le(h)?h.value=a:null)},{default:l(()=>[n(S,{"icon-size":"18px","checked-color":"#ffab30",name:"remember"},{default:l(()=>[u("记住密码")]),_:1}),n(S,{class:"py-[1vh]","icon-size":"18px","checked-color":"#ffab30",name:"readed"},{default:l(()=>[u(" 我已阅读并同意博光NEW "),m("a",{class:"text-[blue]",onClick:s[5]||(s[5]=V(a=>t.$openWeb("https://www.btosolarman.com/APP/boGuangAPP/privacy.txt","隐私政策"),["stop"]))},"隐私政策"),u(" 和 "),m("a",{class:"text-[blue]",onClick:s[6]||(s[6]=V(a=>t.$openWeb("/protocolOfUsage.html","使用协议"),["stop"]))},"使用协议")]),_:1})]),_:1},8,["modelValue"])]),m("div",xe,[n(N,{class:"!w-full","native-type":"submit"},{default:l(()=>[u("登录")]),_:1})])]),_:1})]),m("div",ke,[n(G,{style:{borderColor:"#9c9c9c",padding:"0 16px"}},{default:l(()=>[u("其他登录方式")]),_:1}),m("div",{class:"h-[30%] xCenter",onClick:s[8]||(s[8]=a=>c.value=!o(c))},[n(f,{class:"w-[8%]",mode:"aspectFit",src:"./icons/loginRegister/phone.png"})]),m("div",Ie,ae(o(c)?"密码登录":"验证码登录"),1)]),n(W,{show:o(i).companyForm[0].show,"onUpdate:show":s[10]||(s[10]=a=>o(i).companyForm[0].show=a),round:"",teleport:"#app","transition-appear":""},{"overlay-content":l(()=>[n(q,{onClick:s[9]||(s[9]=V(()=>{},["prevent"])),form:o(i).companyForm,class:"pt-[20vh] mx-10","group-class":"shadowC"},null,8,["form"])]),_:1},8,["show"])])}}},He=me(Ce,[["__scopeId","data-v-e6ca420d"]]);export{He as default};
