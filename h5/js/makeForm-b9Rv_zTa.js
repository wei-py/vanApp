import{g as R,K as P,l as T,e as N,f as $,M as A,O as G,Q as L,B as O,U as j,V as z,u as K,R as X,y as q,W as Q,X as W,I as Y,Y as H,C as J,F as Z}from"./vant-xiv0EFx3.js";import{e as ee,o as w,b3 as oe,aX as f,al as k,b1 as y,F,b2 as D,aj as h,ar as S,u as p,bA as d,N as _,V as ne,P as se,bD as I,b4 as ae,ak as re,i as te,c as b,X as le,Q as ce,G as ue,d as ie,aS as pe}from"./@vue-BHA94vdH.js";import{L as de,F as U,b as fe,u as ge,M as me}from"./index-BiU8ePZK.js";import{l as s,a as he}from"./lodash-C1iNKp1x.js";const V={input:R,switch:P,cell:T,popup:N,popover:$,cascader:A,calendar:G,pick:L,button:O,upload:j,numberKeyboard:z,radioGroup:K,radio:X,icon:q,date:Q,text:W};function _e(e){let t=s.get(e,"labelClass","");return t+=" !min-w-[30%]",t=s.uniq(t.split(" ")).join(" "),s.set(e,"labelClass",t),s.has(e,"inputAlign")||(e.inputAlign="right"),e.formType=="input"&&ve(e),V[e.formType]||e.formType}function ve(e){s.isUndefined(e.type)&&(e.type="textarea"),s.merge(e,{autosize:!0,rows:"1"})}const Ce={__name:"recuDynComponent",props:{form:{},title:{},titleClass:{},fullPath:{}},setup(e){Date.now()+s.random(0,100);const t=e;function a(c){const i=[];return s.omit(c,["formType","inlineForm","realValue",...i])}function l(c){let i=!1;return s.isBoolean(c.hidden)&&(i=c.hidden),s.isFunction(c.hidden)&&(i=c.hidden()),te(c.hidden)&&(i=c.hidden),i}ee(()=>{}),w(()=>{});function r(c,i,...g){return s.isFunction(c[i])?c[i](...g):()=>{}}return(c,i)=>{const g=oe("recuDynComponent",!0),m=Y,v=H;return f(!0),k(F,null,y([t.form].flat(),(n,u)=>(f(),k(F,{key:u},[D(c.$slots,n.customSlot),l(n)?re("",!0):(f(),h(ae(p(V)[n.formType]),se({key:0,modelValue:n.value,"onUpdate:modelValue":o=>n.value=o,show:n.show,"onUpdate:show":o=>n.show=o,ref_for:!0},a(n),{onClick:I((...o)=>r(n,"click",...o),["stop"]),onClose:(...o)=>r(n,"close",...o),onFinish:(...o)=>r(n,"finish",...o),onClickRightIcon:(...o)=>r(n,"clickRightIcon",...o),onClickLeftIcon:(...o)=>r(n,"clickLeftIcon",...o),onClickOverlay:I((...o)=>r(n,"clickOverlay",...o),["stop"]),onConfirm:(...o)=>r(n,"confirm",...o),onInput:(...o)=>r(n,"input",...o),onBlur:(...o)=>r(n,"blur",...o),onSelect:(...o)=>r(n,"select",...o),onClickPreview:(...o)=>r(n,"clickPreview",...o),onCancel:(...o)=>r(n,"cancel",...o),"onUpdate:modelValue":(...o)=>r(n,"updateValue",...o)}),S({"preview-cover":d(o=>[p(de)(o)?(f(),h(m,{key:1,src:o.url||o.objectUrl,class:"w-[80px] h-[80px] bg-[#f7f8fa]",fit:"cover"},{error:d(()=>[ne("加载失败")]),loading:d(()=>[_(v,{type:"spinner",size:"20"})]),_:2},1032,["src"])):(f(),h(m,{key:0,src:"./background/pdf.png",class:"w-[80px] h-[80px] !rounded-[8px] bg-[#f7f8fa]",fit:"contain"}))]),_:2},[y(p(he.get)(n,"inlineForm",[]),o=>({name:o.slot,fn:d(()=>[_(g,{form:o},null,8,["form"])])}))]),1040,["modelValue","onUpdate:modelValue","show","onUpdate:show","onClick","onClose","onFinish","onClickRightIcon","onClickLeftIcon","onClickOverlay","onConfirm","onInput","onBlur","onSelect","onClickPreview","onCancel"]))],64))),128)}}},De={__name:"vantForm",props:{form:{},title:{},titleClass:{},groupClass:{},approvalName:{},readonly:{},disabled:{},showErrorMessage:{}},emits:["submit"],setup(e,{emit:t}){const a=e,l=U(),r=fe(),c=b(()=>s.isUndefined(a.readonly)?!r.btns.canEdit:a.readonly),i=b(()=>s.isUndefined(a.disabled)?!r.btns.canEdit:a.disabled),g=b(()=>s.isUndefined(a.showErrorMessage)?r.btns.canEdit:a.showErrorMessage),m=[a.form].flat().filter(u=>u?.customSlot).map(u=>u.customSlot);function v(u){return s.find(a.form,o=>o.customSlot==u)}function n(u){u&&l.submitDoms.push(u),a.approvalName&&(l.approvalDoms[a.approvalName]=u)}return w(()=>{l.submitDoms.length=0,l.approvalDoms={}}),(u,o)=>{const B=J,E=Z,M=le("skeleton");return ce((f(),h(E,{ref:n,readonly:p(c),disabled:p(i),"show-error-message":p(g)},{default:d(()=>[_(B,{inset:"",class:ue([a.groupClass,""])},{default:d(()=>[_(Ce,{form:a.form},S({_:2},[y(p(m),C=>({name:C,fn:d(()=>[D(u.$slots,C,{slot:v(C)})])}))]),1032,["form"])]),_:3},8,["class"])]),_:3},8,["readonly","disabled","show-error-message"])),[[M,p(r).overlayShow]])}}};function be(e){return e.map(t=>({validator(a){const l=t(a);return this.message=l,!s.get(l,"length")},message:"",trigger:"onSubmit"}))}function ye(e){if(s.isFunction(e)&&console.log(e()),e.required){const a=e.label;e.rules=[...s.get(e,"rules",[]),l=>l.length||`${a}必填`]}s.forIn(e,async(a,l)=>{l=="formType"&&_e(e),l=="inlineForm"&&x(e[l]),l=="rules"&&e.rules.length&&!e.rulesFlag&&(e.rulesFlag=!0,e.rules=[...be(e[l])]),l=="onMounted"&&pe(async()=>{await e.onMounted(e)})}),s.isArray(e.menuRight)||(e.menuRight=[]),e.class=s.get(e,"class","");const t=s.get(e,"name","");return e.class+=` ${t}`,e}function x(e){for(let t=0;t<e.length;t++)s.isFunction(e[t])?e[t]=e[t]():e[t]=ye(e[t]);return e}function Se(e,t=!0){e=s.mapValues(e,l=>x(l).flat());const a=ie(e);return t&&(me._=a),w(()=>{U().$reset();const r=ge();r.approvalBackfill=()=>{},r.$reset()}),a}export{De as _,be as c,Se as m};
