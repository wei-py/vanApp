import{E as l,c as F,h as y,b as D,L as d,B as p,r as q,F as v,N as P,O as T,G as m,P as I}from"./index-D0ldpvYI.js";import{l as r}from"./lodash-D-SkTV7p.js";import{a as j}from"./axios-B6xwUs71.js";import{q as R}from"./queryUrl-DaTGvNW7.js";import{c as b,r as S}from"./@vue-ts87NNlE.js";let x="";async function N(s,t=F()?.orderId,i="image"){if(r.isUndefined(t))return URL.createObjectURL(s);const u="https://up-cn-east-2.qiniup.com";await O(t,i);const o=new FormData;o.append("file",s),o.append("token",x);const{data:c}=await j.post(u,o);return l(c.src||c.data.src)}async function O(s,t){const i=R("file/get-qiniu-upload-token",{orderId:s,fileType:t}),{data:u}=await y.get(i);x=u.upToken}function B(s=999,t=100,i="image/*",u=!1,o,c){const w=D(),f=b(()=>w.btns.canEdit);let h=f,g=b(()=>!f.value);return r.isUndefined(o)||(g=o,h=!o),{formType:"input",value:"",longPress:!0,class:`flex-col-reverse !px-0 !mx-0  !float-left !w-[${t}%]`,labelClass:"xCenter !w-[100%] !m-0 !text-xs",inlineForm:[{slot:"input",formType:"upload",maxCount:s,multiple:s>1,accept:i,required:u,deletable:h,disabled:g,previewFullImage:!1,clickPreview(e){if(d(e)){const n=v();n.imgIndex=n.imgDoms.findIndex(a=>a==(p(e)||e.objectUrl)),n.showPreviewImg=!0}else{const n=p(e)||e.objectUrl;q.push({path:"/previewFile",query:{url:n}});return}},value:[],uploadIcon:"plus",class:"mx-auto mt-2",beforeDelete(e){if(!d(e))return!0;const n=v(),a=n.imgDoms.findIndex(U=>U==p(e));return n.imgDoms.splice(a,1),!0},beforeRead(e,...n){return console.log(...n),e.status=S("uploading"),N(e,F()?.orderId||c).then(a=>{e.src=a,e.url=a,e.status.value="done"}),e},async afterRead(e,n,a){await P(),e.status=e.file.status},menuRight:[{label:"下载图片到相册",click:(...e)=>{const n=T();console.log(n)}}]}],backfill(e){this.inlineForm[0].value=e[this.name]?[{url:l(e[this.name]),status:"done"}]:[],m(l(e[this.name]))},onMounted(){this.inlineForm[0].value.length=0},getParam(e){console.log(e,3333);const n=r.get(this,"inlineForm.0.value.0.file.url")||r.get(this,"inlineForm.0.value.0.url","");e[this.name]=n}}}function C(s){r.isArray(s[this.name])?(this.inlineForm[0].value=s[this.name].map(t=>({url:l(t)})),m(...this.inlineForm[0].value.map(t=>t.url))):r.isString(s[this.name])&&(s[this.name].startsWith("[")?(this.inlineForm[0].value=JSON.parse(s[this.name]).map(t=>({url:l(t),...k()})),console.log(this.inlineForm[0].value,this.name),m(...this.inlineForm[0].value.map(t=>t.url))):I(s[this.name])&&(this.inlineForm[0].value=[{url:l(s[this.name])}],m(l(s[this.name]))))}function G(s){let t=[];return r.isArray(s)?t=s.map(i=>({url:l(i)})):r.isString(s)&&(s.startsWith("[")?t=JSON.parse(s).map(i=>({url:l(i),...k()})):I(s)&&(t=[{url:l(s)}])),m(...t.map(i=>i.url)),t}function k(s,t="object"){if(t=="object")return{}}export{C as a,G as b,B as m};
