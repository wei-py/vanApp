import{G as i,c as I,h as U,b as D,N as g,E as f,u as q,r as P,H as v,O as T,P as j,I as m,Q as w}from"./index-B7VWkQ_2.js";import{l as a}from"./lodash-DhpMPSDc.js";import{a as R}from"./axios-B4uVmeYG.js";import{q as S}from"./queryUrl-BTYYWpY7.js";import{c as b,r as E}from"./@vue-ts87NNlE.js";let x="";async function N(s,t=I()?.orderId,r="image"){if(a.isUndefined(t))return URL.createObjectURL(s);const u="https://up-cn-east-2.qiniup.com";await O(t,r);const o=new FormData;o.append("file",s),o.append("token",x);const{data:c}=await R.post(u,o);return i(c.src||c.data.src)}async function O(s,t){const r=S("file/get-qiniu-upload-token",{orderId:s,fileType:t}),{data:u}=await U.get(r);x=u.upToken}function C(s=999,t=100,r="image/*",u=!1,o,c){const k=D(),p=b(()=>k.btns.canEdit);let h=p,d=b(()=>!p.value);return a.isUndefined(o)||(d=o,h=!o),{formType:"input",value:"",longPress:!0,class:`flex-col-reverse !px-0 !mx-0  !float-left !w-[${t}%]`,labelClass:"xCenter !w-[100%] !m-0 !text-xs",inlineForm:[{slot:"input",formType:"upload",maxCount:s,multiple:s>1,accept:r,required:u,deletable:h,disabled:d,previewFullImage:!1,async clickPreview(e){if(g(e)){const n=v();n.imgIndex=n.imgDoms.findIndex(l=>l==(f(e)||e.objectUrl)),n.showPreviewImg=!0}else{const n=f(e)||e.objectUrl;await q().saveData(),P.push({path:"/previewFile",query:{url:n}});return}},value:[],uploadIcon:"plus",class:"mx-auto mt-2",beforeDelete(e){if(!g(e))return!0;const n=v(),l=n.imgDoms.findIndex(F=>F==f(e));return n.imgDoms.splice(l,1),!0},beforeRead(e,...n){return e.status=E("uploading"),N(e,I()?.orderId||c).then(async l=>{e.src=l,e.url=l,e.status.value="done",await T()},l=>{e.status.value="faild"}),e},async afterRead(e,n,l){e.status=e.file.status},menuRight:[{label:"下载图片到相册",click:(...e)=>{const n=j();console.log(n)}}]}],backfill(e){this.inlineForm[0].value=e[this.name]?[{url:i(e[this.name]),status:"done"}]:[],m(i(e[this.name]))},onMounted(){this.inlineForm[0].value.length=0},getParam(e){console.log(e,3333);const n=a.get(this,"inlineForm.0.value.0.file.url")||a.get(this,"inlineForm.0.value.0.url","");e[this.name]=n}}}function G(s){a.isArray(s[this.name])?(this.inlineForm[0].value=s[this.name].map(t=>({url:i(t)})),m(...this.inlineForm[0].value.map(t=>t.url))):a.isString(s[this.name])&&(s[this.name].startsWith("[")?(this.inlineForm[0].value=JSON.parse(s[this.name]).map(t=>({url:i(t),...y()})),m(...this.inlineForm[0].value.map(t=>t.url))):w(s[this.name])&&(this.inlineForm[0].value=[{url:i(s[this.name])}],m(i(s[this.name]))))}function H(s){let t=[];return a.isArray(s)?t=s.map(r=>({url:i(r)})):a.isString(s)&&(s.startsWith("[")?t=JSON.parse(s).map(r=>({url:i(r),...y()})):w(s)&&(t=[{url:i(s)}])),m(...t.map(r=>r.url)),t}function y(s,t="object"){if(t=="object")return{}}export{G as a,H as b,C as m};
