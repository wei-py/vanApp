import{c as b,h as x,b as D,G as d,A as v,y as I,D as T,I as P,J as q,z as r,B as u,K as k}from"./index-NPFU1_kq.js";import{l}from"./lodash-C-AG1eJN.js";import{a as S}from"./axios-B6xwUs71.js";import{q as j}from"./queryUrl-ggRt1bhs.js";import{a as A}from"./vant-DL9g20lT.js";import{c as w}from"./@vue-BhOIXUCP.js";let F="";async function J(e,s=b()?.orderId,t="image"){if(l.isUndefined(s)){A("orderId 为空");return}const a="https://up-cn-east-2.qiniup.com";await N(s,t);const o=new FormData;o.append("file",e,e.name),o.append("token",F);const{data:m}=await S.post(a,o);return m.src||m.data.src}async function N(e,s){const t=j("file/get-qiniu-upload-token",{orderId:e,fileType:s}),{data:a}=await x.get(t);F=a.upToken}function C(e=999,s=100,t="",a=!1,o,m){const U=D(),p=w(()=>U.btns.canEdit);let h=p,g=w(()=>!p.value);return l.isUndefined(o)||(g=o,h=!o),{formType:"input",value:"",longPress:!0,class:`flex-col-reverse  float-start !w-[${s}%]`,labelClass:"xCenter !w-full !m-0",inlineForm:[{slot:"input",formType:"upload",maxCount:e,multiple:e>1,accept:t,required:a,deletable:h,disabled:g,previewFullImage:!1,clickPreview(i){if(d(i)){const n=v();n.imgIndex=n.imgDoms.findIndex(c=>c==(i.objectUrl||I(i))),n.showPreviewImg=!0}else{console.log("这不是一张图片",i);return}},value:[],uploadIcon:"plus",class:"mx-auto mt-2",beforeDelete(i){if(!d(i))return!0;const n=v(),c=n.imgDoms.findIndex(f=>f==I(i));return n.imgDoms.splice(c,1),!0},beforeRead(i){return new Promise(async(n,c)=>{const f=await J(i,b()?.orderId||m);i.src=f,i.url=f,await T(500),n(i),P()})},menuRight:[{label:"下载图片到相册",click:(...i)=>{const n=q();console.log(n)}}]}],backfill(i){this.inlineForm[0].value=i[this.name]?[{url:r(i[this.name])}]:[],u(r(i[this.name]))},onMounted(){this.inlineForm[0].value.length=0},getParam(i){const n=l.get(this,"inlineForm.0.value.0.file.url")||l.get(this,"inlineForm.0.value.0.url","");i[this.name]=n}}}function G(e){l.isArray(e[this.name])?(this.inlineForm[0].value=e[this.name].map(s=>({url:r(s)})),u(...this.inlineForm[0].value.map(s=>s.url))):l.isString(e[this.name])&&(e[this.name].startsWith("[")?(this.inlineForm[0].value=JSON.parse(e[this.name]).map(s=>({url:r(s),...y()})),u(...this.inlineForm[0].value.map(s=>s.url))):k(e[this.name])&&(this.inlineForm[0].value=[{url:r(e[this.name])}],u(r(e[this.name]))))}function K(e){let s=[];return l.isArray(e)?s=e.map(t=>({url:r(t)})):l.isString(e)&&(e.startsWith("[")?s=JSON.parse(e).map(t=>({url:r(t),...y()})):k(e)&&(s=[{url:r(e)}])),u(...s.map(t=>t.url)),s}function y(e,s="object"){if(s=="object")return{}}export{G as a,K as b,C as m};
