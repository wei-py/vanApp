import{F as i,c as I,h as k,b as D,L as v,D as m,u as j,r as q,G as g,N as P,O as T,H as c,P as w}from"./index-C9aRjUQ6.js";import{l as a}from"./lodash-DhpMPSDc.js";import{a as R}from"./axios-B4uVmeYG.js";import{q as S}from"./queryUrl-BTYYWpY7.js";import{c as b,r as N}from"./@vue-ts87NNlE.js";let x="";async function O(s,t=I()?.orderId,r="image"){if(a.isUndefined(t))return URL.createObjectURL(s);const u="https://up-cn-east-2.qiniup.com";await E(t,r);const o=new FormData;o.append("file",s),o.append("token",x);const{data:f}=await R.post(u,o);return i(f.src||f.data.src)}async function E(s,t){const r=S("file/get-qiniu-upload-token",{orderId:s,fileType:t}),{data:u}=await k.get(r);x=u.upToken}function G(s=999,t=100,r="image/*",u=!1,o,f){const F=D(),p=b(()=>F.btns.canEdit);let h=p,d=b(()=>!p.value);return a.isUndefined(o)||(d=o,h=!o),{formType:"input",value:"",longPress:!0,class:`flex-col-reverse !px-0 !mx-0  !float-left !w-[${t}%]`,labelClass:"xCenter !w-[100%] !m-0 !text-xs",inlineForm:[{slot:"input",formType:"upload",maxCount:s,multiple:s>1,accept:r,required:u,deletable:h,disabled:d,previewFullImage:!1,async clickPreview(e){if(v(e)){const n=g();n.imgIndex=n.imgDoms.findIndex(l=>(console.log(l,m(e),l==(m(e)||e.objectUrl)),l==(m(e)||e.objectUrl))),n.showPreviewImg=!0}else{const n=m(e)||e.objectUrl;await j().saveData(),q.push({path:"/previewFile",query:{url:n}});return}},value:[],uploadIcon:"plus",class:"mx-auto mt-2",beforeDelete(e){if(!v(e))return!0;const n=g(),l=n.imgDoms.findIndex(U=>U==m(e));return n.imgDoms.splice(l,1),!0},beforeRead(e,...n){return e.status=N("uploading"),O(e,I()?.orderId||f).then(async l=>{e.src=l,e.url=l,e.status.value="done",await P()},l=>{e.status.value="faild"}),e},async afterRead(e,n,l){e.status=e.file.status},menuRight:[{label:"下载图片到相册",click:(...e)=>{const n=T();console.log(n)}}]}],backfill(e){this.inlineForm[0].value=e[this.name]?[{url:i(e[this.name]),status:"done"}]:[],c(i(e[this.name]))},onMounted(){this.inlineForm[0].value.length=0},getParam(e){console.log(e,3333);const n=a.get(this,"inlineForm.0.value.0.file.url")||a.get(this,"inlineForm.0.value.0.url","");e[this.name]=n}}}function H(s){a.isArray(s[this.name])?(this.inlineForm[0].value=s[this.name].map(t=>({url:i(t)})),c(...this.inlineForm[0].value.map(t=>t.url))):a.isString(s[this.name])&&(s[this.name].startsWith("[")?(this.inlineForm[0].value=JSON.parse(s[this.name]).map(t=>({url:i(t),...y()})),c(...this.inlineForm[0].value.map(t=>t.url))):w(s[this.name])&&(this.inlineForm[0].value=[{url:i(s[this.name])}],c(i(s[this.name]))))}function M(s){let t=[];return a.isArray(s)?t=s.map(r=>({url:i(r)})):a.isString(s)&&(s.startsWith("[")?t=JSON.parse(s).map(r=>({url:i(r),...y()})):w(s)&&(t=[{url:i(s)}])),c(...t.map(r=>r.url)),t}function y(s,t="object"){if(t=="object")return{}}export{H as a,M as b,G as m};
