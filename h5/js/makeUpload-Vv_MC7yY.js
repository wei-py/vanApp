import{c as I,h as x,b as D,L as v,B as f,r as P,F as b,I as j,N as q,O as T,E as n,G as u,P as F}from"./index-BiU8ePZK.js";import{l}from"./lodash-C1iNKp1x.js";import{a as S}from"./axios-B6xwUs71.js";import{q as N}from"./queryUrl-CUkA5NKU.js";import{c as w}from"./@vue-BHA94vdH.js";let k="";async function O(e,s=I()?.orderId,i="image"){if(l.isUndefined(s))return URL.createObjectURL(e);const a="https://up-cn-east-2.qiniup.com";await R(s,i);const o=new FormData;o.append("file",e,e.name),o.append("token",k);const{data:m}=await S.post(a,o);return m.src||m.data.src}async function R(e,s){const i=N("file/get-qiniu-upload-token",{orderId:e,fileType:s}),{data:a}=await x.get(i);k=a.upToken}function B(e=999,s=100,i="",a=!1,o,m){const y=D(),h=w(()=>y.btns.canEdit);let g=h,d=w(()=>!h.value);return l.isUndefined(o)||(d=o,g=!o),{formType:"input",value:"",longPress:!0,class:`flex-col-reverse  float-start !w-[${s}%]`,labelClass:"xCenter !w-full !m-0",inlineForm:[{slot:"input",formType:"upload",maxCount:e,multiple:e>1,accept:i,required:a,deletable:g,disabled:d,previewFullImage:!1,clickPreview(t){if(v(t)){const r=b();r.imgIndex=r.imgDoms.findIndex(c=>c==(t.objectUrl||f(t))),r.showPreviewImg=!0}else{const r=t.objectUrl||f(t);P.push({path:"/previewFile",query:{url:r}});return}},value:[],uploadIcon:"plus",class:"mx-auto mt-2",beforeDelete(t){if(!v(t))return!0;const r=b(),c=r.imgDoms.findIndex(p=>p==f(t));return r.imgDoms.splice(c,1),!0},beforeRead(t){return new Promise(async(r,c)=>{const p=await O(t,I()?.orderId||m);t.src=p,t.url=p,await j(500),r(t),q()})},menuRight:[{label:"下载图片到相册",click:(...t)=>{const r=T();console.log(r)}}]}],backfill(t){this.inlineForm[0].value=t[this.name]?[{url:n(t[this.name])}]:[],u(n(t[this.name]))},onMounted(){this.inlineForm[0].value.length=0},getParam(t){const r=l.get(this,"inlineForm.0.value.0.file.url")||l.get(this,"inlineForm.0.value.0.url","");t[this.name]=r}}}function C(e){l.isArray(e[this.name])?(this.inlineForm[0].value=e[this.name].map(s=>({url:n(s)})),u(...this.inlineForm[0].value.map(s=>s.url))):l.isString(e[this.name])&&(e[this.name].startsWith("[")?(this.inlineForm[0].value=JSON.parse(e[this.name]).map(s=>({url:n(s),...U()})),u(...this.inlineForm[0].value.map(s=>s.url))):F(e[this.name])&&(this.inlineForm[0].value=[{url:n(e[this.name])}],u(n(e[this.name]))))}function G(e){let s=[];return l.isArray(e)?s=e.map(i=>({url:n(i)})):l.isString(e)&&(e.startsWith("[")?s=JSON.parse(e).map(i=>({url:n(i),...U()})):F(e)&&(s=[{url:n(e)}])),u(...s.map(i=>i.url)),s}function U(e,s="object"){if(s=="object")return{}}export{C as a,G as b,B as m};
