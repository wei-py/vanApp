import{t as Te,i as ke,a as te,u as Se,m as De,v as Pe,f as Ve,w as Fe,B as $e,r as Ne,x as Ee,R as Re,y as Be,h as Ze,z as je}from"./vant-Ckwj66YG.js";import{m as Ae,_ as ze}from"./makeForm-CsZjxp4a.js";import{X as ce,Q as ue,u as i,aX as f,aj as R,bA as r,al as w,am as n,be as v,N as d,bD as ae,V as S,F,b1 as B,G as Le,a_ as Me,aY as Ue,c as se,f as Oe,r as x,e as Ye,i as z}from"./@vue-ts87NNlE.js";import{a as T,l as k}from"./lodash-DhpMPSDc.js";import{p as qe}from"./plainButton-BYjUyjhC.js";import{_ as ve,b as L,n as Ge,g as D,s as m,r as oe,c as J,h as $,f as de,q as Je,t as Ke,e as Xe,w as Qe,i as We,x as He}from"./index-zLUezw_f.js";import{q as K}from"./queryUrl-BTYYWpY7.js";import{m as Z,b as me}from"./makeSelect-B5t5onyK.js";import{g as et}from"./getArea-DyGmKa6c.js";import{x as pe}from"./xe-utils-DXe260hc.js";import{d as ee}from"./dayjs-DWD9bsSZ.js";import{m as tt,b as at}from"./backfill-CdlEvImR.js";import{c as st}from"./@vueuse-QQdVrKV8.js";import"./@vant-NmgEisJw.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";import"./class-COLQ8iHP.js";const ot=e=>(Me("data-v-0628efb6"),e=e(),Ue(),e),lt={class:"flex h-10 bar items-center y-Center px-1"},nt={class:"min-w-4 px-1 h-4 ml-2 text-sm shadowC flex items-center justify-center text-white rounded-full bg-[#ffab30]"},it={class:"mx-2"},rt={class:"flex-1 justify-end pr-1 flex"},ct={class:"px-4 text-[14px] pb-[5px]"},ut={class:"font-bold min-h-8 text-[16px] yCenter justify-between"},dt={class:"text-[#ffab30]"},mt={class:"min-h-6 yCenter"},pt={class:"inline-flex justify-between"},vt=ot(()=>n("div",{class:"pr-2 leading-6"},"当前阶段: ",-1)),ft={class:"min-h-6 yCenter"},ht={class:"min-h-6 yCenter"},gt={class:"min-min-h-6 yCenter"},_t={class:"min-h-6 yCenter"},yt={class:"min-h-6 yCenter"},bt={__name:"card",props:["item"],setup(e){const t=e,a=L(),s=Ge();function _(p){const I=s[p.taskId]||s[p.stageId]||"-",C=s[p.stateId]||"-";return`${I} - ${C}`}return(p,I)=>{const C=Te,X=ke,P=ce("skeleton-item"),M=ce("skeleton");return ue((f(),R(X,{inset:"",class:"!mb-2 shadowC van-haptics-feedback !rounded-xl"},{default:r(()=>[ue((f(),w("div",null,[n("div",lt,[n("div",nt,v(t.item.index),1),n("div",it,v(t.item.orderBase.orderId),1),n("div",rt,[d(qe,{class:"!h-[18.7px]",onClick:I[0]||(I[0]=ae(u=>p.$copyText(t.item.orderBase.orderId),["stop"]))},{default:r(()=>[S("复制")]),_:1})])]),n("article",ct,[n("div",ut,[n("div",null,v(i(T.get)(t.item,"customer.name")||i(T.get)(t.item,"customerOrg.orgName")),1),n("div",dt,[S(" 详情 "),d(C,{name:"arrow"})])]),n("div",mt,"进件编号: "+v(i(T.get)(t.item,"leaseReview.contractNumber","-")),1),n("div",pt,[vt,n("div",null,[(f(!0),w(F,null,B(t.item.currentOrderState,u=>(f(),w("div",{key:u,class:Le([`text-${p.$statusColor(i(s)[u.stateId])}`,"min-h-6 yCenter"])},v(_(u)),3))),128))])]),n("div",ft,"所属组织: "+v(i(T.get)(t.item,"company.name","")),1),n("div",ht,"销售人员: "+v(i(T.get)(t.item,"orderBase.salesman","-")),1),n("div",gt,"详细地址: "+v(i(T.get)(t.item,"orderBase.installationAddress","-")),1),n("div",_t,"资方名称: "+v(p.$investorIdDic[i(T.get)(t.item,"orderBase.investorId","-")]),1),n("div",yt,"订单创建时间: "+v(i(T.get)(t.item,"orderBase.createTime","-")),1)])])),[[P]])]),_:1})),[[M,i(a).overlayShow]])}}},xt=ve(bt,[["__scopeId","data-v-0628efb6"]]),It=[{name:"stageId",value:"",columns:[{text:"项目阶段",value:""}],title:"项目阶段",async backfill(){if(J().from!="cysj"){this.disabled=!0;return}const{data:t}=await $.get("/order-state/stage"),a=t.map(s=>({...s,text:`${s.stageName} - (${s.count})`,value:s.stageId}));this.columns=[{text:"项目阶段",value:""},...a],m("stageId-more",s=>{s.makeSelect(this.value,this.columns)})},onMounted(){Oe(()=>{this.disabled=!1,this.value=""})}},{name:"companyId",value:"",columns:[{text:"所属组织",value:""}],title:"所属组织",async backfill(){const{data:e}=await $.get("/company/auth-list?pageNum=1&pageSize=9999"),t=e.records.map(a=>({text:a.name,value:a.companyId}));this.columns=[{text:"所属组织",value:""},...t],m("companyId-more",a=>{a.makeSelect(this.value,this.columns)})}},{name:"prjCompanyId",value:"",columns:[{text:"项目公司",value:""}],title:"项目公司",async backfill(){const e=de()?"ZZD_ORG":"ZZD",{data:t}=await $.get(K("/leaseLessor/getAuth",{pageNum:1,pageSize:9999,type:e})),a=t.map(s=>({value:s.code,text:`${s.code}, ${s.companyName}, ${s.areaId}`}));this.columns=[{text:"项目公司",value:""},...a],m("prjCompanyId-more",s=>{s.makeSelect(this.value,this.columns)})}},{name:"leaseProductCode",value:"",columns:[{text:"产品地区",value:""}],title:"产品地区",async backfill(){const e=de()?"ZZD_ORG":"ZZD",{data:t}=await $.get(K("/leasePrjProjectProduct/get",{isPage:!1,type:e})),a=t.map(s=>({value:s.code,text:`${s.code}, ${s.areaType}, ${s.area}`}));this.columns=[{text:"产品地区",value:""},...a],m("leaseProductCode-more",s=>{s.makeSelect(this.value,this.columns)})}}],wt=[{formType:"input",...Z("stageId-more",[],"dynamic"),name:"stageId-more",value:"",columns:[{text:"项目阶段",value:""}],label:"项目阶段",async backfill(){const e=D("stageId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],m(t,"value",e[t])}},{formType:"input",...Z("companyId-more",[],"dynamic"),name:"companyId-more",value:"",columns:[{text:"所属组织",value:""}],label:"所属组织",async backfill(){const e=D("companyId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],m(t,"value",e[t])}},{formType:"input",...Z("prjCompanyId-more",[],"dynamic"),name:"prjCompanyId-more",value:"",columns:[{text:"项目公司",value:""}],label:"项目公司",async backfill(){const e=D("prjCompanyId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],m(t,"value",e[t])}},{formType:"input",...Z("leaseProductCode-more",[],"dynamic"),name:"leaseProductCode-more",value:"",columns:[{text:"产品地区",value:""}],label:"产品地区",async backfill(){const e=D("leaseProductCode");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],m(t,"value",e[t])}},{customSlot:"checkbox",name:"checkbox",value:"正常",columns:[{text:"正常",value:"正常"},{text:"内审驳回",value:"内审驳回"},{text:"资方驳回",value:"资方驳回"},{text:"终止",value:"终止"}],label:"生命状态",getParam(e){const t={正常:{},内审驳回:{stageId:"",stateId:"REJECT",taskId:"",excludeStateIds:"APPROVAL_REJECT_LEASE"},资方驳回:{stageId:"",stateId:"APPROVAL_REJECT_LEASE"},终止:{stageId:"TERMINATE",stateId:"TERMINATE",taskId:null}};k.merge(e,t[this.value])}},{formType:"input",label:"省市区",name:"address",isLink:!0,readonly:!0,value:"",required:!0,placeholder:"请选择所在地区",middle:{value:[],provinceCode:"",cityCode:"",areaCode:""},click(){const e=L();this.inlineForm[0].show=e.btns.canEdit},getParam(e){const[t,a,s]=this.middle.value;e.address={provinceCode:t||"",cityCode:a||"",areaCode:s||""},delete e.provinceCode,delete e.cityCode,delete e.areaCode},async backfill(e){const t=D(this.name,"inlineForm.0.inlineForm.0");t.options=await et();const a=e.areaCode||e.cityCode;m(this.name,"inlineForm.0.inlineForm.0.value",a);const s=pe.searchTree(t.options,p=>p.value==a),_=pe.toTreeArray(s);t.finish({selectedOptions:_,value:a})},inlineForm:[{slot:"extra",formType:"popup",show:!1,round:!0,name:"addressPop",position:"bottom",inlineForm:[{slot:"default",formType:"cascader",title:"请选择所在地区",options:[],value:"",close(){m("address","inlineForm.0.show",!1)},finish(e){const t=e.selectedOptions.map(s=>s.text).join("/"),a=e.selectedOptions.map(s=>s.value);this.value=e.value,m("address",t),m("address","middle.value",a),m("address","inlineForm.0.show",!1)}}]}]},{formType:"input",name:"sellManName",value:"",label:"销售人员",placeholder:"请输入销售人员"},{formType:"",customSlot:"timeSortType",name:"timeSortType",value:"desc",columns:[{text:"按时间正序",value:"asc"},{text:"按时间倒序",value:"desc"}],label:"排序方式",getParam(e){e[this.name]=this.value}},{formType:"input",name:"preApprovalTimeScope",value:"",label:"预审时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,class:"!z-[2018]",show:!1,type:"range",confirm(e){const t=e.map(a=>ee(a).format("YYYY-MM-DD"));m("preApprovalTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]},{formType:"input",name:"contractSingedTimeScope",value:"",columns:[],label:"开工时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,show:!1,type:"range",confirm(e){const t=e.map(a=>ee(a).format("YYYY-MM-DD"));m("contractSingedTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]},{formType:"input",name:"constructionTimeScope",value:"",columns:[],label:"签约时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,show:!1,type:"range",confirm(e){const t=e.map(a=>ee(a).format("YYYY-MM-DD"));m("constructionTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]}],Ct=[tt("客户信息"),{...me(),...Z("investorId",[{text:"中山公用",value:"ZSGY"}]),label:"选择资方",name:"investorId"},{...me(),...Z("type",[{text:"自然人项目",value:"ZZD"},{text:"法人项目",value:"ZZD_ORG"}]),label:"选择屋顶类型",name:"type",onMounted(){this.hidden=se(()=>!D("investorId","realValue"))},cancel(){const e=L();e.active=2}},{formType:"input",inputAlign:"center",inlineForm:[{slot:"input",formType:"button",size:"mini",className:"px-10 center !bg-[#ffab30] text-white rounded-2xl",text:"确认",click(){const e=D("investorId","realValue"),t=D("type","realValue");if(!e)te("请选择资方");else if(!t)te("请选择屋顶类型");else{const a=L();a.headers.Biztype=t,oe.push({path:"/customerInfo",query:{investorId:e,type:t,title:"客户信息 - "+(t=="ZZD"?"自然人":"法人")}})}}}]}],Tt={class:"min-h-screen bg-gray-100"},kt={class:"yCenter"},St={class:"xCenter"},Dt={class:"xCenter"},Pt={class:"flex flex-nowrap"},Vt={class:"flex justify-center"},Ft={class:"xCenter pt-2 text-[14px]"},$t={__name:"realLease",setup(e){const t=L(),a=x(!1),s=x(!1),_=x([]),p=x(!1),I=x(""),C=x([{count:"0",title:"订单数量",value:"orderCount"},{count:"0",title:"签约量",value:"statisticsSinged"},{count:"0",title:"建设中",value:"statisticsBuilding"},{count:"0",title:"并网量",value:"statisticsGridConnection"}]),X=se(()=>C.value[I.value]),P=Ae({filtrate:It,moreForm:wt,newPopForm:Ct}),M=t.headers.Biztype,u=x({pageNum:1,pageSize:10,total:0}),j=x(""),y=J(),le=x({}),Q=st(()=>k.fromPairs(P.filtrate.map(h=>[h.name,h.value]))),W=y.from=="cysj",ne=se(()=>Qe("")?y.title=="客户信息"?"新增":"搜索":y.title=="预审"?"新增":"搜索"),U=x(!1);Ye(async()=>{at(P,{}),Je(),_.value.length=0,s.value=!1,await fe()});async function fe(){let h="";const l=k.pick(J(),["stageId","stateId","taskId"]);if(W){l.stateId="CURRENT";const{data:c}=await $.post("bi/app-order-page-head",l);C.value.forEach((g,V)=>{g.count=V==0?c[g.value]:Ke(c[g.value],2).result})}else{k.merge(l,Q.value,{orderType:M,queryTag:j.value});const c=y.title=="初设审核",g=y.title=="勘察审核";h=c?"order-state/stage-design-state":"order-state/stage-task-state",g&&(l.stateId="WAITING_APPROVAL");const{data:V}=await $.get(K(h,l));C.value=V.map(E=>({title:E.stateName,count:E.count,value:E.stateId}))}}const N=k.debounce(he,300);async function he(){const h=X.value.value.replace("orderCount",""),l=y.title=="终止"||y.title=="完成"||y.title=="订单列表",c={orderType:M,queryTag:j.value};let g="";l?(g="/order/search",y.title=="订单列表"&&(c.excludeSpecialStateIds=["LOCK","TERMINATE"])):(g="/order/search-exclude-states",c.excludeSpecialStateIds=["LOCK","TERMINATE"]);const V=k.pick(J(),["stageId","stateId","taskId"]);k.merge(c,V,le.value,Q.value,{stateId:h}),W&&(c.stateId="CURRENT"),y.from=="cysj"&&y.stageId&&(c.stateId=y.stageId);const H=K(g,u.value),{data:O}=await $.post(H,c),A=O.total;u.value.total=A;const Y=O.list.map((q,G)=>({...q,index:_.value.length+G+1}));_.value.push(...Y),a.value=!1,s.value=u.value.pageNum*u.value.pageSize>A,u.value.pageNum++}async function ie(){W||(u.value.pageNum=1,u.value.pageSize=10,_.value.length=0,s.value=!1,await N())}async function ge(){ne.value=="新增"?We()?U.value=!0:oe.push({path:"/inquiry",query:{investorId:"YUEXIU",type:t.active==0?"ZZD":"ZZD_ORG"}}):(u.value.pageNum=1,u.value.pageSize=10,_.value.length=0,s.value=!1,N())}async function _e(h){u.value.pageNum=1,u.value.pageSize=10,_.value.length=0,s.value=!1,await N()}function ye(){le.value=He(),u.value.pageNum=1,u.value.pageSize=10,_.value.length=0,s.value=!1,N(),p.value=!1}function be(){k.forIn(Q.value,(h,l)=>{m(l+"-more",c=>c.backfill())}),p.value=!0}function xe(){te("功能开发中")}function Ie(h){const l=h.orderBase.orderId,c=h.orderBase.investorId,g=h.orderBase.type;oe.push({path:"/itemDetail",query:{orderId:l,investorId:c,type:g}})}return Xe({getData:N,onRefresh:()=>location.reload()}),(h,l)=>{const c=$e,g=Se,V=Ne,E=De,H=Ee,O=Pe,A=Re,Y=Be,q=Ze,G=ze,re=Ve,we=Fe,Ce=je;return f(),w(F,null,[n("div",Tt,[d(g,{onBlur:ie,modelValue:i(j),"onUpdate:modelValue":l[0]||(l[0]=o=>z(j)?j.value=o:null),shape:"round",background:"#fff",placeholder:"系统编号、进件编号、组织全称、姓名、手机号","show-action":"",class:"van-hairline--bottom"},{action:r(()=>[n("div",kt,[d(c,{onClick:ge,class:"!w-auto !h-[30px] shadow !px-[15px] !rounded-full !border-none !bg-[#ffab30] !text-white"},{default:r(()=>[S(v(i(ne)),1)]),_:1})])]),_:1},8,["modelValue"]),d(E,{active:i(I),"onUpdate:active":l[1]||(l[1]=o=>z(I)?I.value=o:null),"line-width":"0",ellipsis:!1,"title-active-color":"#ffab30",onChange:ie,class:"van-hairline--bottom text-[14px]"},{default:r(()=>[(f(!0),w(F,null,B(i(C),o=>(f(),R(V,null,{title:r(()=>[n("div",St,v(o.count),1),n("div",Dt,v(o.title),1)]),_:2},1024))),256))]),_:1},8,["active"]),n("div",Pt,[d(O,{"active-color":"#ffab30",class:"w-[85vw]"},{default:r(()=>[(f(!0),w(F,null,B(i(P).filtrate,o=>(f(),R(H,{onChange:_e,key:o.title,modelValue:o.value,"onUpdate:modelValue":b=>o.value=b,disabled:o.disabled,options:o.columns,title:o.title},null,8,["modelValue","onUpdate:modelValue","disabled","options","title"]))),128))]),_:1}),n("div",{class:"center w-[15vw] bg-white text-[16px]",onClick:be},"筛选")]),d(re,{show:i(p),"onUpdate:show":l[3]||(l[3]=o=>z(p)?p.value=o:null),position:"right",class:"w-[90vw] h-[100vh]"},{default:r(()=>[d(G,{form:i(P).moreForm,class:"pt-3","group-class":"shadowC h-[92vh] moreForm"},{checkbox:r(({slot:o})=>[d(q,{label:o.label,"input-align":"right"},{input:r(()=>[d(Y,{modelValue:o.value,"onUpdate:modelValue":b=>o.value=b,class:"grid grid-cols-2 flex-end"},{default:r(()=>[(f(!0),w(F,null,B(o.columns,b=>(f(),R(A,{class:"ml-2 mt-2",name:b.value,"label-disabled":"","checked-color":"#ffab30","icon-size":"16px"},{default:r(()=>[S(v(b.text),1)]),_:2},1032,["name"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),timeSortType:r(({slot:o})=>[d(q,{label:o.label,"input-align":"right",valueClass:"yCenter"},{input:r(()=>[d(Y,{modelValue:o.value,"onUpdate:modelValue":b=>o.value=b,class:"grid grid-cols-2"},{default:r(()=>[(f(!0),w(F,null,B(o.columns,b=>(f(),R(A,{class:"ml-2",name:b.value,"label-disabled":"","checked-color":"#ffab30","icon-size":"16px"},{default:r(()=>[S(v(b.text),1)]),_:2},1032,["name"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:1},8,["form"]),n("div",Vt,[d(c,{onClick:l[2]||(l[2]=ae(o=>p.value=!1,["stop"])),round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:r(()=>[S("取消")]),_:1}),d(c,{onClick:ye,round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:r(()=>[S("确认")]),_:1}),d(c,{onClick:xe,round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:r(()=>[S("重置")]),_:1})])]),_:1},8,["show"]),n("div",Ft,"有效订单数量: "+v(i(u).total),1),d(we,{loading:i(a),"onUpdate:loading":l[4]||(l[4]=o=>z(a)?a.value=o:null),finished:i(s),"finished-text":"没有更多了",onLoad:i(N),class:"!pt-2 van-list"},{default:r(()=>[(f(!0),w(F,null,B(i(_),o=>(f(),R(xt,{key:o.orderBase.orderId,onClick:b=>Ie(o),item:o},null,8,["onClick","item"]))),128))]),_:1},8,["loading","finished","onLoad"]),d(Ce,{class:"!bg-[#fed38c]"})]),d(re,{show:i(U),"onUpdate:show":l[6]||(l[6]=o=>z(U)?U.value=o:null),round:"",teleport:"#app","transition-appear":""},{"overlay-content":r(()=>[d(G,{onClick:l[5]||(l[5]=ae(()=>{},["prevent"])),form:i(P).newPopForm,class:"pt-[20vh] mx-10","group-class":"shadowC"},null,8,["form"])]),_:1},8,["show"])],64)}}},na=ve($t,[["__scopeId","data-v-79535541"]]);export{na as default};
