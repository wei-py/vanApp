import{t as Ce,i as Te,a as te,u as ke,m as Se,v as De,f as Pe,w as Ve,B as $e,r as Fe,x as Ne,R as Be,y as Ze,h as je}from"./vant-PdAvEskO.js";import{m as Re,_ as Ee}from"./makeForm-LXfxxl4j.js";import{X as ce,Q as ue,u as i,aX as f,aj as Z,bA as r,al as w,am as n,be as v,N as d,bD as ae,V as S,F as $,b1 as j,G as Ae,a_ as Ue,aY as ze,c as se,f as Le,r as x,e as Me,i as U}from"./@vue-ts87NNlE.js";import{a as T,l as k}from"./lodash-D-SkTV7p.js";import{p as Ye}from"./plainButton-B7WOCgiF.js";import{_ as ve,b as z,m as qe,g as D,s as m,r as oe,c as J,h as F,d as de,n as Oe,q as Ge,e as Je,t as Xe,i as Qe,v as We}from"./index-D0ldpvYI.js";import{q as X}from"./queryUrl-DaTGvNW7.js";import{m as R,b as me}from"./makeSelect-C4yghakN.js";import{g as He}from"./getArea-BZFyy02y.js";import{x as pe}from"./xe-utils-CfMIR_ol.js";import{d as ee}from"./dayjs-C2mSY6L-.js";import{m as Ke,b as et}from"./backfill-YTqXYfvZ.js";import{c as tt}from"./@vueuse-DLUPp4BS.js";import"./@vant-NmgEisJw.js";import"./@vue-office-D7CPqAIZ.js";import"./vue-demi-BO4xsXkA.js";import"./vue-B7fnMq6U.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-jb8ML41u.js";import"./vxe-table-CAWzlaHI.js";import"./dom-zindex-GlLoxNk1.js";import"./class-COLQ8iHP.js";const at=e=>(Ue("data-v-0628efb6"),e=e(),ze(),e),st={class:"flex h-10 bar items-center y-Center px-1"},ot={class:"min-w-4 px-1 h-4 ml-2 text-sm shadowC flex items-center justify-center text-white rounded-full bg-[#ffab30]"},lt={class:"mx-2"},nt={class:"flex-1 justify-end pr-1 flex"},it={class:"px-4 text-[14px] pb-[5px]"},rt={class:"font-bold min-h-8 text-[16px] yCenter justify-between"},ct={class:"text-[#ffab30]"},ut={class:"min-h-6 yCenter"},dt={class:"inline-flex justify-between"},mt=at(()=>n("div",{class:"pr-2 leading-6"},"当前阶段: ",-1)),pt={class:"min-h-6 yCenter"},vt={class:"min-h-6 yCenter"},ft={class:"min-min-h-6 yCenter"},ht={class:"min-h-6 yCenter"},gt={class:"min-h-6 yCenter"},yt={__name:"card",props:["item"],setup(e){const t=e,a=z(),s=qe();function y(p){const I=s[p.taskId]||s[p.stageId]||"-",C=s[p.stateId]||"-";return`${I} - ${C}`}return(p,I)=>{const C=Ce,Q=Te,P=ce("skeleton-item"),L=ce("skeleton");return ue((f(),Z(Q,{inset:"",class:"!mb-2 shadowC van-haptics-feedback !rounded-xl"},{default:r(()=>[ue((f(),w("div",null,[n("div",st,[n("div",ot,v(t.item.index),1),n("div",lt,v(t.item.orderBase.orderId),1),n("div",nt,[d(Ye,{class:"!h-[18.7px]",onClick:I[0]||(I[0]=ae(c=>p.$copyText(t.item.orderBase.orderId),["stop"]))},{default:r(()=>[S("复制")]),_:1})])]),n("article",it,[n("div",rt,[n("div",null,v(i(T.get)(t.item,"customer.name")||i(T.get)(t.item,"customerOrg.orgName")),1),n("div",ct,[S(" 详情 "),d(C,{name:"arrow"})])]),n("div",ut,"进件编号: "+v(i(T.get)(t.item,"leaseReview.contractNumber","-")),1),n("div",dt,[mt,n("div",null,[(f(!0),w($,null,j(t.item.currentOrderState,c=>(f(),w("div",{key:c,class:Ae([`text-${p.$statusColor(i(s)[c.stateId])}`,"min-h-6 yCenter"])},v(y(c)),3))),128))])]),n("div",pt,"所属组织: "+v(i(T.get)(t.item,"company.name","")),1),n("div",vt,"销售人员: "+v(i(T.get)(t.item,"orderBase.salesman","-")),1),n("div",ft,"详细地址: "+v(i(T.get)(t.item,"orderBase.installationAddress","-")),1),n("div",ht,"资方名称: "+v(p.$investorIdDic[i(T.get)(t.item,"orderBase.investorId","-")]),1),n("div",gt,"订单创建时间: "+v(i(T.get)(t.item,"orderBase.createTime","-")),1)])])),[[P]])]),_:1})),[[L,i(a).overlayShow]])}}},_t=ve(yt,[["__scopeId","data-v-0628efb6"]]),bt=[{name:"stageId",value:"",columns:[{text:"项目阶段",value:""}],title:"项目阶段",async backfill(){if(J().from!="cysj"){this.disabled=!0;return}const{data:t}=await F.get("/order-state/stage"),a=t.map(s=>({...s,text:`${s.stageName} - (${s.count})`,value:s.stageId}));this.columns=[{text:"项目阶段",value:""},...a],m("stageId-more",s=>{s.makeSelect(this.value,this.columns)})},onMounted(){Le(()=>{this.disabled=!1,this.value=""})}},{name:"companyId",value:"",columns:[{text:"所属组织",value:""}],title:"所属组织",async backfill(){const{data:e}=await F.get("/company/auth-list?pageNum=1&pageSize=9999"),t=e.records.map(a=>({text:a.name,value:a.companyId}));this.columns=[{text:"所属组织",value:""},...t],m("companyId-more",a=>{a.makeSelect(this.value,this.columns)})}},{name:"prjCompanyId",value:"",columns:[{text:"项目公司",value:""}],title:"项目公司",async backfill(){const e=de()?"ZZD_ORG":"ZZD",{data:t}=await F.get(X("/leaseLessor/getAuth",{pageNum:1,pageSize:9999,type:e})),a=t.map(s=>({value:s.code,text:`${s.code}, ${s.companyName}, ${s.areaId}`}));this.columns=[{text:"项目公司",value:""},...a],m("prjCompanyId-more",s=>{s.makeSelect(this.value,this.columns)})}},{name:"leaseProductCode",value:"",columns:[{text:"产品地区",value:""}],title:"产品地区",async backfill(){const e=de()?"ZZD_ORG":"ZZD",{data:t}=await F.get(X("/leasePrjProjectProduct/get",{isPage:!1,type:e})),a=t.map(s=>({value:s.code,text:`${s.code}, ${s.areaType}, ${s.area}`}));this.columns=[{text:"产品地区",value:""},...a],m("leaseProductCode-more",s=>{s.makeSelect(this.value,this.columns)})}}],xt=[{formType:"input",...R("stageId-more",[],"dynamic"),name:"stageId-more",value:"",columns:[{text:"项目阶段",value:""}],label:"项目阶段",async backfill(){const e=D("stageId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],m(t,"value",e[t])}},{formType:"input",...R("companyId-more",[],"dynamic"),name:"companyId-more",value:"",columns:[{text:"所属组织",value:""}],label:"所属组织",async backfill(){const e=D("companyId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],m(t,"value",e[t])}},{formType:"input",...R("prjCompanyId-more",[],"dynamic"),name:"prjCompanyId-more",value:"",columns:[{text:"项目公司",value:""}],label:"项目公司",async backfill(){const e=D("prjCompanyId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],m(t,"value",e[t])}},{formType:"input",...R("leaseProductCode-more",[],"dynamic"),name:"leaseProductCode-more",value:"",columns:[{text:"产品地区",value:""}],label:"产品地区",async backfill(){const e=D("leaseProductCode");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],m(t,"value",e[t])}},{customSlot:"checkbox",name:"checkbox",value:"正常",columns:[{text:"正常",value:"正常"},{text:"内审驳回",value:"内审驳回"},{text:"资方驳回",value:"资方驳回"},{text:"终止",value:"终止"}],label:"生命状态",getParam(e){const t={正常:{},内审驳回:{stageId:"",stateId:"REJECT",taskId:"",excludeStateIds:"APPROVAL_REJECT_LEASE"},资方驳回:{stageId:"",stateId:"APPROVAL_REJECT_LEASE"},终止:{stageId:"TERMINATE",stateId:"TERMINATE",taskId:null}};k.merge(e,t[this.value])}},{formType:"input",label:"省市区",name:"address",isLink:!0,readonly:!0,value:"",required:!0,placeholder:"请选择所在地区",middle:{value:[],provinceCode:"",cityCode:"",areaCode:""},click(){const e=z();this.inlineForm[0].show=e.btns.canEdit},getParam(e){const[t,a,s]=this.middle.value;e.address={provinceCode:t||"",cityCode:a||"",areaCode:s||""},delete e.provinceCode,delete e.cityCode,delete e.areaCode},async backfill(e){const t=D(this.name,"inlineForm.0.inlineForm.0");t.options=await He();const a=e.areaCode||e.cityCode;m(this.name,"inlineForm.0.inlineForm.0.value",a);const s=pe.searchTree(t.options,p=>p.value==a),y=pe.toTreeArray(s);t.finish({selectedOptions:y,value:a})},inlineForm:[{slot:"extra",formType:"popup",show:!1,round:!0,name:"addressPop",position:"bottom",inlineForm:[{slot:"default",formType:"cascader",title:"请选择所在地区",options:[],value:"",close(){m("address","inlineForm.0.show",!1)},finish(e){const t=e.selectedOptions.map(s=>s.text).join("/"),a=e.selectedOptions.map(s=>s.value);this.value=e.value,m("address",t),m("address","middle.value",a),m("address","inlineForm.0.show",!1)}}]}]},{formType:"input",name:"sellManName",value:"",label:"销售人员",placeholder:"请输入销售人员"},{formType:"",customSlot:"timeSortType",name:"timeSortType",value:"desc",columns:[{text:"按时间正序",value:"asc"},{text:"按时间倒序",value:"desc"}],label:"排序方式",getParam(e){e[this.name]=this.value}},{formType:"input",name:"preApprovalTimeScope",value:"",label:"预审时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,class:"!z-[2018]",show:!1,type:"range",confirm(e){const t=e.map(a=>ee(a).format("YYYY-MM-DD"));m("preApprovalTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]},{formType:"input",name:"contractSingedTimeScope",value:"",columns:[],label:"开工时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,show:!1,type:"range",confirm(e){const t=e.map(a=>ee(a).format("YYYY-MM-DD"));m("contractSingedTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]},{formType:"input",name:"constructionTimeScope",value:"",columns:[],label:"签约时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,show:!1,type:"range",confirm(e){const t=e.map(a=>ee(a).format("YYYY-MM-DD"));m("constructionTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]}],It=[Ke("客户信息"),{...me(),...R("investorId",[{text:"中山公用",value:"ZSGY"}]),label:"选择资方",name:"investorId"},{...me(),...R("type",[{text:"自然人项目",value:"ZZD"},{text:"法人项目",value:"ZZD_ORG"}]),label:"选择屋顶类型",name:"type",onMounted(){this.hidden=se(()=>!D("investorId","realValue"))},cancel(){const e=z();e.active=2}},{formType:"input",inputAlign:"center",inlineForm:[{slot:"input",formType:"button",size:"mini",className:"px-10 center !bg-[#ffab30] text-white rounded-2xl",text:"确认",click(){const e=D("investorId","realValue"),t=D("type","realValue");if(!e)te("请选择资方");else if(!t)te("请选择屋顶类型");else{const a=z();a.headers.Biztype=t,oe.push({path:"/customerInfo",query:{investorId:e,type:t,title:"客户信息 - "+(t=="ZZD"?"自然人":"法人")}})}}}]}],wt={class:"min-h-screen bg-gray-100"},Ct={class:"yCenter"},Tt={class:"xCenter"},kt={class:"xCenter"},St={class:"flex flex-nowrap"},Dt={class:"flex justify-center"},Pt={class:"xCenter pt-2 text-[14px]"},Vt={__name:"realLease",setup(e){const t=z(),a=x(!1),s=x(!1),y=x([]),p=x(!1),I=x(""),C=x([{count:"0",title:"订单数量",value:"orderCount"},{count:"0",title:"签约量",value:"statisticsSinged"},{count:"0",title:"建设中",value:"statisticsBuilding"},{count:"0",title:"并网量",value:"statisticsGridConnection"}]),Q=se(()=>C.value[I.value]),P=Re({filtrate:bt,moreForm:xt,newPopForm:It}),L=t.headers.Biztype,c=x({pageNum:1,pageSize:5,total:0}),E=x(""),b=J(),le=x({}),W=tt(()=>k.fromPairs(P.filtrate.map(h=>[h.name,h.value]))),H=b.from=="cysj",ne=se(()=>Xe("")?b.title=="客户信息"?"新增":"搜索":b.title=="预审"?"新增":"搜索"),M=x(!1);Me(async()=>{et(P,{}),Oe(),y.value.length=0,s.value=!1,await fe()});async function fe(){let h="";const l=k.pick(J(),["stageId","stateId","taskId"]);if(H){l.stateId="CURRENT";const{data:u}=await F.post("bi/app-order-page-head",l);C.value.forEach((g,V)=>{g.count=V==0?u[g.value]:Ge(u[g.value],2).result})}else{k.merge(l,W.value,{orderType:L,queryTag:E.value});const u=b.title=="初设评审",g=b.title=="勘察审核";h=u?"order-state/stage-design-state":"order-state/stage-task-state",g&&(l.stateId="WAITING_APPROVAL");const{data:V}=await F.get(X(h,l));C.value=V.map(B=>({title:B.stateName,count:B.count,value:B.stateId}))}}const N=k.debounce(he,300);async function he(){const h=Q.value.value.replace("orderCount",""),l=b.title=="终止"||b.title=="完成"||b.title=="订单列表",u={orderType:L,queryTag:E.value};let g="";l?g="/order/search":g="/order/search-exclude-states";const V=k.pick(J(),["stageId","stateId","taskId"]);k.merge(u,V,le.value,W.value,{stateId:h}),H&&(u.stateId="CURRENT"),b.from=="cysj"&&b.stageId&&(u.stateId=b.stageId);const K=X(g,c.value),{data:Y}=await F.post(K,u),A=Y.total;c.value.total=A;const q=Y.list.map((O,G)=>({...O,index:y.value.length+G+1}));y.value.push(...q),a.value=!1,s.value=c.value.pageNum*c.value.pageSize>A,c.value.pageNum++}async function ie(){H||(c.value.pageNum=1,c.value.pageSize=5,y.value.length=0,s.value=!1,await N())}async function ge(){ne.value=="新增"?Qe()?M.value=!0:oe.push({path:"/inquiry",query:{investorId:"YUEXIU",type:t.active==0?"ZZD":"ZZD_ORG"}}):(c.value.pageNum=1,c.value.pageSize=5,y.value.length=0,s.value=!1,N())}async function ye(h){c.value.pageNum=1,c.value.pageSize=5,y.value.length=0,s.value=!1,await N()}function _e(){le.value=We(),c.value.pageNum=1,c.value.pageSize=5,y.value.length=0,s.value=!1,N(),p.value=!1}function be(){k.forIn(W.value,(h,l)=>{m(l+"-more",u=>u.backfill())}),p.value=!0}function xe(){te("功能开发中")}function Ie(h){const l=h.orderBase.orderId,u=h.orderBase.investorId,g=h.orderBase.type;oe.push({path:"/itemDetail",query:{orderId:l,investorId:u,type:g}})}return Je({getData:N}),(h,l)=>{const u=$e,g=ke,V=Fe,B=Se,K=Ne,Y=De,A=Be,q=Ze,O=je,G=Ee,re=Pe,we=Ve;return f(),w($,null,[n("div",wt,[d(g,{onBlur:ie,modelValue:i(E),"onUpdate:modelValue":l[0]||(l[0]=o=>U(E)?E.value=o:null),shape:"round",background:"#fff",placeholder:"系统编号、进件编号、组织全称、姓名、手机号","show-action":"",class:"van-hairline--bottom"},{action:r(()=>[n("div",Ct,[d(u,{onClick:ge,class:"!w-auto !h-[30px] shadow !px-[15px] !rounded-full !border-none !bg-[#ffab30] !text-white"},{default:r(()=>[S(v(i(ne)),1)]),_:1})])]),_:1},8,["modelValue"]),d(B,{active:i(I),"onUpdate:active":l[1]||(l[1]=o=>U(I)?I.value=o:null),"line-width":"0",ellipsis:!1,"title-active-color":"#ffab30",onChange:ie,class:"van-hairline--bottom text-[14px]"},{default:r(()=>[(f(!0),w($,null,j(i(C),o=>(f(),Z(V,null,{title:r(()=>[n("div",Tt,v(o.count),1),n("div",kt,v(o.title),1)]),_:2},1024))),256))]),_:1},8,["active"]),n("div",St,[d(Y,{"active-color":"#ffab30",class:"w-[85vw]"},{default:r(()=>[(f(!0),w($,null,j(i(P).filtrate,o=>(f(),Z(K,{onChange:ye,key:o.title,modelValue:o.value,"onUpdate:modelValue":_=>o.value=_,disabled:o.disabled,options:o.columns,title:o.title},null,8,["modelValue","onUpdate:modelValue","disabled","options","title"]))),128))]),_:1}),n("div",{class:"center w-[15vw] bg-white",onClick:be},"筛选")]),d(re,{show:i(p),"onUpdate:show":l[3]||(l[3]=o=>U(p)?p.value=o:null),position:"right",class:"w-[90vw] h-[100vh]"},{default:r(()=>[d(G,{form:i(P).moreForm,class:"pt-3","group-class":"shadowC h-[92vh]"},{checkbox:r(({slot:o})=>[d(O,{label:o.label,"input-align":"right"},{input:r(()=>[d(q,{modelValue:o.value,"onUpdate:modelValue":_=>o.value=_,class:"grid grid-cols-2 flex-end"},{default:r(()=>[(f(!0),w($,null,j(o.columns,_=>(f(),Z(A,{class:"ml-2 mt-2",name:_.value,"label-disabled":"","checked-color":"#ffab30"},{default:r(()=>[S(v(_.text),1)]),_:2},1032,["name"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),timeSortType:r(({slot:o})=>[d(O,{label:o.label,"input-align":"right",valueClass:"yCenter"},{input:r(()=>[d(q,{modelValue:o.value,"onUpdate:modelValue":_=>o.value=_,class:"grid grid-cols-2"},{default:r(()=>[(f(!0),w($,null,j(o.columns,_=>(f(),Z(A,{class:"ml-2",name:_.value,"label-disabled":"","checked-color":"#ffab30"},{default:r(()=>[S(v(_.text),1)]),_:2},1032,["name"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:1},8,["form"]),n("div",Dt,[d(u,{onClick:l[2]||(l[2]=ae(o=>p.value=!1,["stop"])),round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:r(()=>[S("取消")]),_:1}),d(u,{onClick:_e,round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:r(()=>[S("确认")]),_:1}),d(u,{onClick:xe,round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:r(()=>[S("重置")]),_:1})])]),_:1},8,["show"]),n("div",Pt,"有效订单数量: "+v(i(c).total),1),d(we,{loading:i(a),"onUpdate:loading":l[4]||(l[4]=o=>U(a)?a.value=o:null),finished:i(s),"finished-text":"没有更多了",onLoad:i(N),class:"!pt-2"},{default:r(()=>[(f(!0),w($,null,j(i(y),o=>(f(),Z(_t,{key:o.orderBase.orderId,onClick:_=>Ie(o),item:o},null,8,["onClick","item"]))),128))]),_:1},8,["loading","finished","onLoad"])]),d(re,{show:i(M),"onUpdate:show":l[6]||(l[6]=o=>U(M)?M.value=o:null),round:"",teleport:"#app","transition-appear":""},{"overlay-content":r(()=>[d(G,{onClick:l[5]||(l[5]=ae(()=>{},["prevent"])),form:i(P).newPopForm,class:"pt-[20vh] mx-10","group-class":"shadowC"},null,8,["form"])]),_:1},8,["show"])],64)}}},oa=ve(Vt,[["__scopeId","data-v-95646f9f"]]);export{oa as default};
