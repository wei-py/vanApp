import{D as Te,C as Ce,a as ae,p as ke,j as Se,q as De,e as Pe,r as Ve,B as $e,o as Fe,t as Ne,R as Be,u as je,g as Re}from"./vant-xiv0EFx3.js";import{m as Ae,_ as Ee}from"./makeForm-b9Rv_zTa.js";import{X as re,Q as ue,u as n,aX as f,aj as j,bA as i,al as T,am as r,be as v,N as c,bD as Q,V as h,F as $,b1 as R,G as Ze,c as se,f as ze,r as w,e as Le,i as z}from"./@vue-BHA94vdH.js";import{a as k,l as S}from"./lodash-C1iNKp1x.js";import{p as ce}from"./plainButton-DSPJKsXh.js";import{b as L,m as Me,g as D,s as d,r as le,c as J,h as F,d as me,_ as Ue,n as qe,q as Ye,e as Oe,t as Ge,i as Je,v as Qe}from"./index-BiU8ePZK.js";import{q as W}from"./queryUrl-CUkA5NKU.js";import{m as A,b as de}from"./makeSelect-VTItfMq-.js";import{g as We}from"./getArea-CHMruP3T.js";import{x as pe}from"./xe-utils-D22uZPtC.js";import{d as te}from"./dayjs-19KvoO9f.js";import{m as Xe,b as He}from"./backfill-Knvieq5z.js";import{c as Ke}from"./@vueuse-BYPNFz0v.js";import"./@vant-BMzV8Unt.js";import"./pinia-BOLtM30a.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-BQWAt7JZ.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-DYFNhZJM.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus--RpDJ8QK.js";import"./vue3-photo-preview-Byv7Qnko.js";import"./vxe-table-CbQjGgi9.js";import"./dom-zindex-GlLoxNk1.js";import"./class-rRG2y2aF.js";const et={class:"flex h-auto items-center pt-[1px]"},tt={class:"min-w-4 px-1 h-4 ml-2 text-sm shadowC flex items-center justify-center text-white rounded-full bg-[#ffab30]"},at={class:"mx-2"},st={class:"flex-1 justify-end pr-1 flex"},lt={class:"px-4 text-[14px] pb-[5px]"},ot={class:"font-bold"},nt=r("br",null,null,-1),it=r("br",null,null,-1),rt=r("br",null,null,-1),ut=r("br",null,null,-1),ct=r("br",null,null,-1),mt=r("br",null,null,-1),dt=r("br",null,null,-1),pt={__name:"card",props:["item"],setup(e){const t=e,a=L(),s=Me();function y(p){const I=s[p.taskId]||s[p.stageId]||"-",C=s[p.stateId]||"-";return`${I} - ${C}`}return(p,I)=>{const C=Te,X=Ce,P=re("skeleton-item"),M=re("skeleton");return ue((f(),j(X,{inset:"",class:"p-1 !mb-2 shadowC van-haptics-feedback !rounded-xl"},{default:i(()=>[ue((f(),T("div",null,[r("div",et,[r("div",tt,v(t.item.index),1),r("div",at,v(t.item.orderBase.orderId),1),c(ce,{class:"!h-[18.7px]",onClick:I[0]||(I[0]=Q(u=>p.$copyText(t.item.orderBase.orderId),["stop"]))},{default:i(()=>[h("复制")]),_:1}),r("div",st,[c(ce,{onClick:Q(()=>{},["stop"]),class:"!h-[18.7px]"},{default:i(()=>[h("状态")]),_:1})])]),c(C,{class:"!my-1"}),r("article",lt,[r("div",ot,v(n(k.get)(t.item,"customer.name")||n(k.get)(t.item,"customerOrg.orgName")),1),h(" 进件编号: "+v(n(k.get)(t.item,"leaseReview.contractNumber","-")),1),nt,h(" 当前阶段: "),it,(f(!0),T($,null,R(t.item.currentOrderState,u=>(f(),T("div",{key:u,class:Ze(`text-${p.$statusColor(n(s)[u.stateId])}`)},v(y(u)),3))),128)),h(" 所属组织: "+v(n(k.get)(t.item,"company.name",""))+" ",1),rt,h(" 销售人员: "+v(n(k.get)(t.item,"orderBase.salesman","-"))+" ",1),ut,h(" 详细地址: "+v(n(k.get)(t.item,"orderBase.installationAddress","-"))+" ",1),ct,h(" 资方名称: "+v(p.$investorIdDic[n(k.get)(t.item,"orderBase.investorId","-")])+" ",1),mt,h(" 订单创建时间: "+v(n(k.get)(t.item,"orderBase.createTime","-"))+" ",1),dt])])),[[P]])]),_:1})),[[M,n(a).overlayShow]])}}},vt=[{name:"stageId",value:"",columns:[{text:"项目阶段",value:""}],title:"项目阶段",async backfill(){if(J().from!="cysj"){this.disabled=!0;return}const{data:t}=await F.get("/order-state/stage"),a=t.map(s=>({...s,text:`${s.stageName} - (${s.count})`,value:s.stageId}));this.columns=[{text:"项目阶段",value:""},...a],d("stageId-more",s=>{s.makeSelect(this.value,this.columns)})},onMounted(){ze(()=>{this.disabled=!1,this.value=""})}},{name:"companyId",value:"",columns:[{text:"所属组织",value:""}],title:"所属组织",async backfill(){const{data:e}=await F.get("/company/auth-list?pageNum=1&pageSize=9999"),t=e.records.map(a=>({text:a.name,value:a.companyId}));this.columns=[{text:"所属组织",value:""},...t],d("companyId-more",a=>{a.makeSelect(this.value,this.columns)})}},{name:"prjCompanyId",value:"",columns:[{text:"项目公司",value:""}],title:"项目公司",async backfill(){const e=me()?"ZZD_ORG":"ZZD",{data:t}=await F.get(W("/leaseLessor/getAuth",{pageNum:1,pageSize:9999,type:e})),a=t.map(s=>({value:s.code,text:`${s.code}, ${s.companyName}, ${s.areaId}`}));this.columns=[{text:"项目公司",value:""},...a],d("prjCompanyId-more",s=>{s.makeSelect(this.value,this.columns)})}},{name:"leaseProductCode",value:"",columns:[{text:"产品地区",value:""}],title:"产品地区",async backfill(){const e=me()?"ZZD_ORG":"ZZD",{data:t}=await F.get(W("/leasePrjProjectProduct/get",{isPage:!1,type:e})),a=t.map(s=>({value:s.code,text:`${s.code}, ${s.areaType}, ${s.area}`}));this.columns=[{text:"产品地区",value:""},...a],d("leaseProductCode-more",s=>{s.makeSelect(this.value,this.columns)})}}],ft=[{formType:"input",...A("stageId-more",[],"dynamic"),name:"stageId-more",value:"",columns:[{text:"项目阶段",value:""}],label:"项目阶段",async backfill(){const e=D("stageId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],d(t,"value",e[t])}},{formType:"input",...A("companyId-more",[],"dynamic"),name:"companyId-more",value:"",columns:[{text:"所属组织",value:""}],label:"所属组织",async backfill(){const e=D("companyId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],d(t,"value",e[t])}},{formType:"input",...A("prjCompanyId-more",[],"dynamic"),name:"prjCompanyId-more",value:"",columns:[{text:"项目公司",value:""}],label:"项目公司",async backfill(){const e=D("prjCompanyId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],d(t,"value",e[t])}},{formType:"input",...A("leaseProductCode-more",[],"dynamic"),name:"leaseProductCode-more",value:"",columns:[{text:"产品地区",value:""}],label:"产品地区",async backfill(){const e=D("leaseProductCode");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],d(t,"value",e[t])}},{customSlot:"checkbox",name:"checkbox",value:"正常",columns:[{text:"正常",value:"正常"},{text:"内审驳回",value:"内审驳回"},{text:"资方驳回",value:"资方驳回"},{text:"终止",value:"终止"}],label:"生命状态",getParam(e){const t={正常:{},内审驳回:{stageId:"",stateId:"REJECT",taskId:"",excludeStateIds:"APPROVAL_REJECT_LEASE"},资方驳回:{stageId:"",stateId:"APPROVAL_REJECT_LEASE"},终止:{stageId:"TERMINATE",stateId:"TERMINATE",taskId:null}};S.merge(e,t[this.value])}},{formType:"input",label:"省市区",name:"address",isLink:!0,readonly:!0,value:"",required:!0,placeholder:"请选择所在地区",middle:{value:[],provinceCode:"",cityCode:"",areaCode:""},click(){const e=L();this.inlineForm[0].show=e.btns.canEdit},getParam(e){const[t,a,s]=this.middle.value;e.address={provinceCode:t||"",cityCode:a||"",areaCode:s||""},delete e.provinceCode,delete e.cityCode,delete e.areaCode},async backfill(e){const t=D(this.name,"inlineForm.0.inlineForm.0");t.options=await We();const a=e.areaCode||e.cityCode;d(this.name,"inlineForm.0.inlineForm.0.value",a);const s=pe.searchTree(t.options,p=>p.value==a),y=pe.toTreeArray(s);t.finish({selectedOptions:y,value:a})},inlineForm:[{slot:"extra",formType:"popup",show:!1,round:!0,name:"addressPop",position:"bottom",inlineForm:[{slot:"default",formType:"cascader",title:"请选择所在地区",options:[],value:"",close(){d("address","inlineForm.0.show",!1)},finish(e){const t=e.selectedOptions.map(s=>s.text).join("/"),a=e.selectedOptions.map(s=>s.value);this.value=e.value,d("address",t),d("address","middle.value",a),d("address","inlineForm.0.show",!1)}}]}]},{formType:"input",name:"sellManName",value:"",label:"销售人员",placeholder:"请输入销售人员"},{formType:"",customSlot:"timeSortType",name:"timeSortType",value:"desc",columns:[{text:"按时间正序",value:"asc"},{text:"按时间倒序",value:"desc"}],label:"排序方式",getParam(e){e[this.name]=this.value}},{formType:"input",name:"preApprovalTimeScope",value:"",label:"预审时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,class:"!z-[2018]",show:!1,type:"range",confirm(e){const t=e.map(a=>te(a).format("YYYY-MM-DD"));d("preApprovalTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]},{formType:"input",name:"contractSingedTimeScope",value:"",columns:[],label:"开工时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,show:!1,type:"range",confirm(e){const t=e.map(a=>te(a).format("YYYY-MM-DD"));d("contractSingedTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]},{formType:"input",name:"constructionTimeScope",value:"",columns:[],label:"签约时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,show:!1,type:"range",confirm(e){const t=e.map(a=>te(a).format("YYYY-MM-DD"));d("constructionTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]}],ht=[Xe("客户信息"),{...de(),...A("investorId",[{text:"中山公用",value:"ZSGY"}]),label:"选择资方",name:"investorId"},{...de(),...A("type",[{text:"自然人项目",value:"ZZD"},{text:"法人项目",value:"ZZD_ORG"}]),label:"选择屋顶类型",name:"type",onMounted(){this.hidden=se(()=>!D("investorId","realValue"))},cancel(){const e=L();e.active=2}},{formType:"input",inputAlign:"center",inlineForm:[{slot:"input",formType:"button",size:"mini",className:"px-10 center !bg-[#ffab30] text-white rounded-2xl",text:"确认",click(){const e=D("investorId","realValue"),t=D("type","realValue");if(!e)ae("请选择资方");else if(!t)ae("请选择屋顶类型");else{const a=L();a.headers.Biztype=t,le.push({path:"/customerInfo",query:{investorId:e,type:t,title:"客户信息 - "+(t=="ZZD"?"自然人":"法人")}})}}}]}],gt={class:"min-h-screen bg-gray-100"},_t={class:"yCenter"},yt={class:"xCenter"},bt={class:"xCenter"},xt={class:"flex flex-nowrap"},wt={class:"flex justify-center"},It={class:"xCenter pt-2 text-[14px]"},Tt={__name:"realLease",setup(e){const t=L(),a=w(!1),s=w(!1),y=w([]),p=w(!1),I=w(""),C=w([{count:"0",title:"订单数量",value:"orderCount"},{count:"0",title:"签约量",value:"statisticsSinged"},{count:"0",title:"建设中",value:"statisticsBuilding"},{count:"0",title:"并网量",value:"statisticsGridConnection"}]),X=se(()=>C.value[I.value]),P=Ae({filtrate:vt,moreForm:ft,newPopForm:ht}),M=t.headers.Biztype,u=w({pageNum:1,pageSize:10,total:0}),E=w(""),x=J(),oe=w({}),H=Ke(()=>S.fromPairs(P.filtrate.map(g=>[g.name,g.value]))),K=x.from=="cysj",ne=se(()=>Ge("")?x.title=="客户信息"?"新增":"搜索":x.title=="预审"?"新增":"搜索"),U=w(!1);Le(async()=>{He(P,{}),qe(),y.value.length=0,s.value=!1,await ve()});async function ve(){let g="";const o=S.pick(J(),["stageId","stateId","taskId"]);if(K){o.stateId="CURRENT";const{data:m}=await F.post("bi/app-order-page-head",o);C.value.forEach((_,V)=>{_.count=V==0?m[_.value]:Ye(m[_.value],2).result})}else{S.merge(o,H.value,{orderType:M,queryTag:E.value});const m=x.title=="初设评审",_=x.title=="勘察审核";g=m?"order-state/stage-design-state":"order-state/stage-task-state",_&&(o.stateId="WAITING_APPROVAL");const{data:V}=await F.get(W(g,o));C.value=V.map(B=>({title:B.stateName,count:B.count,value:B.stateId}))}}const N=S.debounce(fe,300);async function fe(){const g=X.value.value.replace("orderCount",""),o=x.title=="终止"||x.title=="完成"||x.title=="订单列表",m={orderType:M,queryTag:E.value};let _="";o?_="/order/search":_="/order/search-exclude-states";const V=S.pick(J(),["stageId","stateId","taskId"]);S.merge(m,V,oe.value,H.value,{stateId:g}),K&&(m.stateId="CURRENT"),x.from=="cysj"&&x.stageId&&(m.stateId=x.stageId);const ee=W(_,u.value),{data:q}=await F.post(ee,m),Z=q.total;u.value.total=Z;const Y=q.list.map((O,G)=>({...O,index:y.value.length+G+1}));y.value.push(...Y),a.value=!1,s.value=u.value.pageNum*u.value.pageSize>Z,u.value.pageNum++}async function he(){K||(u.value.pageNum=1,u.value.pageSize=10,y.value.length=0,s.value=!1,await N())}async function ge(){ne.value=="新增"?Je()?U.value=!0:le.push("/inquiry"):(u.value.pageNum=1,u.value.pageSize=10,y.value.length=0,s.value=!1,N())}async function _e(g){u.value.pageNum=1,u.value.pageSize=10,y.value.length=0,s.value=!1,await N()}function ye(){oe.value=Qe(),u.value.pageNum=1,u.value.pageSize=10,y.value.length=0,s.value=!1,N(),p.value=!1}function be(){S.forIn(H.value,(g,o)=>{d(o+"-more",m=>m.backfill())}),p.value=!0}function xe(){ae("功能开发中")}function we(g){const o=g.orderBase.orderId,m=g.orderBase.investorId,_=g.orderBase.type;le.push({path:"/itemDetail",query:{orderId:o,investorId:m,type:_}})}return Oe({getData:N}),(g,o)=>{const m=$e,_=ke,V=Fe,B=Se,ee=Ne,q=De,Z=Be,Y=je,O=Re,G=Ee,ie=Pe,Ie=Ve;return f(),T($,null,[r("div",gt,[c(_,{modelValue:n(E),"onUpdate:modelValue":o[0]||(o[0]=l=>z(E)?E.value=l:null),shape:"round",background:"#f3f3f3",placeholder:"系统编号、进件编号、组织全称、姓名、手机号","show-action":""},{action:i(()=>[r("div",_t,[c(m,{onClick:ge,class:"!w-auto !h-[34px] shadow !px-[15px] !rounded-full !border-none !bg-[#ffab30] !text-white"},{default:i(()=>[h(v(n(ne)),1)]),_:1})])]),_:1},8,["modelValue"]),c(B,{active:n(I),"onUpdate:active":o[1]||(o[1]=l=>z(I)?I.value=l:null),"line-width":"0",ellipsis:!1,"title-active-color":"#ffab30",onChange:he},{default:i(()=>[(f(!0),T($,null,R(n(C),l=>(f(),j(V,null,{title:i(()=>[r("div",yt,v(l.count),1),r("div",bt,v(l.title),1)]),_:2},1024))),256))]),_:1},8,["active"]),r("div",xt,[c(q,{"active-color":"#ffab30",class:"w-[85vw]"},{default:i(()=>[(f(!0),T($,null,R(n(P).filtrate,l=>(f(),j(ee,{onChange:_e,key:l.title,modelValue:l.value,"onUpdate:modelValue":b=>l.value=b,disabled:l.disabled,options:l.columns,title:l.title},null,8,["modelValue","onUpdate:modelValue","disabled","options","title"]))),128))]),_:1}),r("div",{class:"center w-[15vw] bg-white",onClick:be},"筛选")]),c(ie,{show:n(p),"onUpdate:show":o[3]||(o[3]=l=>z(p)?p.value=l:null),position:"right",class:"w-[90vw] h-[100vh]"},{default:i(()=>[c(G,{form:n(P).moreForm,class:"pt-3","group-class":"shadowC h-[92vh]"},{checkbox:i(({slot:l})=>[c(O,{label:l.label,"input-align":"right"},{input:i(()=>[c(Y,{modelValue:l.value,"onUpdate:modelValue":b=>l.value=b,class:"grid grid-cols-2 flex-end"},{default:i(()=>[(f(!0),T($,null,R(l.columns,b=>(f(),j(Z,{class:"ml-2 mt-2",name:b.value,"label-disabled":""},{default:i(()=>[h(v(b.text),1)]),_:2},1032,["name"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),timeSortType:i(({slot:l})=>[c(O,{label:l.label,"input-align":"right"},{input:i(()=>[c(Y,{modelValue:l.value,"onUpdate:modelValue":b=>l.value=b,class:"grid grid-cols-2 flex-end"},{default:i(()=>[(f(!0),T($,null,R(l.columns,b=>(f(),j(Z,{class:"ml-2 mt-2",name:b.value,"label-disabled":""},{default:i(()=>[h(v(b.text),1)]),_:2},1032,["name"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:1},8,["form"]),r("div",wt,[c(m,{onClick:o[2]||(o[2]=Q(l=>p.value=!1,["stop"])),round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:i(()=>[h("取消")]),_:1}),c(m,{onClick:ye,round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:i(()=>[h("确认")]),_:1}),c(m,{onClick:xe,round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:i(()=>[h("重置")]),_:1})])]),_:1},8,["show"]),r("div",It,"有效订单数量: "+v(n(u).total),1),c(Ie,{loading:n(a),"onUpdate:loading":o[4]||(o[4]=l=>z(a)?a.value=l:null),finished:n(s),"finished-text":"没有更多了",onLoad:n(N),class:"!pt-2"},{default:i(()=>[(f(!0),T($,null,R(n(y),l=>(f(),j(pt,{key:l.orderBase.orderId,onClick:b=>we(l),item:l},null,8,["onClick","item"]))),128))]),_:1},8,["loading","finished","onLoad"])]),c(ie,{show:n(U),"onUpdate:show":o[6]||(o[6]=l=>z(U)?U.value=l:null),round:"",teleport:"#app","transition-appear":""},{"overlay-content":i(()=>[c(G,{onClick:o[5]||(o[5]=Q(()=>{},["prevent"])),form:n(P).newPopForm,class:"pt-[20vh] mx-10","group-class":"shadowC"},null,8,["form"])]),_:1},8,["show"])],64)}}},Wt=Ue(Tt,[["__scopeId","data-v-efb91d44"]]);export{Wt as default};
