import{D as Te,C as Ce,a as ae,p as ke,j as Se,q as De,e as Pe,r as Ve,B as Fe,o as $e,t as Ne,R as Be,u as Re,g as je}from"./vant-DL9g20lT.js";import{m as Ee,_ as Ze}from"./makeForm-C_uyyvx9.js";import{X as re,Q as ue,u as i,Z as v,a2 as R,a8 as n,_ as T,a0 as c,a3 as h,N as u,a1 as J,V as _,F as V,a4 as j,G as Ae,c as se,f as ze,r as w,e as Le,i as z}from"./@vue-BhOIXUCP.js";import{a as B,l as k}from"./lodash-C-AG1eJN.js";import{p as ce}from"./plainButton-Bx2E2oUm.js";import{b as W,k as Me,g as S,s as d,r as oe,c as G,h as F,_ as Ue,l as qe,m as Ye,e as Oe,n as Ge}from"./index-NPFU1_kq.js";import{a as me,b as Je,i as Qe}from"./Biztype-DPM88l-Q.js";import{q as Q}from"./queryUrl-ggRt1bhs.js";import{m as E,b as de}from"./makeSelect-BzGYyrzS.js";import{g as We}from"./getArea-CLkmfVQ_.js";import{x as pe}from"./xe-utils-BM3aD2L3.js";import{d as te}from"./dayjs-Bof1u0Bp.js";import{m as He,b as Ke}from"./backfill-hh-glB-L.js";import{c as Xe}from"./@vueuse-BaMGbt4d.js";import"./@vant-D2Uub16A.js";import"./pinia-CQ-jtR3-.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-XNYRUkAR.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-bC99Tnvx.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-VHbn-zkx.js";import"./vue3-photo-preview-Dedu722r.js";import"./vxe-table-BBegQXiE.js";import"./dom-zindex-GlLoxNk1.js";import"./class-rRG2y2aF.js";const et={class:"flex h-auto items-center pt-[1px]"},tt={class:"min-w-4 px-1 h-4 ml-2 text-sm shadowC flex items-center justify-center text-white rounded-full bg-[#ffab30]"},at={class:"mx-2"},st={class:"flex-1 justify-end pr-1 flex"},ot={class:"px-4 text-[14px] pb-[5px]"},lt={class:"font-bold"},nt=c("br",null,null,-1),it=c("br",null,null,-1),rt=c("br",null,null,-1),ut=c("br",null,null,-1),ct=c("br",null,null,-1),mt={__name:"card",props:["item"],setup(e){const t=e,a=W(),s=Me();function y(p){const I=s[p.taskId]||s[p.stageId]||"-",C=s[p.stateId]||"-";return`${I} - ${C}`}return(p,I)=>{const C=Te,H=Ce,D=re("skeleton-item"),L=re("skeleton");return ue((v(),R(H,{inset:"",class:"p-1 !mb-2 shadowC van-haptics-feedback !rounded-xl"},{default:n(()=>[ue((v(),T("div",null,[c("div",et,[c("div",tt,h(t.item.index),1),c("div",at,h(t.item.orderBase.orderId),1),u(ce,{class:"!h-[18.7px]",onClick:I[0]||(I[0]=J(r=>p.$copyText(t.item.orderBase.orderId),["stop"]))},{default:n(()=>[_("复制")]),_:1}),c("div",st,[u(ce,{onClick:J(()=>{},["stop"]),class:"!h-[18.7px]"},{default:n(()=>[_("状态")]),_:1})])]),u(C,{class:"!my-1"}),c("article",ot,[c("div",lt,h(i(B.get)(t.item,"customer.name")||i(B.get)(t.item,"customerOrg.orgName")),1),_(" 进件编号: "+h(i(B.get)(t.item,"leaseReview.contractNumber","-")),1),nt,_(" 当前阶段: "),it,(v(!0),T(V,null,j(t.item.currentOrderState,r=>(v(),T("div",{key:r,class:Ae(`text-${p.$statusColor(i(s)[r.stateId])}`)},h(y(r)),3))),128)),_(" 销售人员: "+h(i(B.get)(t.item,"orderBase.salesman","-"))+" ",1),rt,_(" 详细地址: "+h(i(B.get)(t.item,"orderBase.installationAddress","-"))+" ",1),ut,_(" 订单创建时间: "+h(i(B.get)(t.item,"orderBase.createTime","-"))+" ",1),ct])])),[[D]])]),_:1})),[[L,i(a).overlayShow]])}}},dt=[{name:"stageId",value:"",columns:[{text:"项目阶段",value:""}],title:"项目阶段",async backfill(){if(G().from!="cysj"){this.disabled=!0;return}const{data:t}=await F.get("/order-state/stage"),a=t.map(s=>({...s,text:`${s.stageName} - (${s.count})`,value:s.stageId}));this.columns=[{text:"项目阶段",value:""},...a],d("stageId-more",s=>{s.makeSelect(this.value,this.columns)})},onMounted(){ze(()=>{this.disabled=!1,this.value=""})}},{name:"companyId",value:"",columns:[{text:"所属组织",value:""}],title:"所属组织",async backfill(){const{data:e}=await F.get("/company/auth-list?pageNum=1&pageSize=9999"),t=e.records.map(a=>({text:a.name,value:a.companyId}));this.columns=[{text:"所属组织",value:""},...t],d("companyId-more",a=>{a.makeSelect(this.value,this.columns)})}},{name:"prjCompanyId",value:"",columns:[{text:"项目公司",value:""}],title:"项目公司",async backfill(){const e=me()?"ZZD_ORG":"ZZD",{data:t}=await F.get(Q("/leaseLessor/getAuth",{pageNum:1,pageSize:9999,type:e})),a=t.map(s=>({value:s.code,text:`${s.code}, ${s.companyName}, ${s.areaId}`}));this.columns=[{text:"项目公司",value:""},...a],d("prjCompanyId-more",s=>{s.makeSelect(this.value,this.columns)})}},{name:"leaseProductCode",value:"",columns:[{text:"产品地区",value:""}],title:"产品地区",async backfill(){const e=me()?"ZZD_ORG":"ZZD",{data:t}=await F.get(Q("/leasePrjProjectProduct/get",{isPage:!1,type:e})),a=t.map(s=>({value:s.code,text:`${s.code}, ${s.areaType}, ${s.area}`}));this.columns=[{text:"产品地区",value:""},...a],d("leaseProductCode-more",s=>{s.makeSelect(this.value,this.columns)})}}],pt=[{formType:"input",...E("stageId-more",[],"dynamic"),name:"stageId-more",value:"",columns:[{text:"项目阶段",value:""}],label:"项目阶段",async backfill(){const e=S("stageId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],d(t,"value",e[t])}},{formType:"input",...E("companyId-more",[],"dynamic"),name:"companyId-more",value:"",columns:[{text:"所属组织",value:""}],label:"所属组织",async backfill(){const e=S("companyId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],d(t,"value",e[t])}},{formType:"input",...E("prjCompanyId-more",[],"dynamic"),name:"prjCompanyId-more",value:"",columns:[{text:"项目公司",value:""}],label:"项目公司",async backfill(){const e=S("prjCompanyId");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],d(t,"value",e[t])}},{formType:"input",...E("leaseProductCode-more",[],"dynamic"),name:"leaseProductCode-more",value:"",columns:[{text:"产品地区",value:""}],label:"产品地区",async backfill(){const e=S("leaseProductCode");this.makeSelect(e.value,e.columns)},getParam(e){const t=this.name.replace("-more","");e[t]=this.realValue,delete e[this.name],d(t,"value",e[t])}},{customSlot:"checkbox",name:"checkbox",value:"正常",columns:[{text:"正常",value:"正常"},{text:"内审驳回",value:"内审驳回"},{text:"资方驳回",value:"资方驳回"},{text:"终止",value:"终止"}],label:"生命状态",getParam(e){const t={正常:{},内审驳回:{stageId:"",stateId:"REJECT",taskId:"",excludeStateIds:"APPROVAL_REJECT_LEASE"},资方驳回:{stageId:"",stateId:"APPROVAL_REJECT_LEASE"},终止:{stageId:"TERMINATE",stateId:"TERMINATE",taskId:null}};k.merge(e,t[this.value])}},{formType:"input",label:"省市区",name:"address",isLink:!0,readonly:!0,value:"",required:!0,placeholder:"请选择所在地区",middle:{value:[],provinceCode:"",cityCode:"",areaCode:""},click(){const e=W();this.inlineForm[0].show=e.btns.canEdit},getParam(e){const[t,a,s]=this.middle.value;e.address={provinceCode:t||"",cityCode:a||"",areaCode:s||""},delete e.provinceCode,delete e.cityCode,delete e.areaCode},async backfill(e){const t=S(this.name,"inlineForm.0.inlineForm.0");t.options=await We();const a=e.areaCode||e.cityCode;d(this.name,"inlineForm.0.inlineForm.0.value",a);const s=pe.searchTree(t.options,p=>p.value==a),y=pe.toTreeArray(s);t.finish({selectedOptions:y,value:a})},inlineForm:[{slot:"extra",formType:"popup",show:!1,round:!0,name:"addressPop",position:"bottom",inlineForm:[{slot:"default",formType:"cascader",title:"请选择所在地区",options:[],value:"",close(){d("address","inlineForm.0.show",!1)},finish(e){const t=e.selectedOptions.map(s=>s.text).join("/"),a=e.selectedOptions.map(s=>s.value);this.value=e.value,d("address",t),d("address","middle.value",a),d("address","inlineForm.0.show",!1)}}]}]},{formType:"input",name:"sellManName",value:"",label:"销售人员",placeholder:"请输入销售人员"},{formType:"",customSlot:"timeSortType",name:"timeSortType",value:"desc",columns:[{text:"按时间正序",value:"asc"},{text:"按时间倒序",value:"desc"}],label:"排序方式",getParam(e){e[this.name]=this.value}},{formType:"input",name:"preApprovalTimeScope",value:"",label:"预审时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,class:"!z-[2018]",show:!1,type:"range",confirm(e){const t=e.map(a=>te(a).format("YYYY-MM-DD"));d("preApprovalTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]},{formType:"input",name:"contractSingedTimeScope",value:"",columns:[],label:"开工时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,show:!1,type:"range",confirm(e){const t=e.map(a=>te(a).format("YYYY-MM-DD"));d("contractSingedTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]},{formType:"input",name:"constructionTimeScope",value:"",columns:[],label:"签约时段",isLink:!0,realValue:[],readonly:!0,click(){this.inlineForm[0].show=!0},getParam(e){const[t,a]=this.realValue;t?e[this.name]={beginDateTime:t||"",endDateTime:a||""}:delete e[this.name]},inlineForm:[{slot:"button",formType:"calendar",allowSameDay:!0,show:!1,type:"range",confirm(e){const t=e.map(a=>te(a).format("YYYY-MM-DD"));d("constructionTimeScope",a=>{a.realValue=t,a.value=`${t[0]} 至 ${t[1]}`,a.inlineForm[0].show=!1})}}]}],vt=[He("客户信息"),{...de(),...E("investorId",[{text:"中山公用",value:"ZSGY"}]),label:"选择资方",name:"investorId"},{...de(),...E("type",[{text:"自然人项目",value:"ZZD"},{text:"法人项目",value:"ZZD_ORG"}]),label:"选择屋顶类型",name:"type",onMounted(){this.hidden=se(()=>!S("investorId","realValue"))}},{formType:"input",inputAlign:"center",inlineForm:[{slot:"input",formType:"button",size:"mini",className:"px-10 center !bg-[#ffab30] text-white rounded-2xl",text:"确认",click(){const e=S("investorId","realValue"),t=S("type","realValue");if(!e)ae("请选择资方");else if(!t)ae("请选择屋顶类型");else{const a=W();a.headers.Biztype=t,oe.push({path:"/customerInfo",query:{investorId:e,type:t,title:"客户信息 - "+(t=="ZZD"?"自然人":"法人")}})}}}]}],ft={class:"min-h-screen bg-gray-100"},ht={class:"yCenter"},gt={class:"xCenter"},_t={class:"xCenter"},yt={class:"flex flex-nowrap"},bt={class:"flex justify-center"},xt={class:"xCenter pt-2 text-[14px]"},wt={__name:"realLease",setup(e){const t=W(),a=w(!1),s=w(!1),y=w([]),p=w(!1),I=w(""),C=w([{count:"0",title:"订单数量",value:"orderCount"},{count:"0",title:"签约量",value:"statisticsSinged"},{count:"0",title:"建设中",value:"statisticsBuilding"},{count:"0",title:"并网量",value:"statisticsGridConnection"}]),H=se(()=>C.value[I.value]),D=Ee({filtrate:dt,moreForm:pt,newPopForm:vt}),L=t.headers.Biztype,r=w({pageNum:1,pageSize:10,total:0}),Z=w(""),x=G(),le=w({}),K=Xe(()=>k.fromPairs(D.filtrate.map(f=>[f.name,f.value]))),X=x.from=="cysj",ne=se(()=>Je("")?x.title=="客户信息"?"新增":"搜索":x.title=="预审"?"新增":"搜索"),M=w(!1);Le(async()=>{Ke(D,{}),qe(),y.value.length=0,s.value=!1,await ve()});async function ve(){let f="";const l=k.pick(G(),["stageId","stateId","taskId"]);if(X){l.stateId="CURRENT";const{data:m}=await F.post("bi/app-order-page-head",l);C.value.forEach((g,P)=>{g.count=P==0?m[g.value]:Ye(m[g.value],2).result})}else{k.merge(l,K.value,{orderType:L,queryTag:Z.value});const m=x.title=="初设评审",g=x.title=="勘察审核";f=m?"order-state/stage-design-state":"order-state/stage-task-state",g&&(l.stateId="WAITING_APPROVAL");const{data:P}=await F.get(Q(f,l));C.value=P.map(N=>({title:N.stateName,count:N.count,value:N.stateId}))}}const $=k.debounce(fe,300);async function fe(){const f=H.value.value.replace("orderCount",""),l=x.title=="终止"||x.title=="完成"||x.title=="订单列表",m={orderType:L,queryTag:Z.value};let g="";l?g="/order/search":g="/order/search-exclude-states";const P=k.pick(G(),["stageId","stateId","taskId"]);k.merge(m,P,le.value,K.value,{stateId:f}),X&&(m.stateId="CURRENT"),x.from=="cysj"&&x.stageId&&(m.stateId=x.stageId);const ee=Q(g,r.value),{data:U}=await F.post(ee,m),A=U.total;r.value.total=A;const q=U.list.map((Y,O)=>({...Y,index:y.value.length+O+1}));y.value.push(...q),a.value=!1,s.value=r.value.pageNum*r.value.pageSize>A,r.value.pageNum++}async function he(){X||(r.value.pageNum=1,r.value.pageSize=10,y.value.length=0,s.value=!1,await $())}async function ge(){ne.value=="新增"?Qe()?M.value=!0:oe.push("/inquiry"):(r.value.pageNum=1,r.value.pageSize=10,y.value.length=0,s.value=!1,$())}async function _e(f){r.value.pageNum=1,r.value.pageSize=10,y.value.length=0,s.value=!1,await $()}function ye(){le.value=Ge(),r.value.pageNum=1,r.value.pageSize=10,y.value.length=0,s.value=!1,$(),p.value=!1}function be(){k.forIn(K.value,(f,l)=>{d(l+"-more",m=>m.backfill())}),p.value=!0}function xe(){ae("功能开发中")}function we(f){const l=f.orderBase.orderId,m=f.orderBase.investorId,g=f.orderBase.type;oe.push({path:"/itemDetail",query:{orderId:l,investorId:m,type:g}})}return Oe({getData:$}),(f,l)=>{const m=Fe,g=ke,P=$e,N=Se,ee=Ne,U=De,A=Be,q=Re,Y=je,O=Ze,ie=Pe,Ie=Ve;return v(),T(V,null,[c("div",ft,[u(g,{modelValue:i(Z),"onUpdate:modelValue":l[0]||(l[0]=o=>z(Z)?Z.value=o:null),shape:"round",background:"#f3f3f3",placeholder:"系统编号、进件编号、组织全称、姓名、手机号","show-action":""},{action:n(()=>[c("div",ht,[u(m,{onClick:ge,class:"!w-auto !h-[34px] shadow !px-[15px] !rounded-full !border-none !bg-[#ffab30] !text-white"},{default:n(()=>[_(h(i(ne)),1)]),_:1})])]),_:1},8,["modelValue"]),u(N,{active:i(I),"onUpdate:active":l[1]||(l[1]=o=>z(I)?I.value=o:null),"line-width":"0",ellipsis:!1,"title-active-color":"#ffab30",onChange:he},{default:n(()=>[(v(!0),T(V,null,j(i(C),o=>(v(),R(P,null,{title:n(()=>[c("div",gt,h(o.count),1),c("div",_t,h(o.title),1)]),_:2},1024))),256))]),_:1},8,["active"]),c("div",yt,[u(U,{"active-color":"#ffab30",class:"w-[85vw]"},{default:n(()=>[(v(!0),T(V,null,j(i(D).filtrate,o=>(v(),R(ee,{onChange:_e,key:o.title,modelValue:o.value,"onUpdate:modelValue":b=>o.value=b,disabled:o.disabled,options:o.columns,title:o.title},null,8,["modelValue","onUpdate:modelValue","disabled","options","title"]))),128))]),_:1}),c("div",{class:"center w-[15vw] bg-white",onClick:be},"筛选")]),u(ie,{show:i(p),"onUpdate:show":l[3]||(l[3]=o=>z(p)?p.value=o:null),position:"right",class:"w-[90vw] h-[100vh]"},{default:n(()=>[u(O,{form:i(D).moreForm,class:"pt-3","group-class":"shadowC h-[92vh]"},{checkbox:n(({slot:o})=>[u(Y,{label:o.label,"input-align":"right"},{input:n(()=>[u(q,{modelValue:o.value,"onUpdate:modelValue":b=>o.value=b,class:"grid grid-cols-2 flex-end"},{default:n(()=>[(v(!0),T(V,null,j(o.columns,b=>(v(),R(A,{class:"ml-2 mt-2",name:b.value,"label-disabled":""},{default:n(()=>[_(h(b.text),1)]),_:2},1032,["name"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),timeSortType:n(({slot:o})=>[u(Y,{label:o.label,"input-align":"right"},{input:n(()=>[u(q,{modelValue:o.value,"onUpdate:modelValue":b=>o.value=b,class:"grid grid-cols-2 flex-end"},{default:n(()=>[(v(!0),T(V,null,j(o.columns,b=>(v(),R(A,{class:"ml-2 mt-2",name:b.value,"label-disabled":""},{default:n(()=>[_(h(b.text),1)]),_:2},1032,["name"]))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:1},8,["form"]),c("div",bt,[u(m,{onClick:l[2]||(l[2]=J(o=>p.value=!1,["stop"])),round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:n(()=>[_("取消")]),_:1}),u(m,{onClick:ye,round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:n(()=>[_("确认")]),_:1}),u(m,{onClick:xe,round:"",class:"!bg-[#ffab30] !ml-2 w-[100px]",size:"small",type:"warning"},{default:n(()=>[_("重置")]),_:1})])]),_:1},8,["show"]),c("div",xt,"有效订单数量: "+h(i(r).total),1),u(Ie,{loading:i(a),"onUpdate:loading":l[4]||(l[4]=o=>z(a)?a.value=o:null),finished:i(s),"finished-text":"没有更多了",onLoad:i($),class:"!pt-2"},{default:n(()=>[(v(!0),T(V,null,j(i(y),o=>(v(),R(mt,{key:o.orderBase.orderId,onClick:b=>we(o),item:o},null,8,["onClick","item"]))),128))]),_:1},8,["loading","finished","onLoad"])]),u(ie,{show:i(M),"onUpdate:show":l[6]||(l[6]=o=>z(M)?M.value=o:null),round:"",teleport:"#app","transition-appear":""},{"overlay-content":n(()=>[u(O,{onClick:l[5]||(l[5]=J(()=>{},["prevent"])),form:i(D).newPopForm,class:"pt-[20vh] mx-10","group-class":"shadowC"},null,8,["form"])]),_:1},8,["show"])],64)}}},Qt=Ue(wt,[["__scopeId","data-v-efb91d44"]]);export{Qt as default};
