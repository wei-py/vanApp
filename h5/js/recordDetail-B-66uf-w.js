import{m as z,_ as F}from"./makeForm-C_uyyvx9.js";import{B as D,H as O,h as L,e as M,g as E}from"./vant-DL9g20lT.js";import{f as J,c as W,e as A,$ as _,Z as h,_ as v,N as r,a8 as c,u as H,a0 as l,F as b,a4 as Q,a2 as Z,a3 as g,a1 as k,V as m}from"./@vue-BhOIXUCP.js";import{m as j,a as x,b as G}from"./backfill-hh-glB-L.js";import{b as w,m as q}from"./makeSelect-BzGYyrzS.js";import{h as d,y as K,g as R,c as X,l as Y,x as ee,n as ae}from"./index-NPFU1_kq.js";import{l as y}from"./lodash-C-AG1eJN.js";import{q as C}from"./queryUrl-ggRt1bhs.js";import{x as I}from"./xe-utils-BM3aD2L3.js";import{m as te}from"./makeUpload-FhoYjxox.js";import"./@vant-D2Uub16A.js";import"./class-rRG2y2aF.js";import"./pinia-CQ-jtR3-.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-XNYRUkAR.js";import"./@vueuse-BaMGbt4d.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-bC99Tnvx.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-VHbn-zkx.js";import"./vue3-photo-preview-Dedu722r.js";import"./vxe-table-BBegQXiE.js";import"./dom-zindex-GlLoxNk1.js";import"./dayjs-Bof1u0Bp.js";const oe=[j("备案证详情"),{formType:"input",label:"项目公司",required:!0,name:"companyId",...w(),...q("companyId",[],"dynamic"),async backfill(e){const{data:s}=await d.get(C("leaseLessor/getAuth",{pageNum:1,pageSize:999})),a=s.map(o=>({...o,text:`${o.code}, ${o.companyName}, ${o.areaId}`,value:o.code}));this.makeSelect(e[this.name]||a[0]?.value,a)}},{formType:"input",label:"备案类型",required:!0,readonly:!0,disabled:!0,value:"",name:"recordType",...w(),...q("recordType",[{text:"大备案证",value:1},{text:"精准备案",value:2}])},{customSlot:"accreditCompanyIds",label:"可用组织",required:!0,show:!1,name:"accreditCompanyIds",value:[],columns:[],middleColumns:[],checkColumns:[],confirm(){this.show=!1,this.checkColumns=y.clone(this.middleColumns),this.checkColumns=y.uniqBy(this.checkColumns,"value")},getParam(e){e[this.name]=`[${this.checkColumns.map(s=>s.value+"")}]`,JSON.stringify()},check(e){if(e.checked)this.middleColumns.push(e);else{const s=this.middleColumns.findIndex(a=>a==e.value);this.middleColumns.splice(s,1)}},async backfill(e){const{data:s}=await d.get(C("/company/infos",{currentPage:1,pageSize:999}));this.columns=s.records.map(a=>({...a,text:a.name,value:a.companyId})),JSON.parse(e[this.name]).forEach(a=>{const o=this.columns.find(u=>u.value==a);o&&(y.set(o,"checked",!0),this.check(o))}),this.confirm()},onMounted(){J(()=>{this.columns=[],this.middleColumns=[],this.checkColumns=[]})}},{formType:"input",label:"备案证编码",required:!0,value:"",placeholder:"请输入",name:"recordCertificateId"},{formType:"input",label:"备案证容量",required:!0,value:"",placeholder:"请输入",name:"recordCertificateCapacity",type:"digit",...x("kW"),getParam(e){e.recordCertificateCapacity=I.multiply(e.recordCertificateCapacity,1e3)},backfill(e){this.value=I.divide(e.recordCertificateCapacity,1e3)}},{formType:"input",label:"备案证剩余容量",value:"",placeholder:"请输入",name:"surplusCapacity",type:"digit",hidden:W(()=>R("recordType","realValue")!=1),...x("kW")},{...te(1,100,"*",!0,void 0,"accessory"),label:"备案证附件",required:!0,name:"accessory",getParam(e){e[this.name]=K(e[this.name][0])}}],ne={class:"!text-center"},se={class:"xCenter"},ce={class:"xCenter pt-2"},Ve={__name:"recordDetail",setup(e){const s=X(),a=z({record:oe});A(()=>{s.recordCertificateId&&o()});async function o(){const{data:i}=await d.get(C("record/one",s));Y(),G(a,i)}async function u(){await ee();const i=ae();return await d.post("/record/update",i)}return(i,p)=>{const T=O,U=L,$=_("vxe-column"),S=_("vxe-table"),f=D,V=M,B=E,N=F;return h(),v(b,null,[r(N,{form:H(a).record,class:"pt-3","group-class":"shadowC"},{accreditCompanyIds:c(({slot:t})=>[r(B,{name:t.name,label:t.label,"input-align":"right",required:t.required,isLink:"",onClick:n=>t.show=!0,valueClass:""},{input:c(()=>[l("div",null,[(h(!0),v(b,null,Q(t.checkColumns,n=>(h(),Z(T,{round:"",type:"primary",class:"!py-1 !w-full xCenter",color:"#ffab30"},{default:c(()=>[l("div",ne,g(n.name),1)]),_:2},1024))),256))]),r(V,{show:t.show,"onUpdate:show":n=>t.show=n,round:"",position:"bottom",class:"h-[50vh]",closeable:"",onClickCloseIcon:k(n=>t.show=!1,["stop"]),onClickOverlay:k(n=>t.show=!1,["stop"])},{default:c(()=>[r(S,{data:t.columns,align:"left","header-align":"center","max-height":"90%"},{default:c(()=>[r($,{field:"name"},{default:c(({row:n})=>[r(U,{"checked-color":"#ffab30",class:"van-haptics-feedback w-full",modelValue:n.checked,"onUpdate:modelValue":P=>n.checked=P,onClick:()=>t.check(n)},{default:c(()=>[m(g(n.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"])]),_:2},1024)]),_:2},1032,["data"]),l("div",se,[r(f,{round:"",block:"",class:"!my-1 !border-none !w-[50%] !bg-[#ffab30]",size:"small",type:"primary",onClick:k(()=>t.confirm(),["stop"])},{default:c(()=>[m(" 确认 ")]),_:2},1032,["onClick"])])]),_:2},1032,["show","onUpdate:show","onClickCloseIcon","onClickOverlay"])]),_:2},1032,["name","label","required","onClick"])]),_:1},8,["form"]),l("div",ce,[r(f,{block:"",type:"warning",round:"",size:"small",class:"!w-[100px] !bg-[#ffab30] !mr-8",onClick:p[0]||(p[0]=t=>i.$router.back())},{default:c(()=>[m("取消")]),_:1}),r(f,{block:"",type:"warning",round:"",size:"small",class:"!w-[100px] !bg-[#ffab30]",onClick:u},{default:c(()=>[m("保存")]),_:1})])],64)}}};export{Ve as default};
