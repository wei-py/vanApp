import{_ as F}from"./vantForm-CNH6TuWQ.js";import{B as D,M,l as j,r as E,j as L}from"./vant-BF4L1TGb.js";import{f as O,c as A,e as W,b3 as v,aX as y,al as g,N as n,bA as c,u as J,am as m,F as x,b1 as Q,aj as X,be as w,bD as C,V as d}from"./@vue-ts87NNlE.js";import{m as G,a as I}from"./makeTitle-CzVkaK9t.js";import{b as q,m as U}from"./makeSelect-CYTCxxsZ.js";import{h as p,E as H,j as K,g as R,c as Y,t as Z,F as ee,y as ae}from"./index-B7VWkQ_2.js";import{l as k}from"./lodash-DhpMPSDc.js";import{q as _}from"./queryUrl-BTYYWpY7.js";import{x as u}from"./xe-utils-DXe260hc.js";import{m as te}from"./makeUpload-Du0F1yJj.js";import{m as oe}from"./makeForm-BmsmFLmR.js";import{b as T}from"./backfill-BoX-74Dj.js";import"./@vant-NmgEisJw.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./@vueuse-QQdVrKV8.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";const re=[G("备案证详情"),{formType:"input",label:"项目公司",required:!0,name:"companyId",...q(),...U("companyId",[],"dynamic"),async backfill(e){const{data:t}=await p.get(_("leaseLessor/getAuth",{pageNum:1,pageSize:999})),a=t.map(r=>({...r,text:`${r.code}, ${r.companyName}, ${r.areaId}`,value:r.code}));this.makeSelect(e[this.name]||a[0]?.value,a)}},{formType:"input",label:"备案类型",required:!0,readonly:!0,value:"",name:"recordType",...q(),...U("recordType",[{text:"大备案证",value:1},{text:"精准备案",value:2}])},{customSlot:"accreditCompanyIds",label:"可用组织",required:!0,show:!1,name:"accreditCompanyIds",value:[],columns:[],middleColumns:[],checkColumns:[],confirm(){this.show=!1,this.checkColumns=k.clone(this.middleColumns),this.checkColumns=k.uniqBy(this.checkColumns,"value")},getParam(e){e[this.name]=`[${this.checkColumns.map(t=>t.value+"")}]`},check(e){if(e.checked)this.middleColumns.push(e);else{const t=this.middleColumns.findIndex(a=>a==e.value);this.middleColumns.splice(t,1)}},async backfill(e){const{data:t}=await p.get(_("/company/infos",{currentPage:1,pageSize:999}));this.columns=t.records.map(a=>({...a,text:a.name,value:a.companyId})),JSON.parse(e[this.name]||"[]").forEach(a=>{const r=this.columns.find(f=>f.value==a);r&&(k.set(r,"checked",!0),this.check(r))}),this.confirm()},onMounted(){O(()=>{this.columns=[],this.middleColumns=[],this.checkColumns=[]})}},{formType:"input",label:"备案证编码",required:!0,value:"",placeholder:"请输入",name:"recordCertificateId"},{formType:"input",label:"备案证容量",required:!0,value:"",placeholder:"请输入",name:"recordCertificateCapacity",type:"digit",...I("kW"),getParam(e){e.recordCertificateCapacity=u.multiply(e.recordCertificateCapacity,1e3)},backfill(e){this.value=u.divide(e.recordCertificateCapacity,1e3)}},{formType:"input",label:"备案证剩余容量",value:"",placeholder:"请输入",name:"surplusCapacity",type:"digit",hidden:A(()=>R("recordType","realValue")!=1),...I("kW"),getParam(e){e.surplusCapacity=u.multiply(e.surplusCapacity,1e3)},backfill(e){this.value=u.divide(e.surplusCapacity,1e3)}},{...te(1,100,"*",!0,void 0,"accessory"),label:"备案证附件",required:!0,name:"accessory",getParam(e){e[this.name]=H(e[this.name][0]);const t=K();e.userId=t.userId}}],se={class:"!text-center"},ce={class:"xCenter"},ne={class:"xCenter pt-2"},ze={__name:"recordDetail",setup(e){const t=Y(),a=oe({record:re});W(async()=>{t.recordCertificateId?r():(Z(),T(a,{}))});async function r(){const{data:i}=await p.get(_("record/one",t));T(a,i)}async function f(){await ee();const i=ae(),l=t.recordCertificateId?"/record/update":"/record/new";return await p.post(l,i)}return(i,l)=>{const b=M,V=j,$=v("vxe-column"),B=v("vxe-table"),h=D,S=E,N=L,P=F;return y(),g(x,null,[n(P,{form:J(a).record,class:"pt-3","group-class":"shadowC"},{accreditCompanyIds:c(({slot:o})=>[n(N,{name:o.name,label:o.label,"input-align":"right",required:o.required,isLink:"",onClick:s=>o.show=!0,valueClass:""},{input:c(()=>[m("div",null,[(y(!0),g(x,null,Q(o.checkColumns,s=>(y(),X(b,{round:"",type:"primary",class:"!py-1 !w-full xCenter",color:"#ffab30"},{default:c(()=>[m("div",se,w(s.name),1)]),_:2},1024))),256))]),n(S,{show:o.show,"onUpdate:show":s=>o.show=s,round:"",position:"bottom",class:"h-[50vh]",closeable:"",onClickCloseIcon:C(s=>o.show=!1,["stop"]),onClickOverlay:C(s=>o.show=!1,["stop"])},{default:c(()=>[n(B,{data:o.columns,align:"left","header-align":"center","max-height":"90%"},{default:c(()=>[n($,{field:"name"},{default:c(({row:s})=>[n(V,{"icon-size":"16px","checked-color":"#ffab30",class:"van-haptics-feedback w-full",modelValue:s.checked,"onUpdate:modelValue":z=>s.checked=z,onClick:()=>o.check(s)},{default:c(()=>[d(w(s.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"])]),_:2},1024)]),_:2},1032,["data"]),m("div",ce,[n(h,{round:"",block:"",class:"!my-1 !border-none !w-[50%] !bg-[#ffab30]",size:"small",type:"primary",onClick:C(()=>o.confirm(),["stop"])},{default:c(()=>[d(" 确认 ")]),_:2},1032,["onClick"])])]),_:2},1032,["show","onUpdate:show","onClickCloseIcon","onClickOverlay"])]),_:2},1032,["name","label","required","onClick"])]),_:1},8,["form"]),m("div",ne,[n(h,{block:"",type:"warning",round:"",size:"small",class:"!w-[100px] !bg-[#ffab30] !mr-8",onClick:l[0]||(l[0]=o=>i.$router.back())},{default:c(()=>[d("取消")]),_:1}),n(h,{block:"",type:"warning",round:"",size:"small",class:"!w-[100px] !bg-[#ffab30]",onClick:f},{default:c(()=>[d("保存")]),_:1})])],64)}}};export{ze as default};
