import{m as z,_ as F}from"./makeForm-b9Rv_zTa.js";import{B as L,H as M,h as O,e as A,g as E}from"./vant-xiv0EFx3.js";import{f as W,c as j,e as H,b3 as b,aX as C,al as g,N as s,bA as n,u as J,am as m,F as w,b1 as Q,aj as X,be as x,bD as k,V as d}from"./@vue-BHA94vdH.js";import{m as G,a as I,b as q}from"./backfill-Knvieq5z.js";import{b as U,m as T}from"./makeSelect-VTItfMq-.js";import{h as p,B as K,f as R,g as Y,c as Z,n as ee,D as ae,v as te}from"./index-BiU8ePZK.js";import{l as y}from"./lodash-C1iNKp1x.js";import{q as _}from"./queryUrl-CUkA5NKU.js";import{x as u}from"./xe-utils-D22uZPtC.js";import{m as oe}from"./makeUpload-Vv_MC7yY.js";import"./@vant-BMzV8Unt.js";import"./class-rRG2y2aF.js";import"./pinia-BOLtM30a.js";import"./vue-demi-Dq6ymT-8.js";import"./vue-router-BQWAt7JZ.js";import"./@vueuse-BYPNFz0v.js";import"./axios-B6xwUs71.js";import"./@x-ui-vue3-DYFNhZJM.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus--RpDJ8QK.js";import"./vue3-photo-preview-Byv7Qnko.js";import"./vxe-table-CbQjGgi9.js";import"./dom-zindex-GlLoxNk1.js";import"./dayjs-19KvoO9f.js";const ce=[G("备案证详情"),{formType:"input",label:"项目公司",required:!0,name:"companyId",...U(),...T("companyId",[],"dynamic"),async backfill(e){const{data:t}=await p.get(_("leaseLessor/getAuth",{pageNum:1,pageSize:999})),a=t.map(c=>({...c,text:`${c.code}, ${c.companyName}, ${c.areaId}`,value:c.code}));this.makeSelect(e[this.name]||a[0]?.value,a)}},{formType:"input",label:"备案类型",required:!0,readonly:!0,value:"",name:"recordType",...U(),...T("recordType",[{text:"大备案证",value:1},{text:"精准备案",value:2}])},{customSlot:"accreditCompanyIds",label:"可用组织",required:!0,show:!1,name:"accreditCompanyIds",value:[],columns:[],middleColumns:[],checkColumns:[],confirm(){this.show=!1,this.checkColumns=y.clone(this.middleColumns),this.checkColumns=y.uniqBy(this.checkColumns,"value")},getParam(e){e[this.name]=`[${this.checkColumns.map(t=>t.value+"")}]`},check(e){if(e.checked)this.middleColumns.push(e);else{const t=this.middleColumns.findIndex(a=>a==e.value);this.middleColumns.splice(t,1)}},async backfill(e){const{data:t}=await p.get(_("/company/infos",{currentPage:1,pageSize:999}));this.columns=t.records.map(a=>({...a,text:a.name,value:a.companyId})),JSON.parse(e[this.name]||"[]").forEach(a=>{const c=this.columns.find(f=>f.value==a);c&&(y.set(c,"checked",!0),this.check(c))}),this.confirm()},onMounted(){W(()=>{this.columns=[],this.middleColumns=[],this.checkColumns=[]})}},{formType:"input",label:"备案证编码",required:!0,value:"",placeholder:"请输入",name:"recordCertificateId"},{formType:"input",label:"备案证容量",required:!0,value:"",placeholder:"请输入",name:"recordCertificateCapacity",type:"digit",...I("kW"),getParam(e){e.recordCertificateCapacity=u.multiply(e.recordCertificateCapacity,1e3)},backfill(e){this.value=u.divide(e.recordCertificateCapacity,1e3)}},{formType:"input",label:"备案证剩余容量",value:"",placeholder:"请输入",name:"surplusCapacity",type:"digit",hidden:j(()=>Y("recordType","realValue")!=1),...I("kW"),getParam(e){e.recordCertificateCapacity=u.multiply(e.recordCertificateCapacity,1e3)},backfill(e){this.value=u.divide(e.recordCertificateCapacity,1e3)}},{...oe(1,100,"*",!0,void 0,"accessory"),label:"备案证附件",required:!0,name:"accessory",getParam(e){e[this.name]=K(e[this.name][0]);const t=R();e.userId=t.userId}}],re={class:"!text-center"},ne={class:"xCenter"},se={class:"xCenter pt-2"},Se={__name:"recordDetail",setup(e){const t=Z(),a=z({record:ce});H(async()=>{t.recordCertificateId?c():(ee(),q(a,{}))});async function c(){const{data:i}=await p.get(_("record/one",t));q(a,i)}async function f(){await ae();const i=te(),l=t.recordCertificateId?"/record/update":"/record/new";return await p.post(l,i)}return(i,l)=>{const v=M,V=O,$=b("vxe-column"),B=b("vxe-table"),h=L,S=A,N=E,P=F;return C(),g(w,null,[s(P,{form:J(a).record,class:"pt-3","group-class":"shadowC"},{accreditCompanyIds:n(({slot:o})=>[s(N,{name:o.name,label:o.label,"input-align":"right",required:o.required,isLink:"",onClick:r=>o.show=!0,valueClass:""},{input:n(()=>[m("div",null,[(C(!0),g(w,null,Q(o.checkColumns,r=>(C(),X(v,{round:"",type:"primary",class:"!py-1 !w-full xCenter",color:"#ffab30"},{default:n(()=>[m("div",re,x(r.name),1)]),_:2},1024))),256))]),s(S,{show:o.show,"onUpdate:show":r=>o.show=r,round:"",position:"bottom",class:"h-[50vh]",closeable:"",onClickCloseIcon:k(r=>o.show=!1,["stop"]),onClickOverlay:k(r=>o.show=!1,["stop"])},{default:n(()=>[s(B,{data:o.columns,align:"left","header-align":"center","max-height":"90%"},{default:n(()=>[s($,{field:"name"},{default:n(({row:r})=>[s(V,{"checked-color":"#ffab30",class:"van-haptics-feedback w-full",modelValue:r.checked,"onUpdate:modelValue":D=>r.checked=D,onClick:()=>o.check(r)},{default:n(()=>[d(x(r.name),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onClick"])]),_:2},1024)]),_:2},1032,["data"]),m("div",ne,[s(h,{round:"",block:"",class:"!my-1 !border-none !w-[50%] !bg-[#ffab30]",size:"small",type:"primary",onClick:k(()=>o.confirm(),["stop"])},{default:n(()=>[d(" 确认 ")]),_:2},1032,["onClick"])])]),_:2},1032,["show","onUpdate:show","onClickCloseIcon","onClickOverlay"])]),_:2},1032,["name","label","required","onClick"])]),_:1},8,["form"]),m("div",se,[s(h,{block:"",type:"warning",round:"",size:"small",class:"!w-[100px] !bg-[#ffab30] !mr-8",onClick:l[0]||(l[0]=o=>i.$router.back())},{default:n(()=>[d("取消")]),_:1}),s(h,{block:"",type:"warning",round:"",size:"small",class:"!w-[100px] !bg-[#ffab30]",onClick:f},{default:n(()=>[d("保存")]),_:1})])],64)}}};export{Se as default};
