import{_ as F}from"./vantForm-CNH6TuWQ.js";import{m as w,a as T}from"./makeTitle-CzVkaK9t.js";import{c as f,s as i,b as k,g as h,y as _,h as r,u as I,_ as $,e as C}from"./index-B7VWkQ_2.js";import{l as m}from"./lodash-DhpMPSDc.js";import{b as d,m as y}from"./makeSelect-CYTCxxsZ.js";import{g as S}from"./getArea-BkpOAjjF.js";import{x as u}from"./xe-utils-DXe260hc.js";import{w as O}from"./wait-Dqho1LKt.js";import{a as q,s as M,b as B}from"./vant-BF4L1TGb.js";import{r as E}from"./@vueuse-QQdVrKV8.js";import{m as N}from"./makeForm-BmsmFLmR.js";import{b as P}from"./backfill-BoX-74Dj.js";import{r as U,e as A,aX as v,al as D,b1 as L,u as b,F as j,aj as z}from"./@vue-ts87NNlE.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";import"./@vant-NmgEisJw.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";const K=[{...w("新增仓库"),name:"stoName",backfill(t){f().buttonText=="新增"?this.title="新增仓库":this.title=t[this.name]}},{formType:"input",value:"",name:"stoName",label:"仓库名称"},{...d(),...y("stoType",[{text:"一级仓库",value:"ZY"},{text:"二级仓库",value:"JMS"}],"dymaic"),value:"",name:"stoType",label:"仓库类型",backfill(t){this.inlineForm[0].inlineForm[0].confirm=e=>{i(this.name,"value",e.selectedOptions[0].text),i(this.name,"realValue",e.selectedOptions[0].value),i(this.name,"inlineForm.0.show",!1)},this.makeSelect(t[this.name],this.inlineForm[0].inlineForm[0].columns)}},{formType:"input",label:"地理区域",name:"locals",isLink:!0,readonly:!0,value:"",required:!0,placeholder:"请选择所在地区",middle:{value:[],province:"",city:"",area:""},click(){const t=k();this.inlineForm[0].show=t.btns.canEdit},getParam(t){const e=this.name.replace("locals",""),[a,o,s]=this.middle.value;t[`province${e}`]=a,t[`city${e}`]=o,t[`area${e}`]=s,t[this.name]=t[this.name].split("/")},async backfill(t){this.inlineForm[0].inlineForm[0].name=this.name;const e=this.name.replace("locals",""),a=h(this.name,"inlineForm.0.inlineForm.0");a.options=await m.throttle(S)(),a.options=u.mapTree(a.options,n=>({...n,value:n.text}));const o=t[`area${e}`]||t[`city${e}`];i(this.name,"inlineForm.0.inlineForm.0.value",o);const s=u.searchTree(a.options,n=>n.value==o),l=u.toTreeArray(s);a.finish({selectedOptions:l,value:o})},inlineForm:[{slot:"extra",formType:"popup",show:!1,round:!0,name:"localsPop",position:"bottom",inlineForm:[{slot:"default",formType:"cascader",title:"请选择所在地区",options:[],value:"",close(){i(this.name,"inlineForm.0.show",!1)},finish(t){const e=t.selectedOptions.map(o=>o.text).join("/"),a=t.selectedOptions.map(o=>o.value);this.value=t.value,i(this.name,e),i(this.name,"middle.value",a),i(this.name,"inlineForm.0.show",!1)}}]}]},{formType:"input",value:"",name:"address",address:"",lat:"",lng:"",loading:E(!1,5e3),label:"仓库定位",rightIcon:"location-o",clickRightIcon(){q("开发中...")}},{formType:"input",value:"",name:"stoCapacity",label:"仓库容量",...T("W")},{...d(),...y("companyId",[],"dymaic"),formType:"input",value:"",name:"companyId",label:"所属组织",async backfill(t){await O(1e3);const e=h("companyIdColumns","columns");this.makeSelect(t[this.name],e),this.inlineForm[0].inlineForm[0].confirm=a=>{i(this.name,"value",a.selectedOptions[0].text),i(this.name,"realValue",a.selectedOptions[0].value),i(this.name,"inlineForm.0.show",!1)}}},{formType:"input",labelClass:"!w-0",name:"button",valueClass:"!w-1/2",backfill(){const t=f();t.buttonText&&(this.inlineForm[1].text=t.buttonText);const e=this.name.replace("button","");this.inlineForm[0].name=e,this.inlineForm[1].name=e},getParam(t){delete t[this.name]},inlineForm:[{slot:"input",formType:"button",text:"取消",class:"w-full !rounded-none !border-[white]",click(){M(this.text)}},{slot:"extra",formType:"button",text:"更改",class:"w-1/2 !rounded-none !border-[#ffab30] !text-white !bg-[#ffab30]",async click(t){let e={};const a=this.name.replace("button",""),o=m.pickBy(_(),(l,n)=>n.includes(a)),s=m.mapKeys(o,(l,n)=>n.replace(/(.*?)_\w+/,"$1"));this.text=="删除"?(e=await r.delete(`sto/remove/${s.stoId}`),await I().getData()):this.text=="更改"?e=await r.put("/sto/update",s):this.text=="新增"&&(e=await r.post("sto/create",s)),e.code==200&&B(this.text+"成功")}}]},{formType:"input",name:"stoId",value:"",class:"!hidden"},{formType:"input",name:"latitude",value:"23.001617",class:"!hidden"},{formType:"input",name:"longitude",value:"113.937768",class:"!hidden"}],R=[{formType:"",name:"companyIdColumns",columns:[],async onMounted(){const{data:t}=await r.get("company/infos?pageNum=1&pageSize=999");this.columns=t.records.map(e=>({text:e.name,value:e.companyId,...e}))},async getColumns(){return this.columns.length||m.throttle(this.onMounted)(),this.columns}}];function V(t,e){m.range(e).forEach(a=>{const o=m.cloneDeep(K).map(s=>(s.name+="_"+(a+1),s));t[a+1]=o})}const J={__name:"storeUpdate",setup(t){let e=N({hiddenColumns:R});const a=f();let o=U(0);async function s(){let l={};if(a.buttonText!="新增"){const{data:n}=await r.post("sto/list?pageNum=1&pageSize=100",{});o.value=n.records.length;const c=n.records.map((p,g)=>m.mapKeys(p,(Q,x)=>`${x}_${g+1}`));l=m.merge(...c)}else o.value=1;V(e,o.value),P(e,l)}return A(()=>{s()}),C({getData:s}),(l,n)=>{const c=F;return v(!0),D(j,null,L(b(o),p=>(v(),z(c,{form:b(e)[p],class:"pt-3","group-class":"shadowC"},null,8,["form"]))),256)}}},Fe=$(J,[["__scopeId","data-v-938165f7"]]);export{Fe as default};
