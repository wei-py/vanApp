import{_ as q}from"./vBtn-OZoOqbE9.js";import{m as P,_ as N}from"./makeForm-CZNh9NHd.js";import{m as c,a as f,b as x}from"./backfill-DhcBw5pe.js";import{b as g,m as v}from"./makeSelect-Cjo5tNN-.js";import{c as h,h as l,s as B,b as w,g as b,j as S,t as U,e as V,x as A}from"./index-r_oNj4vA.js";import{l as j}from"./lodash-DhpMPSDc.js";import{q as d}from"./queryUrl-BTYYWpY7.js";import{w as y}from"./watchItem-ZuwY-cMq.js";import{c as R}from"./callPhone-B18Cvcdp.js";import{a as _}from"./arrayToVantColumns-BXijbtnA.js";import{c as W}from"./@vueuse-QQdVrKV8.js";import{m as u}from"./makeUpload-D64lSZ7H.js";import{e as D,aX as k,al as I,N as n,u as i,ak as L,F as M}from"./@vue-ts87NNlE.js";import"./vant-CJN7raQG.js";import"./@vant-NmgEisJw.js";import"./wait-Dqho1LKt.js";import"./class-COLQ8iHP.js";import"./pinia-B_HOjTBS.js";import"./vue-router-Bw4qQE88.js";import"./xe-utils-DXe260hc.js";import"./@vue-office-GFDCm3nC.js";import"./vue-demi-BEcyFcst.js";import"./vue-RHKPHaPZ.js";import"./axios-B4uVmeYG.js";import"./@x-ui-vue3-CwLx_scX.js";import"./pinia-plugin-persist-J3Q2VqHx.js";import"./vue3-menus-CnNWMJEM.js";import"./vue3-photo-preview-CkWuweRQ.js";import"./vxe-table-QgdefRjh.js";import"./dom-zindex-GlLoxNk1.js";const O=[c("指派技术勘察员"),{formType:"input",label:"技术勘察员",name:"userId",required:!0,value:"",...g(),...v("userId",[],"dynamic"),async backfill(a){const e=d("user/get-by-permission",{permissions:"PER_JSKC",orderId:h()?.orderId}),{data:r}=await l.get(e),s=r.map(t=>({...t,text:t.name,value:t.userId}));y("userId",t=>{B("phone","value",j.find(s,["value",t])?.phone||"")}),this.makeSelect(a[this.name],s),this.disabled=!1,this.click=()=>{const t=w();this.inlineForm[0].show=t.btns.canSave}}},{formType:"input",label:"技术勘察员手机号码",value:"",readonly:!0,required:!0,placeholder:"系统抓取技术勘察员手机号码",name:"phone",rightIcon:"phone",clickRightIcon(){R(this.value)}},{formType:"cell",titleClass:" xCenter",inlineForm:[{slot:"title",formType:"button",text:"指派",round:!0,size:"small",type:"primary",class:" !py-1 !bg-[#ffab30] text-white !border-0 w-[30%]",async click(){const a=b("userId","realValue"),e=h();await l.post(d("appoint/jskc",{...e,userId:a})),location.reload()}}],backfill(a){const e=a.orderState.stageId,r=a.orderState.stateId;S().userId,e=="KAN_CHA"&&(this.inlineForm[0].text=r=="WAITING_APPOINT"?"指派":"重新指派"),y("userId",s=>{this.inlineForm[0].disabled=!new Boolean(s).valueOf()})}}],$=[c("基本信息"),{formType:"input",label:"拟安装逆变器品牌",name:"inverterBrand",value:"",required:!0,...g(),...v("inverterBrand",[],"dymatic"),async backfill(a){const{data:e}=await l.post("/sto/device-args/list?option=manufacturerShortName",{deviceType:"NBQ"});this.makeSelect(a[this.name],_(e))}},{formType:"input",label:"拟安装组件功率",value:"",placeholder:"请输入",type:"digit",required:!0,name:"modulePower",...f("W")},{formType:"input",label:"拟安装组件数量",value:"",required:!0,placeholder:"请输入",name:"moduleNumberReckon",type:"number",...f("块")},{formType:"input",label:"拟安装容量",realValue:"",value:"",readonly:!0,placeholder:"自动计算",realValue:0,required:!0,name:"installedCapacityReckon",...f("W"),backfill(a){W(()=>{const e=b("modulePower").value*b("moduleNumberReckon").value;this.realValue=e;const r=U(e,2);return this.value=r.value,this.makeUnit(r.unit),e})}}],E=[c("屋顶无人机航拍图"),{...u(1,100,"",!0),label:"无人机全景俯视图(必填)",required:!0,name:"aerophotographWhole"},{...u(1,100,"",!0),label:"无人机(西北角往东南拍)(必填)",required:!0,name:"aerophotographNorthwest"},{...u(1,100,"",!0),label:"无人机(东北角往西南拍)(必填)",name:"aerophotographNortheast",required:!0}],G=[c("逆变器安装位置"),{...u(1,100,"",!0),label:"逆变器安装位置(必填)",name:"inverterPosition",required:!0}],K=[c("配电箱安装位置"),{...u(1,100,"",!0),label:"配电箱安装位置(必填)",name:"distributionBoxPosition",required:!0}],Q=[c("并网点位置"),{...u(1,100),label:"并网点位置水印相机定位照(选填)",name:"junctionLocation"},{formType:"input",label:"能否进随车吊",value:"",required:!0,name:"allowCrane",...g(),...v("allowCrane",_(["能","不能","不确定"]))}],z={key:0},Ce={__name:"technicalLnvestigation",setup(a){const e=P({reconnaissanceUserForm:O,basicMessageForm:$,aerophotographForm:E,inverterPositionForm:G,distributionBoxPositionForm:K,junctionLocationForm:Q}),r=w();D(()=>{s()});async function s(){const o=d("order/get-tec-kancha",{orderId:h()?.orderId}),{data:p}=await l.get(o);x(e,{...p,...p.appointUser})}async function t(){const o=A();return await l.post("order/put-tec-kancha",o)}async function F(o){await l.post(d("approval/put-approval/bto/tec-takan",o))}async function C(o){await l.post("approval/do-approval/bto/tec-takan",o)}return V({saveData:t,getData:s,submitData:F,approvalData:C}),(o,p)=>{const m=N,T=q;return k(),I(M,null,[n(m,{form:i(e).reconnaissanceUserForm,class:"pt-3","group-class":"shadowC"},null,8,["form"]),o.$get(i(r),"orderState.stateId")!="WAITING_APPOINT"?(k(),I("div",z,[n(m,{form:i(e).basicMessageForm,class:"pt-3","group-class":"shadowC"},null,8,["form"]),n(m,{form:i(e).aerophotographForm,class:"pt-3","group-class":"shadowC"},null,8,["form"]),n(m,{form:i(e).inverterPositionForm,class:"pt-3","group-class":"shadowC"},null,8,["form"]),n(m,{form:i(e).distributionBoxPositionForm,class:"pt-3","group-class":"shadowC"},null,8,["form"]),n(m,{form:i(e).junctionLocationForm,class:"pt-3","group-class":"shadowC"},null,8,["form"])])):L("",!0),n(T)],64)}}};export{Ce as default};
