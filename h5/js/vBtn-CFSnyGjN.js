import{b as I,a as j,B as L}from"./vant-PdAvEskO.js";import{m as M,_ as U}from"./makeForm-LXfxxl4j.js";import{m as J}from"./backfill-YTqXYfvZ.js";import{b as T,E as z,I as A,G as q,u as G,F as K,e as W,J as F,D as X,v as $,K as H,B as Q,r as Y}from"./index-D0ldpvYI.js";import{l as c}from"./lodash-D-SkTV7p.js";import{m as Z}from"./makeUpload-BNh7QOMX.js";import{c as u,r as ee,e as ae,aX as d,al as te,u as a,aj as v,ak as b,am as se,bA as y,V as R,F as oe}from"./@vue-ts87NNlE.js";const P=[J("审核"),{formType:"input",label:"订单",readonly:!0,name:"orderId",value:""},{formType:"input",label:"审核方式",name:"approvalType",readonly:!0,value:"",realValue:"",backfill(t){const n={APPROVAL_INNER:"内部审核",APPROVAL_BTO:"博通审核",APPROVAL_LEASE:"资方审核"},l=t.stateId=="WAITING_APPROVAL_BTO"?"APPROVAL_BTO":"APPROVAL_INNER";this.realValue=t[this.name]||l,this.value=n[t[this.name]||l]}},{formType:"input",label:"审核结果",name:"result",value:"",realValue:"",readonly:!0,disabled:!0,required:!0,isLink:!0,backfill(t){const n={PASS:"通过",REJECT:"拒绝"};this.realValue=t[this.name],this.value=n[t[this.name]]},click(){const t=T();this.inlineForm[0].show=t.btns.canApproval},onMounted(){const t=this;this.inlineForm=[{slot:"extra",name:"Pop",formType:"popup",show:!1,round:!0,position:"bottom",class:"h-[40vh] !w-screen",closeOnClickOverlay:!0,inlineForm:[{slot:"default",formType:"pick",confirm(n){t.value=n.selectedOptions[0].text,t.realValue=n.selectedOptions[0].value,t.inlineForm[0].show=!1},cancel(){t.inlineForm[0].show=!1},columns:[{value:"PASS",text:"通过"},{value:"REJECT",text:"拒绝"}]}]}]}},{formType:"input",label:"原因",value:"",error:!0,inputAlign:"left",placeholder:"请输入原因",name:"rejectReason"},{formType:"input",name:"rejectFiles",label:"附件",...Z(999,100,"*",!1,!1),async backfill(t){this.inlineForm[0].value=(t[this.name]||[]).map(n=>({url:z(n.fileSrc)})),await A(2e3),q(...this.inlineForm[0].value.map(n=>n.url))}}],ne={class:"flex justify-center my-2"},de={__name:"vBtn",setup(t,{expose:n}){const l=G(),o=T(),k=K();let h=u(()=>o.btns.hasEditBtn),i=u(()=>o.btns.canEdit),_=u(()=>o.btns.canSave),E=u(()=>o.btns.hasApprovalBtn),f=u(()=>o.btns.canApproval),B=u(()=>o.btns.rejectReason&&o.btns.hasApprovalModule),s=M({rejectReason:P},!1),g=ee(!1);const V=u(()=>!(h.value&&i.value&&_.value)&&!i.value);function w(){for(let e=0;e<s.rejectReason.length;e++){if(o.btns.rejectReason&&o.btns.hasApprovalModule){const r=s.rejectReason[e].name;c.isFunction(s.rejectReason[e].backfill)?s.rejectReason[e].backfill(o.btns.rejectReason):s.rejectReason[e].value=o.btns.rejectReason[r],c.isFunction(s.rejectReason[e].onMounted)&&e==3&&s.rejectReason[e].onMounted()}g.value=o.btns.hasApprovalBtn&&!o.btns.canEdit&&!o.btns.canApproval,g.value?(s.rejectReason[e].readonly=!0,s.rejectReason[e].click=()=>{},s.rejectReason[5].inlineForm[0].readonly=!0,s.rejectReason[5].inlineForm[0].disabled=!0):(s.rejectReason[e].readonly=!1,s.rejectReason[e].click=function(){this.inlineForm[0].show=o.btns.canApproval},s.rejectReason[5].inlineForm[0].readonly=!1,s.rejectReason[5].inlineForm[0].disabled=!1)}}W({approvalBackfill:w}),n({approvalBackfill:w}),ae(async()=>{l.approvalBackfill(),V.value,P[3].readonly=!0});const D=c.debounce(O,300);async function O(){F();try{const e=await l.saveData();if(e){const r=c.get(e,"msg","保存成功")||"保存成功";I(r)}}catch(e){j("保存失败: "+e.msg)}}const S=c.debounce(x,300);async function x(){F(),await l.saveData();try{const e=await X(),r=$(),m=c.pick(r,["id","orderId"]);l.submitData(m),l.getData(),await A(2e3),location.reload()}catch(e){j({className:"!bg-[red] !text-white",message:e[0].message})}}const C=c.debounce(N,300);async function N(){await k.approvalDoms.approval.validate();const e=k.approvalDoms.approval.getValues(),r={内部审核:"APPROVAL_INNER",博通审核:"APPROVAL_BTO",资方审核:"APPROVAL_LEASE"},m={通过:"PASS",拒绝:"REJECT"};e.approvalType=r[e.approvalType],e.result=m[e.result],e.rejectFiles=e.rejectFiles.map(p=>({fileName:H(p),fileSrc:Q(p)})),await l.approvalData(e),await A(2e3),Y.currentRoute.value.name=="deviceInfo"||location.reload()}return(e,r)=>{const m=U,p=L;return d(),te(oe,null,[a(B)?(d(),v(m,{key:0,readonly:!a(f),disabled:!a(f),"show-error-message":a(f),form:a(s).rejectReason,"approval-name":"approval",class:"pt-3","group-class":"shadowC"},null,8,["readonly","disabled","show-error-message","form"])):b("",!0),se("div",ne,[a(h)&&a(i)&&a(_)?(d(),v(p,{key:0,disabled:!a(i),round:"",block:"",type:"warning",onClick:a(D),size:"small",class:"!w-[100px] !bg-[#ffab30] !mr-9"},{default:y(()=>[R(" 保存 ")]),_:1},8,["disabled","onClick"])):b("",!0),a(h)&&a(i)?(d(),v(p,{key:1,disabled:!a(i),round:"",block:"",type:"warning",onClick:a(S),size:"small",class:"!w-[100px] !bg-[#ffab30]"},{default:y(()=>[R(" 提交 ")]),_:1},8,["disabled","onClick"])):b("",!0),a(E)&&!a(i)?(d(),v(p,{key:2,disabled:!a(f),round:"",block:"",type:"warning",onClick:a(C),size:"small",class:"!w-[100px] !bg-[#ffab30]"},{default:y(()=>[R(" 审核 ")]),_:1},8,["disabled","onClick"])):b("",!0)])],64)}}};export{de as _};
