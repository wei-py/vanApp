import{b as x,a as j,B as I}from"./vant-xiv0EFx3.js";import{m as L,_ as M}from"./makeForm-BYuXLPle.js";import{m as U}from"./backfill-BAe46Apz.js";import{b as P,E as J,I as A,G as z,u as $,F as q,e as G,J as F,D as K,v as W,K as X,B as H,r as Q}from"./index-BCLLWcQc.js";import{l as c}from"./lodash-C1iNKp1x.js";import{m as Y}from"./makeUpload--4DuReni.js";import{c as u,r as Z,e as ee,aX as d,al as ae,u as a,aj as v,ak as b,am as te,bA as R,V as h,be as se,F as oe}from"./@vue-BHA94vdH.js";const ne=[U("审核"),{formType:"input",label:"订单",readonly:!0,name:"orderId",value:""},{formType:"input",label:"审核方式",name:"approvalType",readonly:!0,value:"",realValue:"",backfill(s){const n={APPROVAL_INNER:"内部审核",APPROVAL_BTO:"博通审核",APPROVAL_LEASE:"资方审核"},l=s.stateId=="WAITING_APPROVAL_BTO"?"APPROVAL_BTO":"APPROVAL_INNER";this.realValue=s[this.name]||l,this.value=n[s[this.name]||l]}},{formType:"input",label:"审核结果",name:"result",value:"",realValue:"",readonly:!0,required:!0,isLink:!0,backfill(s){const n={PASS:"通过",REJECT:"拒绝"};this.realValue=s[this.name],this.value=n[s[this.name]]},click(){const s=P();this.inlineForm[0].show=s.btns.canApproval},onMounted(){const s=this;this.inlineForm=[{slot:"extra",name:"Pop",formType:"popup",show:!1,round:!0,position:"bottom",class:"h-[40vh] !w-screen",closeOnClickOverlay:!0,inlineForm:[{slot:"default",formType:"pick",confirm(n){s.value=n.selectedOptions[0].text,s.realValue=n.selectedOptions[0].value,s.inlineForm[0].show=!1},columns:[{value:"PASS",text:"通过"},{value:"REJECT",text:"拒绝"}]}]}]}},{formType:"input",label:"原因",value:"",error:!0,inputAlign:"left",placeholder:"请输入原因",name:"rejectReason"},{formType:"input",name:"rejectFiles",label:"附件",...Y(999,100,"*",!1,!1),async backfill(s){this.inlineForm[0].value=(s[this.name]||[]).map(n=>({url:J(n.fileSrc)})),await A(2e3),z(...this.inlineForm[0].value.map(n=>n.url))}}],le={class:"flex justify-center my-2"},fe={__name:"vBtn",setup(s,{expose:n}){const l=$(),o=P(),k=q();let y=u(()=>o.btns.hasEditBtn),i=u(()=>o.btns.canEdit),_=u(()=>o.btns.canSave),T=u(()=>o.btns.hasApprovalBtn),f=u(()=>o.btns.canApproval),E=u(()=>o.btns.rejectReason&&o.btns.hasApprovalModule),t=L({rejectReason:ne},!1),g=Z(!1);const B=u(()=>!(y.value&&i.value&&_.value)&&!i.value);function w(){for(let e=0;e<t.rejectReason.length;e++){if(o.btns.rejectReason&&o.btns.hasApprovalModule){const r=t.rejectReason[e].name;c.isFunction(t.rejectReason[e].backfill)?t.rejectReason[e].backfill(o.btns.rejectReason):t.rejectReason[e].value=o.btns.rejectReason[r],c.isFunction(t.rejectReason[e].onMounted)&&e==3&&t.rejectReason[e].onMounted()}g.value=o.btns.hasApprovalBtn&&!o.btns.canEdit&&!o.btns.canApproval,g.value?(t.rejectReason[e].readonly=!0,t.rejectReason[e].click=()=>{},t.rejectReason[5].inlineForm[0].readonly=!0,t.rejectReason[5].inlineForm[0].disabled=!0):(t.rejectReason[e].readonly=!1,t.rejectReason[e].click=function(){this.inlineForm[0].show=o.btns.canApproval},t.rejectReason[5].inlineForm[0].readonly=!1,t.rejectReason[5].inlineForm[0].disabled=!1)}}G({approvalBackfill:w}),n({approvalBackfill:w}),ee(async()=>{l.approvalBackfill(),B.value});const D=c.debounce(V,300);async function V(){F();try{const e=await l.saveData();if(e){const r=c.get(e,"msg","保存成功")||"保存成功";x(r)}}catch{j("保存失败")}}const O=c.debounce(S,300);async function S(){F(),await l.saveData();try{const e=await K(),r=W(),m=c.pick(r,["id","orderId"]);l.submitData(m),l.getData(),await A(2e3),location.reload()}catch(e){j({className:"!bg-[red] !text-white",message:e[0].message})}}const C=c.debounce(N,300);async function N(){await k.approvalDoms.approval.validate();const e=k.approvalDoms.approval.getValues(),r={内部审核:"APPROVAL_INNER",博通审核:"APPROVAL_BTO",资方审核:"APPROVAL_LEASE"},m={通过:"PASS",拒绝:"REJECT"};e.approvalType=r[e.approvalType],e.result=m[e.result],e.rejectFiles=e.rejectFiles.map(p=>({fileName:X(p),fileSrc:H(p)})),await l.approvalData(e),await A(2e3),Q.currentRoute.value.name=="deviceInfo"||location.reload()}return(e,r)=>{const m=M,p=I;return d(),ae(oe,null,[a(E)?(d(),v(m,{key:0,readonly:!a(f),disabled:!a(f),"show-error-message":a(f),form:a(t).rejectReason,"approval-name":"approval",class:"pt-3","group-class":"shadowC"},null,8,["readonly","disabled","show-error-message","form"])):b("",!0),te("div",le,[a(y)&&a(i)&&a(_)?(d(),v(p,{key:0,disabled:!a(i),round:"",block:"",type:"warning",onClick:a(D),size:"small",class:"!w-[100px] !bg-[#ffab30] !mr-9"},{default:R(()=>[h(" 保存 ")]),_:1},8,["disabled","onClick"])):b("",!0),a(y)&&a(i)?(d(),v(p,{key:1,disabled:!a(i),round:"",block:"",type:"warning",onClick:a(O),size:"small",class:"!w-[100px] !bg-[#ffab30]"},{default:R(()=>[h(" 提交 ")]),_:1},8,["disabled","onClick"])):b("",!0),a(T)&&!a(i)?(d(),v(p,{key:2,disabled:!a(f),round:"",block:"",type:"warning",onClick:a(C),size:"small",class:"!w-[100px] !bg-[#ffab30]"},{default:R(()=>[h(" 审核 ")]),_:1},8,["disabled","onClick"])):b("",!0),h(" "+se(e.$log(e.$debounce)),1)])],64)}}};export{fe as _};
