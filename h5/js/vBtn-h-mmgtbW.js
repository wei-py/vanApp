import{b as S,a as j,B as N}from"./vant-DL9g20lT.js";import{m as D,_ as L}from"./makeForm-C_uyyvx9.js";import{m as I}from"./backfill-hh-glB-L.js";import{b as P,z as C,D as A,B as M,u as U,A as z,e as J,E as F,x as q,n as G,F as W,y as Z,r as $}from"./index-NPFU1_kq.js";import{l as f}from"./lodash-C-AG1eJN.js";import{m as H}from"./makeUpload-FhoYjxox.js";import{c,r as K,e as Q,Z as m,_ as X,u as l,a2 as v,a5 as b,a0 as Y,a8 as y,V as R,F as ee}from"./@vue-BhOIXUCP.js";const ae=[I("审核"),{formType:"input",label:"订单",readonly:!0,name:"orderId",value:""},{formType:"input",label:"审核方式",name:"approvalType",readonly:!0,value:"",realValue:"",backfill(t){const o={APPROVAL_INNER:"内部审核",APPROVAL_BTO:"博通审核",APPROVAL_LEASE:"资方审核"},n=t.stateId=="WAITING_APPROVAL_BTO"?"APPROVAL_BTO":"APPROVAL_INNER";this.realValue=t[this.name]||n,this.value=o[t[this.name]||n]}},{formType:"input",label:"审核结果",name:"result",value:"",realValue:"",readonly:!0,required:!0,isLink:!0,backfill(t){const o={PASS:"通过",REJECT:"拒绝"};this.realValue=t[this.name],this.value=o[t[this.name]]},click(){const t=P();this.inlineForm[0].show=t.btns.canApproval},onMounted(){const t=this;this.inlineForm=[{slot:"extra",name:"Pop",formType:"popup",show:!1,round:!0,position:"bottom",class:"h-[40vh] !w-screen",closeOnClickOverlay:!0,inlineForm:[{slot:"default",formType:"pick",confirm(o){t.value=o.selectedOptions[0].text,t.realValue=o.selectedOptions[0].value,t.inlineForm[0].show=!1},columns:[{value:"PASS",text:"通过"},{value:"REJECT",text:"拒绝"}]}]}]}},{formType:"input",label:"原因",value:"",error:!0,inputAlign:"left",placeholder:"请输入原因",name:"rejectReason"},{formType:"input",name:"rejectFiles",label:"附件",...H(999,100,"*",!1,!1),async backfill(t){this.inlineForm[0].value=(t[this.name]||[]).map(o=>({url:C(o.fileSrc)})),await A(2e3),M(...this.inlineForm[0].value.map(o=>o.url))}}],te={class:"flex justify-center my-2"},pe={__name:"vBtn",setup(t,{expose:o}){const n=U(),s=P(),_=z();let h=c(()=>s.btns.hasEditBtn),i=c(()=>s.btns.canEdit),k=c(()=>s.btns.canSave),T=c(()=>s.btns.hasApprovalBtn),d=c(()=>s.btns.canApproval),E=c(()=>s.btns.rejectReason&&s.btns.hasApprovalModule),a=D({rejectReason:ae},!1),g=K(!1);const B=c(()=>!(h.value&&i.value&&k.value)&&!i.value);function w(){for(let e=0;e<a.rejectReason.length;e++){if(s.btns.rejectReason&&s.btns.hasApprovalModule){const r=a.rejectReason[e].name;f.isFunction(a.rejectReason[e].backfill)?a.rejectReason[e].backfill(s.btns.rejectReason):a.rejectReason[e].value=s.btns.rejectReason[r],f.isFunction(a.rejectReason[e].onMounted)&&e==3&&a.rejectReason[e].onMounted()}g.value=s.btns.hasApprovalBtn&&!s.btns.canEdit&&!s.btns.canApproval,g.value?(a.rejectReason[e].readonly=!0,a.rejectReason[e].click=()=>{},a.rejectReason[5].inlineForm[0].readonly=!0,a.rejectReason[5].inlineForm[0].disabled=!0):(a.rejectReason[e].readonly=!1,a.rejectReason[e].click=function(){this.inlineForm[0].show=s.btns.canApproval},a.rejectReason[5].inlineForm[0].readonly=!1,a.rejectReason[5].inlineForm[0].disabled=!1)}}J({approvalBackfill:w}),o({approvalBackfill:w}),Q(async()=>{n.approvalBackfill(),B.value});async function V(){F();try{const e=await n.saveData();if(e){const r=f.get(e,"msg","保存成功")||"保存成功";S(r)}}catch{j("保存失败")}}async function O(){F(),await n.saveData();try{const e=await q(),r=G(),u=f.pick(r,["id","orderId"]);n.submitData(u),n.getData(),await A(2e3),location.reload()}catch(e){j({className:"!bg-[red] !text-white",message:e[0].message})}}async function x(){await _.approvalDoms.approval.validate();const e=_.approvalDoms.approval.getValues(),r={内部审核:"APPROVAL_INNER",博通审核:"APPROVAL_BTO",资方审核:"APPROVAL_LEASE"},u={通过:"PASS",拒绝:"REJECT"};e.approvalType=r[e.approvalType],e.result=u[e.result],e.rejectFiles=e.rejectFiles.map(p=>({fileName:W(p),fileSrc:Z(p)})),await n.approvalData(e),await A(2e3),$.currentRoute.value.name=="deviceInfo"||location.reload()}return(e,r)=>{const u=L,p=N;return m(),X(ee,null,[l(E)?(m(),v(u,{key:0,readonly:!l(d),disabled:!l(d),"show-error-message":l(d),form:l(a).rejectReason,"approval-name":"approval",class:"pt-3","group-class":"shadowC"},null,8,["readonly","disabled","show-error-message","form"])):b("",!0),Y("div",te,[l(h)&&l(i)&&l(k)?(m(),v(p,{key:0,disabled:!l(i),round:"",block:"",type:"warning",onClick:V,size:"small",class:"!w-[100px] !bg-[#ffab30] !mr-9"},{default:y(()=>[R(" 保存 ")]),_:1},8,["disabled"])):b("",!0),l(h)&&l(i)?(m(),v(p,{key:1,disabled:!l(i),round:"",block:"",type:"warning",onClick:O,size:"small",class:"!w-[100px] !bg-[#ffab30]"},{default:y(()=>[R(" 提交 ")]),_:1},8,["disabled"])):b("",!0),l(T)&&!l(i)?(m(),v(p,{key:2,disabled:!l(d),round:"",block:"",type:"warning",onClick:x,size:"small",class:"!w-[100px] !bg-[#ffab30]"},{default:y(()=>[R(" 审核 ")]),_:1},8,["disabled"])):b("",!0)])],64)}}};export{pe as _};
